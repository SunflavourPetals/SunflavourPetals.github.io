<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>çƒ¦äººçš„ C4819 è­¦å‘Š</title>
      <link href="/2024/09/13/Annoying-Warning-C4819/"/>
      <url>/2024/09/13/Annoying-Warning-C4819/</url>
      
        <content type="html"><![CDATA[<p>éšç€ Windows å¯¹ utf-8 çš„æ”¯æŒé€æ¸å®Œå–„ï¼ˆä¸éœ€è¦ bom è®°äº‹æœ¬ä¹Ÿèƒ½åˆ†è¾¨ utf-8 å’Œæ‰€è°“ â€œANSIâ€ ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ï¼‰ï¼Œæˆ‘ç°åœ¨åŸºæœ¬éƒ½ä¼šä½¿ç”¨ utf-8 ä½œä¸º C++ æºæ–‡ä»¶çš„ç¼–ç ã€‚ä½†æ˜¯ <code>CL.EXE</code> å´ä¸è¡Œï¼Œå®ƒæŠŠä¸å¸¦ bom çš„æºæ–‡ä»¶å½“ â€œANSIâ€ ç¼–ç çš„æ–‡æœ¬æ¥å¤„ç†ï¼Œæˆ‘çš„ä»£ç é¡µä¸º 936ï¼Œå³ GBKï¼Œå¯¼è‡´å­˜åœ¨é ASCII å­—ç¬¦æ—¶å‡ºç° <a href="https://learn.microsoft.com/zh-cn/cpp/error-messages/compiler-warnings/compiler-warning-level-1-c4819?view=msvc-170" title="MSDN zh-cn">C4819</a> è­¦å‘Šã€‚  </p><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„è§£å†³æ–¹æ³•ï¼š  </p><p>åˆ†ç±»ä¸€ï¼šè¿å°±æ–‡ä»¶  </p><ol><li>åœ¨ä½¿ç”¨ <code>CL.EXE</code> ç¼–è¯‘æ—¶æ·»åŠ å‚æ•° <code>/utf-8</code> éå¸¸å¥½ä½¿ï¼Œ<br>å¦‚æœæ˜¯é€šè¿‡ VS ä½¿ç”¨ <code>CL.EXE</code> ç¼–è¯‘ï¼Œåœ¨ <code>é¡¹ç›®-&gt;å±æ€§-&gt;é…ç½®å±æ€§-&gt;C/C++-&gt;å‘½ä»¤è¡Œ-&gt;å…¶ä»–é€‰é¡¹</code> é‡Œæ·»åŠ  <code>/utf-8</code> å°±è¡Œï¼›  </li><li>æŠŠç³»ç»Ÿçš„ä»£ç é¡µæ”¹æˆ 65001ï¼Œå³ utf-8ï¼Œ<br>è¿™å°±éœ€è¦ä½ å¼€å¯é‚£ä¸ªç‹—å± beta åŠŸèƒ½â€œå…¨å±€ utf-8â€ äº†ï¼Œæˆ‘å¼€äº†ä¹‹åï¼Œ<code>.chm</code> æ–‡ä»¶æ‰“ä¸å¼€äº†ï¼Œä»¥å‰çš„æ–‡æœ¬æ–‡ä»¶ä¹Ÿä¹±ç äº†ï¼Œå¦‚æœæ²¡æœ‰å†å²è´Ÿæ‹…ï¼Œå¯ä»¥å¼€ï¼Œä½†æˆ‘ç”¨äº†ä¸€æ®µæ—¶é—´å°±æ¢å›å»äº†ğŸ’©ğŸ’©ğŸ’©ã€‚</li></ol><p>åˆ†ç±»äºŒï¼šè¿å°±ç³»ç»Ÿ</p><ol><li>æŠŠ utf-8 çš„æºæ–‡ä»¶è½¬ä¸º â€œå¸¦ BOM çš„ utf-8â€ æ–‡ä»¶ï¼Œè¿™æ · <code>CL.EXE</code> æ‰æ²¡æ„è§ğŸ’©ï¼›  </li><li>æŠŠ utf-8 çš„æºæ–‡ä»¶è½¬ä¸º â€œANSIâ€ ç¼–ç ï¼Œæ¯”å¦‚ç”¨è®°äº‹æœ¬æ‰“å¼€å¦å­˜ä¸º â€œANSIâ€ ç¼–ç çš„æ–‡ä»¶ğŸ’©ğŸ’©ğŸ’©ï¼›  </li><li>ä¿®æ”¹æºæ–‡ä»¶é‡Œå†²çªçš„éƒ¨åˆ†ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²é‡Œå†™äº†ä¸ª emoji <code>&quot;ğŸ’©&quot;</code>ï¼Œç”¨é€šç”¨å­—ç¬¦å <code>&quot;\U0001F4A9&quot;</code> æ›¿æ¢å®ƒï¼Œå¯è¯»æ€§ç›´çº¿ä¸‹é™ã€‚</li></ol><p>æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘çš„æºæ–‡ä»¶å‡†å¤‡åªç”¨ ASCIIï¼Œè¿™æ ·åˆ©ç”¨ utf-8 å¯¹ ASCII çš„å…¼å®¹æ€§ï¼Œå¯ä»¥æ— éœ€æ”¹å˜ä»»ä½•äº‹ä¹Ÿèƒ½åœ¨æˆ‘çš„ç¯å¢ƒé‡Œæ— è­¦å‘Šé€šè¿‡ç¼–è¯‘ã€‚ç­‰åˆ°æˆ‘å†™å¥½ï¼Œç¼–è¯‘å™¨è¯´æˆ‘æŸä¸ªæ–‡ä»¶ <code>xxx.h</code> é‡Œæœ‰ä¸å…¼å®¹çš„å­—ç¬¦ï¼Œå«æˆ‘ä¿å­˜æˆ Unicode æ–‡æœ¬æ–‡ä»¶ï¼Œä½†æ˜¯ç»™çš„ä½ç½®æ˜¯é”™è¯¯çš„ â€œ1 è¡Œ 1 åˆ—â€ã€‚  </p><p>æ— å¥ˆåªèƒ½è‡ªå·±æ‰¾ï¼Œä»£ç æ¯”è¾ƒå¤šæˆ‘çœ‹äº†åŠå¤©éƒ½æ²¡å‘ç°å“ªæœ‰é ASCII å­—ç¬¦ğŸ’©ğŸ’©ğŸ’©ã€‚  </p><p>æœ€åçš„è§£å†³æ–¹æ¡ˆï¼Œå†™ä¸ªç¨‹åºæŠŠæºæ–‡ä»¶æŒ‰å­—èŠ‚è¯»å‡ºï¼Œå¦‚æœæœ‰æ•°å€¼å¤§äº 127 çš„å­—èŠ‚å°±æŠ¥å‘Šåç§»é‡ï¼Œæœ€åå‘ç°åœ¨åç§»é‡ 598 å¤„æœ‰ä¸€ä¸ªå…¨è§’å†’å·å‡ºç°åœ¨äº†æ³¨é‡Šé‡Œï¼Œä¿®æ”¹å®ƒï¼Œè§£å†³ã€‚  </p><p>ğŸ’©</p><p>å¤ç°ï¼š  </p><img src="img.png" data-align="center">]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ ä¸¥æ ¼å¼±åº</title>
      <link href="/2024/03/26/CPP-Strict-Weak-Order/"/>
      <url>/2024/03/26/CPP-Strict-Weak-Order/</url>
      
        <content type="html"><![CDATA[<img src="img.jpg" alt="C++ Primer 5th" data-align="center"><p>æ€€ç–‘ä¹¦ä¸Šè¡¨è¾¾æœ‰è¯¯ï¼Œè‹¥ä»¥â€œå°äºç­‰äºâ€ä¸ºä¾‹ï¼Œç¬¬ä¸€æ¡å°±ä»¤æ‰€æœ‰æ•´å‹å€¼å’Œæµ®ç‚¹å‹å€¼å†…å»ºçš„<code>&lt;=</code>è¿ç®—æ— æ³•æ»¡è¶³ã€‚  </p><p>å¯¹äºäºŒå…ƒå…³ç³» <code>less</code>ï¼š  </p><ul><li>è‹¥ <code>less(a, b)</code> ä¸ºçœŸï¼Œåˆ™ <code>less(b, a)</code> ä¸ºå‡ï¼Œå³ä¸æ»¡è¶³è‡ªåæ€§ã€‚  </li><li>è‹¥ <code>less(a, b)</code> å’Œ <code>less(b, c)</code> ä¸ºçœŸï¼Œè•´å« <code>less(a, c)</code> ä¸ºçœŸï¼Œå³æ»¡è¶³ä¼ é€’æ€§ã€‚  </li><li>ä»¤å…³ç³» <code>equal(a, b)</code> ä¸º <code>(Â¬less(a, b) âˆ§ Â¬less(b, a))</code>ï¼Œå¯çŸ¥ <code>equal</code> æ˜¯ <code>a</code> ä¸ <code>b</code> çš„ç­‰ä»·å…³ç³»ï¼Œä¸”åŒæ ·å…·æœ‰ä¼ é€’æ€§ã€‚</li></ul><p><a href="https://zh.cppreference.com/w/cpp/concepts/strict_weak_order">C++å‚è€ƒ</a>  </p>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ å®Œç¾è½¬å‘çš„å®ç°</title>
      <link href="/2024/03/19/CPP-Implementation-of-forward/"/>
      <url>/2024/03/19/CPP-Implementation-of-forward/</url>
      
        <content type="html"><![CDATA[<h1 id="C-å®Œç¾è½¬å‘çš„å®ç°"><a href="#C-å®Œç¾è½¬å‘çš„å®ç°" class="headerlink" title="C++ å®Œç¾è½¬å‘çš„å®ç°"></a>C++ å®Œç¾è½¬å‘çš„å®ç°</h1><p>æœ¬æ–‡å°†ä»‹ç» <code>std::forward</code> æ€æ ·åšåˆ°â€œå®Œç¾è½¬å‘â€åŠå¦‚ä½•å®ç°ã€‚<br>å¦‚æœ‰é”™è¯¯è¯·æŒ‡å‡ºï¼Œæ„Ÿæ¿€ä¸å°½ã€‚  </p><p>è®²å®Œç¾è½¬å‘å‰éœ€è¦å…ˆäº†è§£è½¬å‘å¼•ç”¨å’Œå¼•ç”¨æŠ˜å ã€‚  </p><h2 id="è½¬å‘å¼•ç”¨"><a href="#è½¬å‘å¼•ç”¨" class="headerlink" title="è½¬å‘å¼•ç”¨"></a>è½¬å‘å¼•ç”¨</h2><p>åœ¨å‡½æ•°æ¨¡æ¿ä¸­ï¼Œä¸ºäº†å¯ä»¥æ ¹æ®ä¼ å…¥å‚æ•°çš„å€¼ç±»åˆ«ï¼Œä½¿å½¢å‚çš„ç±»å‹ä¸ºç›¸åº”çš„å·¦å€¼å¼•ç”¨&#x2F;å³å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨è½¬å‘å¼•ç”¨ï¼Œä¹Ÿç§°ä¸ºä¸‡èƒ½å¼•ç”¨ï¼š  </p><pre><code class="C++">template &lt;typename T&gt;void foo(T&amp;&amp; arg) &#123;&#125;</code></pre><p>å¯¹ C++20 æ–°å¢çš„ç®€å†™å‡½æ•°æ¨¡æ¿ä¹Ÿæ˜¯å¦‚æ­¤ï¼š  </p><pre><code class="C++">void foo(auto&amp;&amp; arg) &#123;&#125;</code></pre><p>ä¸‹é¢çš„è°ƒç”¨ä¸­ï¼š  </p><pre><code class="C++">foo(1);int num&#123; 1 &#125;;foo(num);</code></pre><p>å¯¹äº <code>foo(1)</code>ï¼Œå½¢å‚ <code>arg</code> çš„ç±»å‹æ˜¯ <code>int&amp;&amp;</code>ï¼›å¯¹äº <code>foo(num)</code>ï¼Œå½¢å‚ <code>arg</code> çš„ç±»å‹æ˜¯ <code>int&amp;</code>ã€‚è¿™éƒ½æ˜¯ç”¨å¼•ç”¨æŠ˜å æ¥å®ç°çš„ã€‚  </p><p>è™½ç„¶ <code>T&amp;&amp;</code> çœ‹ä¸Šå»æ˜¯å³å€¼å¼•ç”¨çš„å½¢å¼ï¼Œä½†æ˜¯éœ€è¦è€ƒè™‘ <code>T</code> æ˜¯å¼•ç”¨ç±»å‹çš„åˆ«åæˆ–æ˜¯éœ€è¦è¢«æ¨å¯¼çš„ç±»å‹çš„æƒ…å†µï¼Œè¯·çœ‹â€œå¼•ç”¨æŠ˜å â€ã€‚</p><h2 id="å¼•ç”¨æŠ˜å "><a href="#å¼•ç”¨æŠ˜å " class="headerlink" title="å¼•ç”¨æŠ˜å "></a>å¼•ç”¨æŠ˜å </h2><p>C++ ä¸å…è®¸å¼•ç”¨çš„å¼•ç”¨ï¼Œå¦‚ <code>int &amp; &amp; r = num;</code> <code>int &amp; &amp;&amp; r = 1;</code>â€¦â€¦<br>è¿™äº›éƒ½æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚  </p><p>ä½†æ˜¯å½“ <code>T</code> æ˜¯å¼•ç”¨ç±»å‹çš„ç±»å‹åˆ«åæ—¶ï¼Œä½¿ç”¨ <code>T&amp;</code> å’Œ <code>T&amp;&amp;</code> å°†å‘ç”Ÿå¼•ç”¨æŠ˜å ï¼ˆè¿™æ˜¯ç‰¹æ€§ï¼‰ã€‚  </p><pre><code class="C++">using T = int&amp;;using U = int&amp;&amp;;int num&#123;&#125;;T&amp;  r1 = num;T&amp;&amp; r2 = num;U&amp;  r3 = num;U&amp;&amp; r4 = 0;</code></pre><p>å¼•ç”¨æŠ˜å çš„è§„åˆ™ï¼š<code>&amp;&amp; &amp;&amp;</code> æŠ˜å æˆå³å€¼å¼•ç”¨ï¼Œæ‰€æœ‰å…¶ä»–ç»„åˆå‡æŠ˜å æˆå·¦å€¼å¼•ç”¨ã€‚  </p><p>å°±ä»¥ä¸Šä»£ç ï¼Œè¿ç”¨ä¸Šè¿°è§„åˆ™è¿›è¡Œæ¨å¯¼ï¼Œå¾—å‡ºï¼š  </p><table><thead><tr><th align="center">æ ‡è¯†ç¬¦</th><th>ç±»å‹å£°æ˜</th><th>æ›¿æ¢ç±»å‹åˆ«åå</th><th align="center">å¼•ç”¨æŠ˜å åçš„ç±»å‹</th></tr></thead><tbody><tr><td align="center">r1</td><td>T&amp;</td><td>int&amp; &amp;</td><td align="center">int&amp;</td></tr><tr><td align="center">r2</td><td>T&amp;&amp;</td><td>int&amp; &amp;&amp;</td><td align="center">int&amp;</td></tr><tr><td align="center">r3</td><td>U&amp;</td><td>int&amp;&amp; &amp;</td><td align="center">int&amp;</td></tr><tr><td align="center">r4</td><td>U&amp;&amp;</td><td>int&amp;&amp; &amp;&amp;</td><td align="center">int&amp;&amp;</td></tr></tbody></table><p>é™¤äº†ç±»å‹åˆ«åï¼Œä½¿ç”¨ <code>æ¨¡æ¿å‚æ•°&amp;&amp;</code> å’Œ <code>auto&amp;&amp;</code> ä¹Ÿèƒ½å‘ç”Ÿå¼•ç”¨æŠ˜å ï¼š  </p><pre><code class="C++">template &lt;typename T&gt;void foo(T&amp;&amp; arg) // T&amp;&amp; åœ¨æ¥å—å·¦å€¼æ—¶å°†å‘ç”Ÿå¼•ç”¨æŠ˜å &#123;    std::vector&lt;int&gt; vec&#123; 1, 2, 3 &#125;;    for (auto&amp;&amp; e : vec) // auto&amp;&amp; åŒä¸Š    &#123;        std::cout &lt;&lt; e &lt;&lt; &#39; &#39;;    &#125;&#125;</code></pre><p>è‡³äºæ¨¡æ¿å‚æ•°Tå’Œautoå¦‚ä½•è¢«æ¨å¯¼ä¸ºå¼•ç”¨ç±»å‹è€Œå¼•å‘å¼•ç”¨æŠ˜å ï¼Œè¯·çœ‹ä¸‹èŠ‚ã€‚  </p><h2 id="æ¨¡æ¿å‚æ•°çš„ç±»å‹æ¨å¯¼"><a href="#æ¨¡æ¿å‚æ•°çš„ç±»å‹æ¨å¯¼" class="headerlink" title="æ¨¡æ¿å‚æ•°çš„ç±»å‹æ¨å¯¼"></a>æ¨¡æ¿å‚æ•°çš„ç±»å‹æ¨å¯¼</h2><p>è¿˜æ˜¯ä»¥ <code>foo</code> å‡½æ•°æ¨¡æ¿ä¸ºä¾‹ï¼Œä¸ºäº†ä½¿ <code>foo</code> æ¥æ”¶æ‹¥æœ‰ä¸åŒå€¼ç±»åˆ«çš„å‚æ•°å¹¶ä¸”ä½¿å½¢å‚çš„ç±»å‹ä¸ºç›¸åº”å¼•ç”¨ï¼Œå¦‚ä½•æ¨å¯¼æ¨¡æ¿å‚æ•° <code>T</code> çš„ç±»å‹ï¼Ÿ  </p><pre><code class="C++">template &lt;typename T&gt;void foo(T&amp;&amp; arg) &#123;&#125;void test(int num)&#123;    foo(1);    foo(num);&#125;</code></pre><p><code>foo(1)</code> ä¸­ï¼Œå®å‚ <code>1</code> æ˜¯çº¯å³å€¼ï¼Œå½¢å‚ <code>T&amp;&amp; arg</code> ä¸­ï¼Œargåªèƒ½æ˜¯å³å€¼å¼•ç”¨(å› ä¸ºæ— æ³•å°†å·¦å€¼å¼•ç”¨ç»‘å®šåˆ°å³å€¼)ï¼Œ<code>T</code> è¢«æ¨å¯¼ä¸º <code>int</code>ï¼Œ<code>T&amp;&amp;</code> åˆšå¥½æ˜¯ <code>int&amp;&amp;</code>ï¼›<br><code>foo(num)</code> ä¸­ï¼Œ å®å‚ <code>num</code> æ˜¯å·¦å€¼ï¼Œå½¢å‚ <code>T&amp;&amp; arg</code> ä¸­ï¼Œargåªèƒ½æ˜¯å·¦å€¼å¼•ç”¨(å› ä¸ºæ— æ³•å°†å³å€¼å¼•ç”¨ç»‘å®šåˆ°å·¦å€¼)ï¼Œ<code>T</code> è¢«æ¨å¯¼ä¸º <code>int&amp;</code>ï¼Œ<code>T&amp;&amp;</code> åˆ™æ˜¯ <code>int&amp; &amp;&amp;</code>ï¼Œå¼•ç”¨æŠ˜å ä¸º <code>int&amp;</code>ã€‚  </p><p>æ­¤å¤–ï¼Œ<code>auto</code> ä½¿ç”¨å’Œæ¨¡æ¿å‚æ•°ä¸€æ ·çš„æ¨å¯¼è§„åˆ™ã€‚  </p><p>ç±»å‹æ¨å¯¼å’Œå¼•ç”¨æŠ˜å åŒå‰‘åˆç’§ï¼Œå°±ä½¿ä¹‹æˆä¸ºè½¬å‘å¼•ç”¨ã€‚  </p><p>è½¬å‘å¼•ç”¨ä½¿ç”¨å¼•ç”¨æŠ˜å ï¼Œæ ¹æ®å®å‚çš„å€¼ç±»åˆ«ä½¿å½¢å‚ä¸ºå·¦å€¼å¼•ç”¨æˆ–å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆéœ€è¦å®Œç¾è½¬å‘å‘¢ï¼Ÿè¯·çœ‹ä¸‹èŠ‚ã€‚  </p><h2 id="éœ€è¦å®Œç¾è½¬å‘çš„åŸå› "><a href="#éœ€è¦å®Œç¾è½¬å‘çš„åŸå› " class="headerlink" title="éœ€è¦å®Œç¾è½¬å‘çš„åŸå› "></a>éœ€è¦å®Œç¾è½¬å‘çš„åŸå› </h2><p>ä¸ŠèŠ‚æåˆ°å·¦å€¼å¼•ç”¨åªèƒ½ç»‘å®šåˆ°å·¦å€¼ï¼Œå³å€¼å¼•ç”¨åªèƒ½ç»‘å®šåˆ°å³å€¼ã€‚å€¼ç±»åˆ«æ˜¯ä¸ªéœ€è¦ä¸¥è‚ƒè®¨è®ºçš„ä¸œè¥¿ï¼Œä½†æ˜¯æœ¬æ–‡ä¸»é¢˜ä¸åœ¨äºæ­¤ï¼Œå…³äºå€¼ç±»åˆ«ï¼Œä¸åŒäºä¼ ç»Ÿ C è¯­è¨€ï¼ŒC++11 ç»™å‡ºçš„å®šä¹‰ï¼Œå‚è€ƒ<a href="https://en.cppreference.com/w/cpp/language/value_category" title="value_category - å€¼ç±»åˆ«">C++ Reference</a>(<a href="https://zh.cppreference.com/w/cpp/language/value_category" title="c++ reference å€¼ç±»åˆ«(ä¸­æ–‡)">ä¸­æ–‡</a>)ã€‚  </p><p>å€¼ç±»åˆ«é€šå¸¸ç”¨äºæ‹·è´æ§åˆ¶ï¼Œå› æ­¤åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è½¬å‘æ“ä½œã€‚<br>æ³¨ï¼šid è¡¨è¾¾å¼çš„å€¼ç±»åˆ«éƒ½æ˜¯å·¦å€¼ï¼Œæ— è®ºè¿™ä¸ªæ ‡è¯†ç¬¦è¡¨è¾¾å¼çš„ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨è¿˜æ˜¯å³å€¼å¼•ç”¨ã€‚  </p><p>ä¾‹ï¼š  </p><pre><code class="C++">template &lt;typename T&gt;void no_forwarding(T&amp;&amp; arg)&#123;    ...    // è¿™è¡Œä»£ç ä¹‹åä¸å†ä½¿ç”¨ arg    // å¦‚æœ arg çš„ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ç§»åŠ¨æ„é€     // å¦‚æœ arg çš„ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨æ‹·è´æ„é€     // ä½†æ˜¯è¿™é‡Œæ— è®ºå¦‚ä½•éƒ½ä¼šåŒ¹é…åˆ°æ‹·è´æ„é€ ï¼Œå› ä¸º id è¡¨è¾¾å¼çš„å€¼ç±»åˆ«æ˜¯å·¦å€¼    // ä¸ºäº†è¾¾æˆæˆ‘ä»¬æœŸæœ›çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè½¬å‘æ“ä½œ    using arg_t = std::remove_reference_t&lt;T&gt;;    arg_t temp&#123; arg &#125;;    ...&#125;</code></pre><pre><code class="C++">template &lt;typename T&gt;void use_forwarding(T&amp;&amp; arg)&#123;    ...    // arg çš„ç±»å‹æ˜¯å³å€¼å¼•ç”¨æ—¶ std::forward&lt;T&gt;(arg) è¿™ä¸ªè¡¨è¾¾å¼æ˜¯å³å€¼ï¼ŒåŒ¹é…ç§»åŠ¨æ„é€ ï¼›    // åä¹‹åˆ™æ˜¯å·¦å€¼ï¼Œä½¿ç”¨æ‹·è´æ„é€ ã€‚    using arg_t = std::remove_reference_t&lt;T&gt;;    arg_t temp&#123; std::forward&lt;T&gt;(arg) &#125;;    ...&#125;</code></pre><p>æ•…è™½ç„¶è½¬å‘å¼•ç”¨æœ‰ç”¨ï¼Œä½†æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªè½¬å‘æ“ä½œï¼Œæ‰ç®—å¾—ä¸Šå¥å…¨ã€‚<br>è§£å†³æ–¹æ¡ˆè¯·çœ‹ä¸‹èŠ‚ï¼Œå®Œç¾è½¬å‘ã€‚  </p><p>å¦‚æœä½ åˆ†ä¸æ¸…ç±»å‹å’Œå€¼ç±»åˆ«ï¼ˆæ¯”å¦‚æƒ³é—®â€œä¸ºä»€ä¹ˆå³å€¼å¼•ç”¨ä¸æ˜¯å³å€¼â€è¿™ç§é—®é¢˜ï¼‰ï¼Œè¯·å»çœ‹ä¸€ä¸‹<a href="https://zh.cppreference.com/w/cpp/language/value_category">cpp reference</a>ã€‚  </p><h2 id="å®Œç¾è½¬å‘"><a href="#å®Œç¾è½¬å‘" class="headerlink" title="å®Œç¾è½¬å‘"></a>å®Œç¾è½¬å‘</h2><p>ä¸ºåˆ¶é€ ä¸€ä¸ªå³å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>std::move</code>ï¼Œ<code>std::move</code> æ¥æ”¶ä¸€ä¸ªå·¦å€¼æˆ–å³å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªå³å€¼ã€‚  </p><p>ä¸€èˆ¬ <code>std::move</code> çš„å®ç°ï¼š  </p><pre><code class="C++">// C++14template &lt;typename T&gt;constexpr remove_reference_t&lt;T&gt;&amp;&amp; move(T&amp;&amp; arg) noexcept&#123;    return static_cast&lt;remove_reference_t&lt;T&gt;&amp;&amp;&gt;(arg);&#125;</code></pre><p>ä» <code>std::move</code> æºç å¯ä»¥çœ‹å‡ºï¼Œå®ƒå®é™…æ˜¯ä½¿ç”¨ <code>static_cast</code> å®ç°çš„ã€‚<br>å¯¹äºæŒæœ‰ <code>int</code> ç±»å‹çš„å·¦å€¼ <code>num</code>ï¼Œ<code>static_cast&lt;int&amp;&amp;&gt;(num)</code> å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼ã€‚ä½¿ç”¨ <code>static_cast</code> éœ€è¦æˆ‘ä»¬æ˜¾å¼å¡«å…¥ç±»å‹ï¼Œ<code>std::move(num)</code> åˆ™ä¸éœ€è¦ï¼Œæ›´åŠ ç®€çŸ­æ–¹ä¾¿ã€‚  </p><p>è‹¥å‡½æ•°è¿”å›ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼çš„å€¼ç±»åˆ«æ˜¯å³å€¼ï¼›è‹¥å‡½æ•°è¿”å›ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼çš„å€¼ç±»åˆ«æ˜¯å·¦å€¼ã€‚<br>(è‹¥å‡½æ•°è¿”å›å€¼ç±»å‹ä¸æ˜¯å¼•ç”¨ï¼Œé‚£ä¹ˆå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼çš„å€¼ç±»åˆ«æ˜¯å³å€¼)  </p><p>å›é¡¾<a href="#%E6%A8%A1%E6%9D%BF%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC">ç±»å‹æ¨å¯¼å°èŠ‚</a>ï¼Œæˆ‘ä»¬åŒæ ·ä»¥  </p><pre><code class="C++">template &lt;typename T&gt;void foo(T&amp;&amp; arg)&#123;    using arg_t = std::remove_reference_t&lt;T&gt;;    if constexpr (std::is_same_v&lt;T, int&amp;&gt;)    &#123;        arg_t temp&#123; arg &#125;; // copy    &#125;    else // T = int, decltype(arg) = int&amp;&amp;    &#123;        arg_t temp&#123; std::move(arg) &#125;; // move    &#125;&#125;void test()&#123;    int num = 1;    foo(1);    foo(num);&#125;</code></pre><p>ä¸ºä¾‹ï¼Œå¯¹äº <code>foo(1)</code>ï¼Œå½¢å‚ <code>arg</code> æœ‰ç±»å‹ <code>int&amp;&amp;</code>ï¼Œ<code>T</code> ä¸º <code>int</code>ï¼›å¯¹äº <code>foo(num)</code>ï¼Œå½¢å‚ <code>arg</code> æœ‰ç±»å‹ <code>int&amp;</code>ï¼Œ<code>T</code> ä¸º <code>int&amp;</code>ã€‚  </p><p>æœ‰ä»¥ä¸Šä¿¡æ¯å¸®åŠ©ï¼Œæˆ‘ä»¬å°±èƒ½åˆ†è¾¨å‡ºå“ªäº›æƒ…å†µåº”è¯¥ä½¿ç”¨ <code>std::move</code> æˆ– <code>static_cast</code> å°† <code>arg</code> åˆ¶ä½œæˆå³å€¼ï¼Œä½†æ˜¯æ‰‹åŠ¨é€‰æ‹©ä½•æ—¶ä½¿ç”¨ <code>std::move</code> è¿‡äºéº»çƒ¦ï¼Œæˆ‘ä»¬åº”è¯¥æœ‰ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œæ ¹æ®ä»¥ä¸Šä¿¡æ¯è¿”å›å·¦å€¼æˆ–å³å€¼ï¼Œé‚£å°±æ˜¯ <code>std::forward</code>ã€‚  </p><p>æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªä¸ºå·¦å€¼æœåŠ¡çš„ <code>my_forward</code>ï¼Œè®©å®ƒå…·æœ‰ <code>std::forward</code> çš„åŸºæœ¬åŠŸèƒ½ã€‚  </p><p>å¯¹äº <code>my_forward</code>ï¼Œ<code>foo</code> çš„æ¨¡æ¿å‚æ•° <code>T</code> æˆ–å½¢å‚çš„ç±»å‹ <code>decltype(arg)</code> æ˜¯æœ‰ç”¨çš„ä¿¡æ¯ï¼›<br>ä¸ºäº†ä½¿ç”¨æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ï¼Œ<code>my_forward</code> åº”è¯¥æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œä»¤æ¨¡æ¿å‚æ•°åˆ—è¡¨ä¸º <code>&lt;typename T&gt;</code>ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ <code>my_forward</code> æ—¶ï¼Œæ˜¾å¼å¡«å…¥æ¨¡æ¿å‚æ•°ï¼Œä¸èƒ½ä½¿ç”¨ç±»å‹æ¨å¯¼ï¼›<br>ä½¿ç”¨å¼•ç”¨æŠ˜å æ¥å¤„ç†è¿”å›ç±»å‹ï¼›<br>è¿”å›è¯­å¥åŒæ ·éœ€è¦å¼•ç”¨æŠ˜å é…åˆ <code>static_cast</code> æ¥å¤„ç†æˆæ­£ç¡®çš„å€¼ç±»åˆ«ï¼Œä»¤è¿”å›å€¼èƒ½å¤Ÿç»‘å®šåˆ°å®ƒã€‚  </p><p><code>my_forward</code> çš„å®ç°å¦‚ä¸‹ï¼š  </p><pre><code class="C++">template &lt;typename T&gt;constexpr T&amp;&amp; my_forward(std::remove_reference_t&lt;T&gt;&amp; arg) noexcept&#123;    return static_cast&lt;T&amp;&amp;&gt;(arg);&#125;</code></pre><p>æµ‹è¯•ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;utility&gt;#include &lt;type_traits&gt;template &lt;typename T&gt;constexpr T&amp;&amp; my_forward(std::remove_reference_t&lt;T&gt;&amp; arg) noexcept&#123;    return static_cast&lt;T&amp;&amp;&gt;(arg);&#125;struct test&#123;    test()&#123; std::cout &lt;&lt; &quot;default constructor\n&quot;; &#125;    test(test&amp;) &#123; std::cout &lt;&lt; &quot;copy\n&quot;; &#125;    test(test&amp;&amp;) &#123; std::cout &lt;&lt; &quot;move\n&quot;; &#125;&#125;;template &lt;typename T&gt;void forward_test(T&amp;&amp; arg)&#123;    using arg_t = std::remove_reference_t&lt;T&gt;;    arg_t temp&#123; my_forward&lt;T&gt;(arg) &#125;;&#125;int main()&#123;    test foo&#123;&#125;; // default constructor    forward_test(foo); // copy    forward_test(std::move(foo)); // move&#125;</code></pre><p>æˆåŠŸå®ç°å®Œç¾è½¬å‘(<a href="https://godbolt.org/z/8qbToznbd">godbolt</a>)ï¼  </p><p>æ ¹æ®å¼•ç”¨æŠ˜å çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬æ¥æ¨æ¼”ä¸€ä¸‹ <code>forward_test</code> çš„ <code>arg</code> åˆ†åˆ«æœ‰ç±»å‹ <code>int&amp;</code> å’Œ <code>int&amp;&amp;</code> æ—¶ï¼Œ<code>my_forward</code> çš„å·¥ä½œçŠ¶å†µï¼š  </p><h3 id="arg-ä¸ºå·¦å€¼å¼•ç”¨æ—¶"><a href="#arg-ä¸ºå·¦å€¼å¼•ç”¨æ—¶" class="headerlink" title="arg ä¸ºå·¦å€¼å¼•ç”¨æ—¶"></a>arg ä¸ºå·¦å€¼å¼•ç”¨æ—¶</h3><p>å·²çŸ¥å½“ <code>arg</code> ä¸º <code>int&amp;</code> æ—¶ï¼Œ<code>T</code> ä¹Ÿä¸º <code>int&amp;</code>ï¼Œ<br>å°† <code>T</code> å¡«å…¥å <code>my_forward&lt;T&gt;(arg)</code> å³æ˜¯ <code>my_forward&lt;int&amp;&gt;(arg)</code>ã€‚<br>å†æ¥çœ‹ <code>my_forward</code> çš„å¤„ç†ï¼š<br>è¿”å›å€¼ç±»å‹ <code>T&amp;&amp;</code> å³æ˜¯ <code>int&amp; &amp;&amp;</code>ï¼Œå¼•ç”¨æŠ˜å åä¸º <code>int&amp;</code>ï¼Œ<br>å‚æ•°æ˜¯ <code>std::remove_reference_t&lt;T&gt;&amp; arg</code>ï¼Œç»å¤„ç†åæ˜¯ <code>int &amp; arg</code>ï¼Œ<br>è¿”å›è¯­å¥ <code>return static_cast&lt;T&amp;&amp;&gt;(arg);</code> å³æ˜¯ <code>return static_cast&lt;int&amp; &amp;&amp;&gt;(arg);</code>ï¼Œå¼•ç”¨æŠ˜å åä¸º <code>return static_cast&lt;int&amp;&gt;(arg);</code>ï¼Œ<br>æˆåŠŸè½¬å‘ä¸ºå·¦å€¼ã€‚  </p><h3 id="arg-ä¸ºå³å€¼å¼•ç”¨æ—¶"><a href="#arg-ä¸ºå³å€¼å¼•ç”¨æ—¶" class="headerlink" title="arg ä¸ºå³å€¼å¼•ç”¨æ—¶"></a>arg ä¸ºå³å€¼å¼•ç”¨æ—¶</h3><p>å·²çŸ¥å½“ <code>arg</code> ä¸º <code>int&amp;&amp;</code> æ—¶ï¼Œ<code>T</code> ä¸º <code>int</code>ï¼Œ<br>å°† <code>T</code> å¡«å…¥å <code>my_forward&lt;T&gt;(arg)</code> å³æ˜¯ <code>my_forward&lt;int&gt;(arg)</code>ã€‚<br>å†æ¥çœ‹ <code>my_forward</code> çš„å¤„ç†ï¼š<br>è¿”å›å€¼ç±»å‹ <code>T&amp;&amp;</code> å³æ˜¯ <code>int&amp;&amp;</code>ï¼Œ<br>å‚æ•°æ˜¯ <code>std::remove_reference_t&lt;T&gt;&amp; arg</code>ï¼Œç»å¤„ç†åæ˜¯ <code>int &amp; arg</code>ï¼Œ<br>è¿”å›è¯­å¥ <code>return static_cast&lt;T&amp;&amp;&gt;(arg);</code> å³æ˜¯ <code>return static_cast&lt;int&amp;&amp;&gt;(arg);</code>ï¼Œ<br>æˆåŠŸè½¬å‘ä¸ºå³å€¼ã€‚  </p><h2 id="å®Œç¾è½¬å‘Â·ç»­"><a href="#å®Œç¾è½¬å‘Â·ç»­" class="headerlink" title="å®Œç¾è½¬å‘Â·ç»­"></a>å®Œç¾è½¬å‘Â·ç»­</h2><p>æ ‡å‡†åº“è¿˜æä¾›äº†ä¸ºå³å€¼æœåŠ¡çš„ <code>std::forward</code>ï¼Œä»¥ msvc-stlä¸ºä¾‹ï¼š  </p><pre><code class="C++">_EXPORT_STD template &lt;class _Ty&gt;_NODISCARD _MSVC_INTRINSIC constexpr _Ty&amp;&amp; forward(remove_reference_t&lt;_Ty&gt;&amp;&amp; _Arg) noexcept &#123;    static_assert(!is_lvalue_reference_v&lt;_Ty&gt;, &quot;bad forward call&quot;);    return static_cast&lt;_Ty&amp;&amp;&gt;(_Arg);&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ä¸ºå³å€¼æä¾›çš„ <code>std::forward</code> ä¸å…è®¸å°†å³å€¼è½¬å‘ä¸ºå·¦å€¼ï¼  </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C++20 çš„æ¯”è¾ƒè¿ç®—ç¬¦</title>
      <link href="/2024/02/22/CPP20-Comparison-Operators/"/>
      <url>/2024/02/22/CPP20-Comparison-Operators/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ C++20 ä¸­ï¼Œæ¯”è¾ƒè¿ç®—ç¬¦ä»¬è¿æ¥äº†ä¸€æ¬¡é©æ–°ï¼Œä¸ä»…æœ‰ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„åŠ å…¥ï¼Œè¿˜æœ‰é‡è½½å†³è®®ä¸Šçš„æ”¹å˜ã€‚<br>C++20 ä¸­æ·»åŠ äº†æ¯”è¾ƒè¿ç®—ç¬¦çš„ç‰¹æ®Šé‡è½½è§£æè§„åˆ™ã€‚  </p><p>å…³äºä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹<a href="https://sunflavourpetals.github.io/2023/09/22/CPP20%E4%B8%89%E8%B7%AF%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/">æˆ‘çš„åšå®¢</a>ã€‚  </p><p>åœ¨ C++20 ä¹‹å‰ï¼Œè‹¥è¦æ”¯æŒæ‰€æœ‰çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œä¸€èˆ¬éœ€è¦æä¾›ï¼š  </p><ol><li><code>operator==</code>  </li><li><code>operator!=</code>  </li><li><code>operator&lt;</code>  </li><li><code>operator&lt;=</code>  </li><li><code>operator&gt;</code>  </li><li><code>operator&gt;=</code></li></ol><p>ä» C++20 èµ·ï¼Œä¸€èˆ¬åªéœ€è¦æä¾›ï¼š  </p><ol><li><code>operator==</code>  </li><li><code>operator&lt;=&gt;</code></li></ol><p><code>!=</code> å¯ä»¥é€šè¿‡é‡è½½å†³è®®é€‰æ‹©åˆ°ä½¿ç”¨ <code>operator==</code> çš„æ–¹å¼ï¼›  </p><p><code>&gt;</code>ã€<code>&gt;=</code>ã€<code>&lt;</code>ã€<code>&lt;=</code> å¯ä»¥é€šè¿‡é‡è½½å†³è®®é€‰æ‹©åˆ°ä½¿ç”¨ <code>operator&lt;=&gt;</code> çš„æ–¹å¼ã€‚  </p><p>è¿™æå¤§åœ°ç¼©å‡äº†ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›æ¯”è¾ƒæ“ä½œçš„æˆæœ¬ï¼Œ<br>æ­¤å¤–ï¼Œè‹¥ <code>operator&lt;=&gt;</code> è¢«å®šä¹‰ä¸º <code>=default</code>ï¼Œé‚£ä¹ˆ <code>==</code>ã€<code>!=</code> ä¹Ÿå°†å¯ç”¨ï¼š  </p><pre><code class="C++">struct Foo&#123;    int data&#123;&#125;;    friend auto operator&lt;=&gt;(Foo, Foo) = default;&#125;;// ä»…ä»…è¿™æ ·å°±èƒ½å¯¹ Foo ç±»å‹å¯¹è±¡ä½¿ç”¨ä»»æ„æ¯”è¾ƒæ“ä½œ</code></pre><p>ç¤ºä¾‹ <a href="https://godbolt.org/z/6a3nfjcPW">godbolt</a>ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;struct A&#123;    int a&#123;&#125;;    auto operator==(A aa)    &#123;        std::cout &lt;&lt; &quot;my A==&quot; &lt;&lt; &quot;\n&quot;;        return a == aa.a;    &#125;    auto operator&lt;=&gt;(A aa)    &#123;        std::cout &lt;&lt; &quot;my A&lt;=&gt;&quot; &lt;&lt; &quot;\n&quot;;        return a &lt;=&gt; aa.a;    &#125;&#125;;int main()&#123;    A a1&#123; 1 &#125;, a2&#123; 1 &#125;;    std::cout &lt;&lt; std::boolalpha;    std::cout &lt;&lt; &quot;==: &quot;  &lt;&lt; (a1 == a2) &lt;&lt; &quot;\n&quot;;    std::cout &lt;&lt; &quot;!=: &quot;  &lt;&lt; (a1 != a2) &lt;&lt; &quot;\n&quot;;    std::cout &lt;&lt; &quot;&lt;=&gt;: &quot; &lt;&lt; ((a1 &lt;=&gt; a2) == 0 ? &quot;eq&quot; : &quot;not eq&quot;) &lt;&lt; &quot;\n&quot;;    std::cout &lt;&lt; &quot;&gt;: &quot;   &lt;&lt; (a1 &gt; a2)  &lt;&lt; &quot;\n&quot;;    std::cout &lt;&lt; &quot;&gt;=: &quot;  &lt;&lt; (a1 &gt;= a2) &lt;&lt; &quot;\n&quot;;    std::cout &lt;&lt; &quot;&lt;: &quot;   &lt;&lt; (a1 &lt; a2)  &lt;&lt; &quot;\n&quot;;    std::cout &lt;&lt; &quot;&lt;=: &quot;  &lt;&lt; (a1 &lt;= a2) &lt;&lt; &quot;\n&quot;;&#125;</code></pre><pre><code class="output">==: my A==true!=: my A==false&lt;=&gt;: my A&lt;=&gt;eq&gt;: my A&lt;=&gt;false&gt;=: my A&lt;=&gt;true&lt;: my A&lt;=&gt;false&lt;=: my A&lt;=&gt;true</code></pre><h3 id="æ¯”è¾ƒè¿ç®—ç¬¦çš„ç‰¹æ®Šé‡è½½è§£æè§„åˆ™"><a href="#æ¯”è¾ƒè¿ç®—ç¬¦çš„ç‰¹æ®Šé‡è½½è§£æè§„åˆ™" class="headerlink" title="æ¯”è¾ƒè¿ç®—ç¬¦çš„ç‰¹æ®Šé‡è½½è§£æè§„åˆ™"></a>æ¯”è¾ƒè¿ç®—ç¬¦çš„ç‰¹æ®Šé‡è½½è§£æè§„åˆ™</h3><p>åœ¨ C++20 ä¹‹å‰ï¼Œå¦‚æœåªæœ‰ <code>operator==(A, int)</code> é‚£ä¹ˆåªæœ‰ <code>a == 123</code> è¿™ç§æ¯”è¾ƒæ–¹å¼èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œä» C++20 èµ·ï¼Œæ­¤æƒ…å†µä¸Š <code>123 == a</code> å°†è¢«è§†ä¸º <code>a == 123</code>ï¼Œé‡è½½å†³è®®é€‰æ‹©æœ€ä½³å€™é€‰ä¸º <code>operator==(A, int)</code>;  </p><p>å¦‚æœæœ‰ <code>operator==(A, int)</code>ã€<code>operator==(A, A)</code>ã€<code>A::A(int)</code>(Açš„é explicit æ„é€ å‡½æ•°)ï¼Œ<code>123 == a</code> å°†è¢«è§†ä¸º <code>a == 123</code>ï¼Œé‡è½½å†³è®®é€‰æ‹©æœ€ä½³å€™é€‰ä¸º <code>operator==(A, int)</code>ï¼Œåœ¨ C++20 å‰ï¼Œè¿™ä¸ªæ“ä½œå°†è¢«è§£é‡Šä¸ºä»å­—é¢é‡ <code>123</code> æ„é€  <code>A</code> å¯¹è±¡ï¼Œå†é€‰æ‹© <code>operator==(A, A)</code> è¿›è¡Œæ¯”è¾ƒæ“ä½œï¼›  </p><p>å¦‚æœæœ‰ <code>A::operator==(int)</code>ã€<code>A::operator==(A)</code>ã€<code>A::A(int)</code>(Açš„é explicit æ„é€ å‡½æ•°)ï¼Œ<code>123 == a</code> å°†è¢«è§†ä¸º <code>a == 123</code>ï¼Œé‡è½½å†³è®®é€‰æ‹©æœ€ä½³å€™é€‰ <code>A::operator==(int)</code>ï¼Œåœ¨ C++20 å‰ï¼Œè¿™ä¸ªæ“ä½œæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚  </p><p>ç¤ºä¾‹ <a href="https://godbolt.org/z/s8ddG873h">godbolt</a>ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;struct A&#123;    int a&#123;&#125;;    A() = default;    A(int i) : a&#123; i &#125; &#123;&#125;    auto operator==(A aa)    &#123;        std::cout &lt;&lt; &quot;my A==A&quot; &lt;&lt; &quot;\n&quot;;        return a == aa.a;    &#125;    auto operator==(int i)    &#123;        std::cout &lt;&lt; &quot;my A==int&quot; &lt;&lt; &quot;\n&quot;;        return a == i;    &#125;&#125;;int main()&#123;    A a1&#123; 1 &#125;, a2&#123; 1 &#125;;    std::cout &lt;&lt; std::boolalpha;        std::cout &lt;&lt; (a1 == 1) &lt;&lt; &quot;\n&quot;;    std::cout &lt;&lt; (1 == a2) &lt;&lt; &quot;\n&quot;; // error before c++20&#125;</code></pre><pre><code class="output">my A==inttruemy A==inttrue</code></pre><p>æ­¤æ“ä½œä¼šå— <code>operator!=</code> å®šä¹‰çš„å½±å“ï¼Œé˜…è¯»ä¸‹æ–¹C++è‰æ¡ˆ 12.2.2.3.4 éƒ¨åˆ†äº†è§£ã€‚  </p><p>è¿˜æœ‰ä¸‹é¢è¿™ä¸ªä¾‹å­ <a href="https://godbolt.org/z/zo4qvMb1E">godbolt</a>ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;struct A&#123;    int a&#123;&#125;;    A() = default;    A(int aa) : a&#123; aa &#125; &#123;&#125;    auto operator==(A aa)    &#123;        std::cout &lt;&lt; &quot;my A==&quot; &lt;&lt; &quot;\n&quot;;        return a == aa.a;    &#125;    auto operator&lt;=&gt;(A aa)    &#123;        std::cout &lt;&lt; &quot;my A&lt;=&gt;&quot; &lt;&lt; &quot;\n&quot;;        return a &lt;=&gt; aa.a;    &#125;    auto operator&lt;(A aa)    &#123;        std::cout &lt;&lt; &quot;my A&lt;&quot; &lt;&lt; &quot;\n&quot;;        return a &lt; aa.a;    &#125;&#125;;int main()&#123;    A a1&#123;&#125;, a2&#123;&#125;;    (void)(123 == a2);    (void)(123 != a2);    (void)(123 &lt;=&gt; a2);    (void)(123 &gt; a2);    (void)(123 &gt;= a2);    (void)(123 &lt; a2); // æœ€ä½³åŒ¹é…æ˜¯ A::operator&lt;=&gt;(A) æ³¨ï¼šreversed                      // 0 &lt; (a2 &lt;=&gt; 123)                      // 0 &lt; (a2 &lt;=&gt; A&#123; 123 &#125;)    (void)(123 &lt;= a2);    (void)(a1 &lt; 123); // æœ€ä½³åŒ¹é…æ˜¯ A::operator&lt;(A)                      // a1 &lt; A&#123; 123 &#125;    (void)(a1 &lt; a2);  // æœ€ä½³åŒ¹é…æ˜¯ A::operator&lt;(A)&#125;</code></pre><pre><code class="output">my A==my A==my A&lt;=&gt;my A&lt;=&gt;my A&lt;=&gt;my A&lt;=&gt;my A&lt;=&gt;my A&lt;my A&lt;</code></pre><p>é˜…è¯»ä¸‹æ–¹C++è‰æ¡ˆ 12.2.2.3.9 éƒ¨åˆ†äº†è§£ã€‚  </p><p>ä»æŸç§æ„ä¹‰ä¸Šè®²ï¼Œ<code>lhs op rhs</code> å’Œ <code>operator op(lhs, rhs)</code> çš„ä¸åŒä¹‹å¤„åˆå¢åŠ äº†ï¼Œå¦‚æœ <code>op</code> å®é™…ä¸Šæ˜¯ <code>operator==</code> æˆ– <code>operator&lt;=&gt;</code> ç»ç‰¹æ®Šå¤„ç†è€Œæ¥ï¼Œè€Œä¸æ˜¯è¢«så£°æ˜çš„è¿ç®—ç¬¦é‡è½½å‡½æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨åè€…çš„å½¢å¼åº”è¯¥ä¼šå¾—åˆ°ä¸€ä¸ªè°ƒç”¨æœªå£°æ˜å‡½æ•°çš„é”™è¯¯(<a href="https://godbolt.org/z/jrEq91WG9">godbolt</a>)ã€‚  </p><h3 id="C-è‰æ¡ˆæ‘˜å½•"><a href="#C-è‰æ¡ˆæ‘˜å½•" class="headerlink" title="C++è‰æ¡ˆæ‘˜å½•"></a>C++è‰æ¡ˆæ‘˜å½•</h3><blockquote><p>12.2.2.3 Operators in expressions  </p><p>â€¦  </p><p>4  </p><p>A non-template function or function template F named operator&#x3D;&#x3D; is a rewrite target with first operand o unless a search for the name operator!&#x3D; in the scope S from the instantiation context of the operator expression finds a function or function template that would correspond ([basic.scope.scope]) to F if its name were operator&#x3D;&#x3D;, where S is the scope of the class type of o if F is a class member, and the namespace scope of which F is a member otherwise. A function template specialization named operator&#x3D;&#x3D; is a rewrite target if its function template is a rewrite target.<br>[Example 2:â€‚ </p><pre><code class="C++">struct A &#123;&#125;;  template&lt;typename T&gt; bool operator==(A, T);     // #1  bool a1 = 0 == A();                             // OK, calls reversed #1  template&lt;typename T&gt; bool operator!=(A, T);  bool a2 = 0 == A();                             // error, #1 is not a rewrite target   struct B &#123;      bool operator==(const B&amp;);    // #2  &#125;;  struct C : B &#123;      C();      C(B);      bool operator!=(const B&amp;);    // #3  &#125;;bool c1 = B() == C();           // OK, calls #2; reversed #2 is not a candidate// because search for operator!= in C finds #3bool c2 = C() == B();           // error: ambiguous between #2 found when searching C and                                // reversed #2 found when searching Bstruct D &#123;&#125;;template&lt;typename T&gt; bool operator==(D, T);       // #4inline namespace N &#123;    template&lt;typename T&gt; bool operator!=(D, T);   // #5&#125;bool d1 = 0 == D();             // OK, calls reversed #4; #5 does not forbid #4 as a rewrite target</code></pre><p>â€” end example]  </p><p>â€¦  </p><p>9  </p><p>If a rewritten operator&lt;&#x3D;&gt; candidate is selected by overload resolution for an operator @, x @ y is interpreted as 0 @ (y &lt;&#x3D;&gt; x) if the selected candidate is a synthesized candidate with reversed order of parameters, or (x &lt;&#x3D;&gt; y) @ 0 otherwise, using the selected rewritten operator&lt;&#x3D;&gt; candidate. Rewritten candidates for the operator @ are not considered in the context of the resulting expression.  </p><p>10  </p><p>If a rewritten operator&#x3D;&#x3D; candidate is selected by overload resolution for an operator @, its return type shall be cv bool, and x @ y is interpreted as:<br>(10.1)<br>if @ is !&#x3D; and the selected candidate is a synthesized candidate with reversed order of parameters, !(y &#x3D;&#x3D; x),<br>(10.2)<br>otherwise, if @ is !&#x3D;, !(x &#x3D;&#x3D; y),<br>(10.3)<br>otherwise (when @ is &#x3D;&#x3D;), y &#x3D;&#x3D; x,<br>in each case using the selected rewritten operator&#x3D;&#x3D; candidate.  </p></blockquote><p><a href="https://eel.is/c++draft/over.match">å®Œæ•´ C++ è‰æ¡ˆ</a>  </p>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
          <category> CPP20 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> CPP20 </tag>
            
            <tag> çŒä¸åŠé˜²ç³»åˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MSDNä¸­Direct2Då¿«é€Ÿå…¥é—¨é¡µé¢ä¸­çš„ç–æ¼</title>
      <link href="/2024/02/12/Omissions-in-MSDN-Getting-Started-with-Direct2d/"/>
      <url>/2024/02/12/Omissions-in-MSDN-Getting-Started-with-Direct2d/</url>
      
        <content type="html"><![CDATA[<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>MSDNæ–‡ç« <a href="https://learn.microsoft.com/zh-cn/windows/win32/direct2d/getting-started-with-direct2d#step-5-draw-the-rectangle">Direct2Då¿«é€Ÿå…¥é—¨-æ­¥éª¤ 5ï¼šç»˜åˆ¶çŸ©å½¢</a>ä¸­ç»™å‡ºçš„ä»£ç å¦‚ä¸‹ï¼š  </p><pre><code class="C++">pRT-&gt;BeginDraw();pRT-&gt;DrawRectangle(    D2D1::RectF(        rc.left + 100.0f,        rc.top + 100.0f,        rc.right - 100.0f,        rc.bottom - 100.0f),        pBlackBrush);HRESULT hr = pRT-&gt;EndDraw();</code></pre><p>æ­¤å¤„è°ƒç”¨ <code>ID2D1HwndRenderTarget::BeginDraw</code> åæ²¡æœ‰ä½¿ç”¨ <code>ID2D1HwndRenderTarget::Clear</code> æˆå‘˜å‡½æ•°æ‰§è¡Œæ¸…å±æ“ä½œï¼Œå¹¶ä¸”æˆ‘ä»¬åˆ›å»ºçš„ç”»ç¬”æ˜¯é»‘è‰²ç”»ç¬”ã€‚åœ¨å°†ä¸Šè¿°ä»£ç æ”¾è¿› <code>case WM_PAINT:</code> åï¼Œåœ¨æˆ‘çš„ç”µè„‘ä¸Šæ¸²æŸ“æ•ˆæœæ˜¯ä¸€ç‰‡æ¼†é»‘ï¼š  </p><img src="display_bug.png" alt="æ•ˆæœå›¾" data-align="center">  <p>åŠ ä¸Šæ¸…å±æ“ä½œå³å¯ï¼š  </p><img src="display.png" alt="æ•ˆæœå›¾" data-align="center">  <p>åœ¨<a href="https://learn.microsoft.com/zh-cn/windows/win32/direct2d/direct2d-quickstart#part-4-render-direct2d-content">åˆ›å»ºç®€å•çš„ Direct2D åº”ç”¨ç¨‹åº - ç¬¬4éƒ¨åˆ†ï¼šå‘ˆç° Direct2D å†…å®¹ - 4.</a> è¿™éƒ¨åˆ†å†…å®¹ä¸­ï¼Œåˆ™æåˆ°äº†æ¸…å±æ“ä½œã€‚é™¤äº†æ¸…å±ï¼Œè¿˜æœ‰åœ¨ <code>ID2D1HwndRenderTarget::EndDraw</code> åè°ƒç”¨ <code>ValidateRect</code> å‡½æ•°é˜»æ­¢ç³»ç»ŸæŒç»­ç”Ÿæˆ <code>WM_PAINT</code> æ¶ˆæ¯ç­‰ã€‚  </p><p>æ­¤å¤–ï¼Œåœ¨æ‹–æ‹½çª—å£æ—¶æ¸²æŸ“çš„ç”»é¢æœ‰é—ªçƒç°è±¡ï¼Œé˜»æ­¢ <code>WM_ERASEBKGND</code> æ¶ˆæ¯çš„é»˜è®¤å¤„ç†å³å¯é¿å…ï¼š  </p><pre><code class="C++">class D2DWindow : public Petal::Window&#123;public:    Petal::win32lres Process(        Petal::win32msg  message,         Petal::win32wprm w_param,         Petal::win32lprm l_param    ) noexcept override // ç”¨äºæˆ‘çš„æ¡†æ¶çš„çª—å£è¿‡ç¨‹å‡½æ•°çš„é€»è¾‘éƒ¨åˆ†    &#123;        if (message == WM_ERASEBKGND) return 0; // é˜²æ­¢é—ªçƒ        return Window::Process(message, w_param, l_param);    &#125;    ... // å…¶ä»–å†…å®¹&#125;// æ”¹å†™ä¸º WIN32 çš„å½¢å¼LRESULT CALLBACK MyWndProc(HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam)&#123;    switch (msg)    &#123;    case WM_ERASEBKGND:        return 0;        ... // å…¶ä»–å†…å®¹    &#125;    ... // å…¶ä»–å†…å®¹&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> DX </category>
          
          <category> D2D </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DX </tag>
            
            <tag> D2D </tag>
            
            <tag> MSDN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++20 æ¯”å®æ›´å¥½ç”¨çš„source_location</title>
      <link href="/2024/02/09/The-source-location-Better-Than-Macro/"/>
      <url>/2024/02/09/The-source-location-Better-Than-Macro/</url>
      
        <content type="html"><![CDATA[<h3 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h3><pre><code class="C++">// ä½ ä¸ä¼šå–œæ¬¢è¿™ä¸ª#if defined(_UNICODE) || defined(UNICODE)#define MY_FILET __FILEW__#else#define MY_FILET __FILE__#endif#define MY_THROW_IF_FAILED(code) \    ::my::ThrowIfFailed(code, TEXT(#code), MY_FILET, __LINE__);</code></pre><a href="#æ³¨"><div><i>åœ¨è¿‡å»çš„æ—¥å­é‡Œï¼Œé‚ªæ¶å½“é“ï¼</i><br /><p align="right"><i>â€”â€”Kristen Nygaard</i></p></div><div><i>è€Œä¸”ï¼Œæˆ‘è¿˜æŒæœ‰è¿™æ ·çš„è§‚ç‚¹ï¼šCppå¿…é¡»è¢«æ‘§æ¯ã€‚</i><br />  <p align="right"><i>â€”â€”è€åŠ å›¾ï¼ˆMarcus Porcius Catoï¼‰</i></p><br />  </div>  </a><h3 id="æ›¾ç»å½“ä¸‹å¯ç”¨çš„C"><a href="#æ›¾ç»å½“ä¸‹å¯ç”¨çš„C" class="headerlink" title="æ›¾ç»å½“ä¸‹å¯ç”¨çš„C++"></a>æ›¾ç»å½“ä¸‹å¯ç”¨çš„C++</h3><p>åœ¨<text id="dragon">ã€ŠDX12 3D æ¸¸æˆå¼€å‘å®æˆ˜ã€‹</text>å‡ºç‰ˆä¹‹é™…(æŒ‡è‹±æ–‡åŸç‰ˆï¼Œå‡ºç‰ˆæ—¥æœŸ2016&#x2F;03&#x2F;24ï¼Œå¼•ç”¨è‡ª<a href="https://www.amazon.com/Introduction-3D-Game-Programming-DirectX/dp/1942270062">äºšé©¬é€Š</a>)ï¼ŒC++è¿˜å¤„äºå‡†å¤‡è¿ˆå…¥C++17çš„æ—¶ä»£ã€‚â€œ<a href="#%E5%BC%95">å¼•</a>â€ä¸­çš„ä»£ç æ˜¯å…¶ä¸­ç¤ºä¾‹çš„ä¸€ä¸ªå˜å½¢ï¼šAPIå¾€å¾€è¿”å›ä¸€ä¸ª<code>HRESULT</code>ç±»å‹çš„å€¼(å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§é”™è¯¯ç )ï¼Œç„¶åæˆ‘ä»¬å¯é€šè¿‡<code>FAILED</code>å®æ¥æ£€æµ‹è¿”å›å€¼æ˜¯å¦ä»£è¡¨å¤±è´¥ã€‚å¦‚æœå¤±è´¥ï¼Œè¿˜è¦è°ƒç”¨<code>_com_error::ErrorMessgae</code>æ¥è·å–å¤±è´¥ä¿¡æ¯ï¼Œå¹¶å°†æ–‡ä»¶åã€è¡Œå·ã€ä»£ç å’Œé”™è¯¯ä¿¡æ¯ä¸€å¹¶å¡åˆ°ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±»çš„å¯¹è±¡é‡Œï¼Œå¹¶æŠ›å‡ºå®ƒã€‚åœ¨ç¨‹åºå‡ºé”™æ—¶ï¼Œè¿™äº›ä¿¡æ¯å¯¹æ­£åœ¨å­¦ä¹ D3Dçš„äººå°†å¾ˆæœ‰å¸®åŠ©ã€‚  </p><p>â€œå¼•â€ä¸­çš„ä»£ç æ˜¯æˆ‘æ ¹æ®è®°å¿†æ”¹å†™çš„ï¼Œå¯ä»¥å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬æ— Cpp(Cè¯­è¨€é¢„å¤„ç†å™¨)å¯ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¸å¾—ä¸åœ¨æ¯æ¬¡è°ƒç”¨<code>my::ThrowIfFailed</code>è¿™ä¸ªå‡½æ•°æ—¶æ‰‹åŠ¨å¡«å†™<code>__FILE__</code>&#x2F;<code>__FILEW__</code>å’Œ<code>__LINE__</code>ï¼Œä½œä¸ºç¬¬ä¸‰å’Œç¬¬å››ä¸ªå‚æ•°ï¼Œå¯¹äºå¤§é‡çš„æ£€æµ‹éœ€æ±‚ï¼Œæ‰‹å·¥ä»£ç ä»£ä»·é«˜æ˜‚ï¼Œè€—å°½äº†æˆ‘ä»¬çš„ç²¾åŠ›â€¦â€¦</p><h4 id="ä¸ºä»€ä¹ˆæ˜¯å®"><a href="#ä¸ºä»€ä¹ˆæ˜¯å®" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯å®"></a>ä¸ºä»€ä¹ˆæ˜¯å®</h4><p>å®æˆ–è€…ä¸æ˜¯ä¸€ä¸ªå®ï¼Œè¿™æ˜¯ä¸ªé—®é¢˜ã€‚æœ‰ä»€ä¹ˆè¯¡è®¡èƒ½è®©æˆ‘ä»¬åŒæ—¶é¿å…å®å’Œæ‰‹åŠ¨å¡«å†™å‚æ•°å—ï¼Ÿæœ‰äººå¯èƒ½ä¼šæƒ³åˆ°ç»™å‡½æ•°å¡«å†™é»˜è®¤å‚æ•°ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œå‡½æ•°é»˜è®¤å‚æ•°æ˜¯è¡Œä¸é€šçš„ï¼Œè¿™ç§æ–¹æ³•ä¸èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚æœ€åæˆ‘ä»¬å¦¥åäº†ï¼Œé€‰æ‹©äº†å®â€”â€”å¦‚æœæœ‰å…¶ä»–æ›´å¥½çš„åŠæ³•ï¼Œå¼—å…°å…‹å”å”ä¸ºä»€ä¹ˆä¸å‘Šè¯‰æˆ‘ä»¬å‘¢ï¼Ÿæˆ‘è®°å¾—<a href="https://www.amazon.com/Introduction-3D-Game-Programming-DirectX/dp/1942270062">é¾™ä¹¦</a>ä½œè€…æ›¾åœ¨ä¹¦é‡Œé˜è¿°è¿‡åŸå› ï¼Œå¦‚æœä½ äº†è§£å®åªæ˜¯ç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼Œä½ ä¹Ÿèƒ½é©¬ä¸Šæ˜ç™½åŸå› æ‰€åœ¨ã€‚é¢„å¤„ç†èƒ½è®©å® <code>__FILE__</code>ã€<code>__LINE__</code> å‡ºç°åœ¨æºæ–‡ä»¶ä¸­æ­£ç¡®çš„ä½ç½®ï¼Œæ­¤å¤„å°±ä¸èµ˜è¿°äº†ã€‚  </p><p>æ­¤å¤–ï¼Œ<code>TEXT(#code)</code> è¿™æ ·çš„ä¸œè¥¿åªé€‚ç”¨äºMSVCï¼Œåœ¨ gcc ç­‰å¹³å°æ— æ³•é€šè¿‡ç¼–è¯‘(å¦‚æœ‰å…´è¶£å¯ä»¥è¯¦ç»†æŸ¥çœ‹é¢„å¤„ç†å™¨çš„é‚£äº›è§„åˆ™)ï¼Œå…¶ä¸­<code>TEXT</code>æ˜¯å®ï¼Œå¯èƒ½çš„å®ç°ï¼š  </p><pre><code class="C++">#if defined(_UNICODE) || defined(UNICODE)#define TEXT(quote) L##quote#else#define TEXT(quote) quote#endif</code></pre><p>æµ‹è¯•ä»¥é»˜è®¤å‚æ•°çš„å½¢å¼å®ç°ä¸ThrowIfFailedç›¸ä¼¼çš„ä»£ç ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;string&gt;void bad_log(std::string_view msg, const char* caller, const char* file = __FILE__, int line = __LINE__)&#123;    std::cout        &lt;&lt; &quot;FILE: &quot; &lt;&lt; file &lt;&lt; &quot; LINE: &quot; &lt;&lt; line &lt;&lt; &quot; CALLER: &quot; &lt;&lt; caller        &lt;&lt; &quot; MSG: &quot; &lt;&lt; msg &lt;&lt; &quot;\n&quot;;&#125;int main()&#123;    bad_log(&quot;Hell&quot;, __FUNCTION__);    bad_log(&quot;Hell&quot;, __func__);&#125;</code></pre><p>å¯èƒ½çš„è¾“å‡ºï¼š</p><pre><code>FILE: xxx/main.cpp LINE: 5 CALLER: main MSG: HellFILE: xxx/main.cpp LINE: 5 CALLER: main MSG: Hell</code></pre><p>å¾ˆæ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬è¦çš„æ•ˆæœï¼Œåœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œä¸ç®¡åœ¨å“ªé‡Œä½¿ç”¨é»˜è®¤å‚æ•°è°ƒç”¨<code>bad_log</code>ï¼Œå®ƒçš„å®å‚<code>line</code>æ€»æ˜¯<code>5</code>ï¼Œç”±äº<code>bad_log</code>è°ƒç”¨å’Œ<code>bad_log</code>çš„å£°æ˜åŒå¤„ä¸€ä¸ªæºæ–‡ä»¶ï¼Œå®ƒèƒ½ä»¥æˆ‘ä»¬æœŸæœ›çš„æ–¹å¼å·¥ä½œï¼Œä½†è¿™ä¸å¤Ÿï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¤´æ–‡ä»¶é‡Œå¯¹<code>bad_log</code>è¿›è¡Œå£°æ˜(åŒ…æ‹¬é»˜è®¤å‚æ•°çš„å®šä¹‰)ï¼Œå®ƒå°†ä¸èƒ½æŒ‰æˆ‘ä»¬çš„æ„æ„¿å·¥ä½œ(å€¼æ€»æ˜¯ä»£è¡¨å£°æ˜å®ƒçš„å¤´æ–‡ä»¶çš„åç§°ï¼Œä½¿ç”¨MSVCæµ‹è¯•)ã€‚<br>ç®€è€Œè¨€ä¹‹ï¼šOnly MACRO can do.  </p><h3 id="å½“ä¸‹å¯ç”¨çš„C"><a href="#å½“ä¸‹å¯ç”¨çš„C" class="headerlink" title="å½“ä¸‹å¯ç”¨çš„C++"></a>å½“ä¸‹å¯ç”¨çš„C++</h3><p>æˆ‘åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæ­£å€¼é™¤å¤•(å®é™…å†™åˆ°è¿™é‡Œæ—¶å·²ç»åˆ°æ­£æœˆåˆä¸€äº†)ï¼Œå¯ä»¥è¯´å„ç§æ„ä¹‰ä¸Šéƒ½è¿›å…¥2024å¹´äº†ã€‚C++23å°šä¸”ä¸èƒ½è¢«æ”¯æŒå®Œå–„ï¼Œä½†æ˜¯C++20å¯ç”¨ã€‚ç„¶è€Œå°±åœ¨C++20ä¸­ï¼Œæ ‡å‡†åº“ä¸­å¢åŠ äº†<code>std::source_location</code>ï¼Œä»¥è§£å†³æˆ‘ä»¬çš„ç‡ƒçœ‰ä¹‹æ€¥ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;source_location&gt;void log(std::string_view msg = &quot;&quot;, const std::source_location&amp; location = std::source_location::current())&#123;    std::cout        &lt;&lt; &quot;FILE: &quot;    &lt;&lt; location.file_name()        &lt;&lt; &quot;(&quot;         &lt;&lt; location.line() &lt;&lt; &quot;,&quot; &lt;&lt; location.column() &lt;&lt; &quot;)&quot;        &lt;&lt; &quot; CALLER: &quot; &lt;&lt; location.function_name()        &lt;&lt; &quot; MSG: &quot;    &lt;&lt; msg &lt;&lt; &quot;\n&quot;;&#125;int main()&#123;    log(&quot;Hello&quot;);&#125;</code></pre><p>å¯èƒ½çš„è¾“å‡º(MSVC)ï¼š</p><pre><code>FILE: xxx/main.cpp(16,2) CALLER: int __cdecl main(void) MSG: Hello</code></pre><p>æ³¨ï¼šå…¨éƒ¨ä½¿ç”¨<code>TAB</code>è¡¨ç¤ºç¼©è¿›è€Œéç©ºæ ¼ï¼ˆè¿™ä¼šå½±å“<code>column</code>çš„è¿”å›å€¼ï¼Œå¦‚æœä½¿ç”¨å››ä¸ªç©ºæ ¼è¡¨ç¤ºç¼©è¿›ï¼Œæˆ‘æƒ³<code>column</code>çš„è¿”å›å€¼ä¼šæ˜¯<code>5</code>ï¼‰ã€‚  </p><p>è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><h4 id="std-source-location-current"><a href="#std-source-location-current" class="headerlink" title="std::source_location::current"></a>std::source_location::current</h4><p><code>std::source_location::current</code>å‡½æ•°å°†æ„é€ ä¸€ä¸ªè¡¨ç¤ºè°ƒç”¨ä½ç½®çš„ source_location å¯¹è±¡ã€‚  </p><p>è‹¥ç›´æ¥è°ƒç”¨ <code>current()</code> ï¼ˆé€šè¿‡æŒ‡å <code>current()</code> çš„å‡½æ•°è°ƒç”¨ï¼‰ï¼Œåˆ™å®ƒè¿”å›å¯¹åº”è°ƒç”¨ä½ç½®çš„æ‹¥æœ‰å®ç°å®šä¹‰å€¼çš„ <code>source_location</code> å¯¹è±¡ã€‚è¯¥å€¼åº”å½“ä»¥åŒé¢„å®šä¹‰å® <code>__LINE__</code> ä¸ <code>__FILE__</code> çš„æ–¹å¼å— <code>#line</code> é¢„å¤„ç†æŒ‡ä»¤å½±å“ã€‚<br>è‹¥åœ¨é»˜è®¤æˆå‘˜åˆå§‹åŒ–å™¨ä¸­ä½¿ç”¨ <code>current()</code>ï¼Œåˆ™è¿”å›å€¼å¯¹åº”åˆå§‹åŒ–è¯¥æ•°æ®æˆå‘˜çš„æ„é€ å‡½æ•°å®šä¹‰æˆ–èšåˆåˆå§‹åŒ–çš„ä½ç½®ã€‚<br>è‹¥ <code>current()</code> ç”¨äºé»˜è®¤å‚æ•°ï¼Œåˆ™è¿”å›å€¼å¯¹åº”å¯¹ <code>current()</code> çš„è°ƒç”¨çš„è°ƒç”¨ç‚¹ä½ç½®ã€‚<br>è‹¥ä»¥ä»»ä½•å…¶ä»–æ–¹å¼è°ƒç”¨ <code>current()</code> ï¼Œåˆ™è¿”å›å€¼æœªæŒ‡å®šã€‚  </p><p>æ³¨ï¼š<code>std::source_location::current</code> é€šå¸¸è¦æ±‚ç¼–è¯‘å™¨çš„å†…å»ºå®ç°ã€‚  </p><p>ä»¥ä¸Šæ˜¯ <a href="https://zh.cppreference.com/w/cpp/utility/source_location">c++ reference</a> ä¸­çš„æè¿°(ç¨æœ‰æ”¹åŠ¨)ã€‚<br>ä»¥ä¸‹æ˜¯æˆ‘å†™çš„ç¤ºä¾‹ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;source_location&gt;// curr line: 4void log(std::string_view msg = &quot;&quot;, const std::source_location&amp; location = std::source_location::current())&#123;    std::cout        &lt;&lt; &quot;FILE: &quot; &lt;&lt; location.file_name()        &lt;&lt; &quot;(&quot; &lt;&lt; location.line() &lt;&lt; &quot;,&quot; &lt;&lt; location.column() &lt;&lt; &quot;)&quot;        &lt;&lt; &quot; CALLER: &quot; &lt;&lt; location.function_name()        &lt;&lt; &quot; MSG: &quot; &lt;&lt; msg &lt;&lt; &quot;\n&quot;;&#125;// curr line: 13struct T1 // ä½¿ç”¨é»˜è®¤æˆå‘˜åˆå§‹åŒ–å™¨&#123;    std::source_location loc = std::source_location::current();&#125;;// curr line: 18struct T2 // ä½¿ç”¨æ„é€ å‡½æ•°çš„æˆå‘˜åˆå§‹åŒ–å™¨åˆ—è¡¨&#123;    T2() : loc&#123; std::source_location::current() &#125; &#123;&#125;    std::source_location loc;&#125;;// curr line: 24struct T3 // å°†åœ¨mainå‡½æ•°ä¸­ä½¿ç”¨èšåˆåˆå§‹åŒ–&#123;    std::source_location loc;&#125;;// curr line: 29int main()&#123;    T1 t1&#123;&#125;; // curr line: 32    log(&quot;T1&quot;, t1.loc);    T2 t2&#123;&#125;; // curr line: 34    log(&quot;T2&quot;, t2.loc);    T3 t3&#123; std::source_location::current() &#125;; // curr line: 36    log(&quot;T3&quot;, t3.loc);    return 0;&#125;</code></pre><p>å¯èƒ½çš„è¾“å‡º(MSVC)ï¼š  </p><pre><code>FILE: xxx\main.cpp(32,8) CALLER: int __cdecl main(void) MSG: T1FILE: xxx\main.cpp(21,36) CALLER: __cdecl T2::T2(void) MSG: T2FILE: xxx\main.cpp(36,31) CALLER: int __cdecl main(void) MSG: T3</code></pre><p>é¢„å¤„ç†æŒ‡ä»¤ <code>#line</code> å½±å“ <code>std::source_location::current</code> çš„ä¾‹å­ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;source_location&gt;void log(std::string_view msg = &quot;&quot;, const std::source_location&amp; location = std::source_location::current())&#123;    std::cout        &lt;&lt; &quot;FILE: &quot; &lt;&lt; location.file_name()        &lt;&lt; &quot;(&quot; &lt;&lt; location.line() &lt;&lt; &quot;,&quot; &lt;&lt; location.column() &lt;&lt; &quot;)&quot;        &lt;&lt; &quot; CALLER: &quot; &lt;&lt; location.function_name()        &lt;&lt; &quot; MSG: &quot; &lt;&lt; msg &lt;&lt; &quot;\n&quot;;&#125;int main()&#123;#line 123456 &quot;foo.cpp&quot;    u8&quot;ğŸ˜&quot;; // __LINE__: 123456    log(&quot;after #line&quot;, std::source_location::current());  // __LINE__: 123457    return 0;&#125;</code></pre><p>å¯èƒ½çš„è¾“å‡º(MSVC)ï¼š  </p><pre><code>FILE: xxx\foo.cpp(123457,43) CALLER: int __cdecl main(void) MSG: after #line</code></pre><p>é¢„å¤„ç†æŒ‡ä»¤ <code>#line</code> çš„ <a href="https://zh.cppreference.com/w/cpp/preprocessor/line" title="é¢„å¤„ç†æŒ‡ä»¤ #line">c++ reference</a>ã€‚  </p><h3 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h3><p>åœ¨ä½¿ç”¨C++æ—¶ï¼Œæ€»ä¼šå¬åˆ°åˆ«äººå»ºè®®â€œå°½é‡é¿å…ä½¿ç”¨å®â€ç­‰ã€‚æ­£å¦‚é¢˜æ³¨æ‰€éšå«çš„ä¿¡æ¯ï¼Œæœ¬è´¾å°¼å°±ä¸å–œæ¬¢Cè¯­è¨€é¢„å¤„ç†å™¨ï¼ŒC++ä¹Ÿåœ¨ç«­åŠ›æä¾›ä¸ä¾é é¢„å¤„ç†å™¨çš„é€‰æ‹©ï¼Œæ¯”å¦‚æ¨¡æ¿ä½¿å¾—ç¨‹åºå‘˜ä¸å¿…å†ä½¿ç”¨å®æ¥æ³›å‹ç¼–ç¨‹ã€æ¨¡å—ä½¿å¾—ç¨‹åºå‘˜æ‘†è„±<code>#include</code>æŒ‡ä»¤æ˜¯å”¯ä¸€é€‰æ‹©çš„å¢ƒåœ°ã€åŒ…æ‹¬æœ¬æ–‡æ‰€æåˆ°çš„<code>std::source_location</code>ä¹Ÿæ·¡åŒ–äº†ä½¿ç”¨<code>__FILE__</code>å’Œ<code>__LINE__</code>çš„å¿…è¦æ€§ï¼Œæ¯•ç«Ÿï¼Œæˆ‘ä»¬ç°åœ¨æœ‰æ–°çš„ã€æ›´ä¼˜çš„æ–¹å¼è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚  </p><p>åœ¨æ²¡æœ‰æ¨¡æ¿çš„æ—¶æœŸç¼–å†™ä¸€ä¸ªæ”¯æŒæ³›å‹çš„å·¥å…· be likeï¼š  </p><pre><code class="CC">// stack.hclass ELEM_stack&#123;    ELEM *min, *top, *max;    ...&#125;</code></pre><pre><code class="CC">// main.cpp#define ELEM int#define ELEM_stack int_stack#include &quot;stack.h&quot;#undef ELEM#undef ELEM_stack#define ELEM float#define ELEM_stack float_stack#include &quot;stack.h&quot;#undef ELEM#undef ELEM_stackint_stack is;float_stack fs;</code></pre><blockquote><p>æºè‡ªã€ŠC++è¯­è¨€çš„è®¾è®¡å’Œæ¼”åŒ–ã€‹(2.9.2 æ²¡æœ‰æ¨¡æ¿æ—¶çš„å®¹å™¨ç±»)ã€‚</p></blockquote><h3 id="æ³¨"><a href="#æ³¨" class="headerlink" title="æ³¨"></a>æ³¨</h3><h4 id="å¼•-1"><a href="#å¼•-1" class="headerlink" title="_å¼•"></a>_å¼•</h4><p><em>è¿™<a href="#%E5%BC%95">ä¸¤å¥è¯</a>åˆ†åˆ«ä¸ºã€ŠC++è¯­è¨€è®¾è®¡ä¸æ¼”åŒ–ã€‹çš„ç¬¬ä¸€ç« ã€ŠC++çš„å²å‰æ—¶ä»£ã€‹ä¸æœ€åä¸€ç« ã€ŠCè¯­è¨€é¢„å¤„ç†å™¨ã€‹çš„é¢˜è®°ï¼ˆå¼•ç”¨çš„æ˜¯ä¸­æ–‡è¯‘æœ¬ï¼Œè£˜å®—ç‡•è¯‘ã€‚é¢˜è®°ä¸­çš„â€œCppâ€æŒ‡â€œCè¯­è¨€é¢„å¤„ç†å™¨â€”â€”C Preprocessorâ€ï¼‰ã€‚è€åŠ å›¾æ˜¯å¤ç½—é©¬æ”¿æ²»å®¶ï¼Œè€åŠ å›¾è‡ªç„¶ä¸å¯èƒ½å¯¹Cè¯­è¨€é¢„å¤„ç†å™¨æœ‰ä»€ä¹ˆæ„è§ï¼Œè¿™å¥è¯æ˜¯æ¨¡ä»¿çš„è€åŠ å›¾çš„åè¨€ï¼šè¿¦å¤ªåŸºå¿…é¡»è¢«æ‘§æ¯ã€‚</em>  </p>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
          <category> CPP20 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> CPP20 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†äº«VS2022Previewæ–°UI</title>
      <link href="/2024/02/03/Try-VS2022Preview-New-UI/"/>
      <url>/2024/02/03/Try-VS2022Preview-New-UI/</url>
      
        <content type="html"><![CDATA[<h3 id="æ ‡é¢˜äº”ä¸ªå­—"><a href="#æ ‡é¢˜äº”ä¸ªå­—" class="headerlink" title="æ ‡é¢˜äº”ä¸ªå­—"></a>æ ‡é¢˜äº”ä¸ªå­—</h3><img src="img.png" alt="æ•ˆæœå›¾" data-align="center"><ul><li>Microsoft Visual Studio Community 2022 (64 ä½) - Preview</li><li>ç‰ˆæœ¬ 17.9.0 Preview 5.0</li></ul><p>æ¼‚äº®å¾—å¾ˆå‘ï¼Œ<del>ç”¨ä¸Šæ–° ui ç«‹é©¬å°±è§‰å¾—è€ ui ä¸‘åˆ°çœ‹ä¸ä¸‹å»äº†</del>ã€‚</p><img src="meme_alice_kawaii.jpg" width="330" height="261" data-align="center">]]></content>
      
      
      <categories>
          
          <category> æ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¥å¸¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cé£æ ¼å­—ç¬¦ä¸²ä¸CPPçš„çŸ›ç›¾</title>
      <link href="/2024/01/16/The-Conflict-Between-C-Style-String-and-CPP/"/>
      <url>/2024/01/16/The-Conflict-Between-C-Style-String-and-CPP/</url>
      
        <content type="html"><![CDATA[<style>.rev {    color: #101595;}</style><h3 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h3><img src="blue_pen.jpg" alt="è“çš„ç›†" width="353" height="264" data-align="center"><p>å£°æ˜ï¼šä¹±å†™çš„ã€‚  </p><h3 id="é™ˆè¿°"><a href="#é™ˆè¿°" class="headerlink" title="é™ˆè¿°"></a>é™ˆè¿°</h3><ol><li>å­—ç¬¦ä¸²å­—é¢é‡æŒæœ‰ç±»å‹ <code>const char_t[N]</code>ï¼Œå­—ç¬¦ä¸²é•¿åº¦ç­‰äº <code>N-1</code>ï¼›  </li><li>å­—ç¬¦ä¸²å­—é¢é‡ä¿è¯ null terminatedï¼Œ <code>&quot;...&quot;[N-1]</code> ä¸º NULï¼Œå…¶ä¸­Næ˜¯(1)ä¸­çš„Nï¼›  </li><li>Cé£æ ¼å­—ç¬¦ä¸²ä»¥NULå­—ç¬¦è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸï¼›  </li><li>å­—ç¬¦ä¸²å­—é¢é‡é€šå¸¸è¢«ç”¨ä»¥è¡¨ç¤ºCé£æ ¼å­—ç¬¦ä¸²ï¼›  </li><li>å­—ç¬¦æ•°ç»„å¯¹è±¡é€€åŒ–ä¸ºæŒ‡é’ˆï¼Œä¸¢å¤±æ•°ç»„å¤§å°ä¿¡æ¯ï¼Œå®¹æ˜“äº§ç”Ÿè¶Šç•Œè®¿é—®ç”šè‡³å¼•èµ·é”™è¯¯ï¼›  </li><li>å­—ç¬¦ä¸²å­—é¢é‡æ‰€è¡¨ç¤ºçš„Cé£æ ¼å­—ç¬¦ä¸²é€šå¸¸ä»¥ <code>const char*</code> çš„å½¢å¼è¢«å¼•ç”¨ï¼›  </li><li>ä»ç±»å‹ä¸Šæ— æ³•åŒºåˆ†å­—ç¬¦ä¸²å­—é¢é‡å’Œå­—ç¬¦æ•°ç»„(<code>const char[N]</code>)ï¼›  </li><li>å‡½æ•°æ— æ³•åŒºåˆ†å®å‚æ˜¯å­—ç¬¦ä¸²å­—é¢é‡è¿˜æ˜¯å­—ç¬¦æ•°ç»„ï¼›  </li><li>Cé£æ ¼APIçš„å‚æ•°åˆ—è¡¨ <code>(const char* str, size_t len)</code> å¯¹å®‰å…¨çš„ä¿è¯æ— æµäºäº‹ï¼›  </li><li><code>std::string</code> ä¸åŒäºCé£æ ¼å­—ç¬¦ä¸²ï¼Œå®ƒå…è®¸å­—ç¬¦ä¸²å†…å­˜åœ¨NULå­—ç¬¦ï¼›  </li><li><code>std::string</code> ä¿è¯ null terminatedï¼Œä¿è¯è¢«å½“ä½œCé£æ ¼å­—ç¬¦ä¸²æ—¶ç¬¦åˆâ€œä»¥NULç»“å°¾â€çš„è§„åˆ™ï¼›  </li><li><code>std::string</code> æä¾›äº† <code>c_str</code> æˆå‘˜å‡½æ•°ï¼›  </li><li>å½“ <code>std::string</code> å­—ç¬¦ä¸²å†…å­˜åœ¨NULå­—ç¬¦æ—¶ï¼ŒæŒ‰Cé£æ ¼å­—ç¬¦ä¸²çš„è§„åˆ™ï¼Œ<code>c_str</code> è¡¨ç¤ºçš„Cé£æ ¼å­—ç¬¦ä¸²è¢«å­—ç¬¦ä¸²å†…ç¬¬ä¸€ä¸ªNULå­—ç¬¦â€œæˆªæ–­â€ï¼›  </li><li>è‹¥ <code>std::string</code> å­—ç¬¦ä¸²å†…å­˜åœ¨NULå­—ç¬¦ï¼Œä½œä¸ºCé£æ ¼å­—ç¬¦ä¸²(<code>c_str</code>)æ—¶çš„è¡Œä¸ºå’Œå…¶æœ¬èº«<a href="#14">ä¸ä¸€è‡´</a>ï¼› </li><li><code>std::string_view</code> æ˜¯å­—ç¬¦ä¸²è§†å›¾ï¼›  </li><li><code>std::string_view</code> ä¸åŒäºCé£æ ¼å­—ç¬¦ä¸²ï¼Œå®ƒå…è®¸å­—ç¬¦ä¸²å†…å­˜åœ¨NULå­—ç¬¦ï¼›  </li><li><code>std::string_view</code> ä¸ä¿è¯ null terminatedï¼›  </li><li><code>std::string_view</code> ä¸æä¾› <code>c_str</code> æˆå‘˜å‡½æ•°ï¼›  </li><li><code>std::string_view</code> å¯èƒ½æ˜¯æŸä¸ªå­—ç¬¦ä¸²çš„å­ä¸²ï¼›  </li><li><code>std::string_view</code> ä¸æŒæœ‰æ‰€è¡¨ç¤ºçš„å­—ç¬¦ä¸²çš„æ‰€æœ‰æƒï¼Œè€Œåƒæ˜¯ä¸€ç§å¼•ç”¨ï¼›  </li><li>ä»…å°†å­—ç¬¦ä¸²å­—é¢é‡ä½œä¸ºå®å‚ç”¨äºæ„é€  <code>std::string</code> å’Œ&#x2F;æˆ– <code>std::string_view</code>ï¼Œå°†åŒ¹é…åˆ°æ¥å—Cé£æ ¼å­—ç¬¦ä¸²çš„æ„é€ å‡½æ•°ï¼›  </li><li>å­—ç¬¦ä¸²å­—é¢é‡ä¸­å¯ä»¥å‡ºç°å€¼ä¸º NUL çš„å…ƒç´ ï¼›  </li><li>é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰å­—é¢é‡çš„æ–¹å¼ä½¿ç”¨æ ‡å‡†åº“(å‘½åç©ºé—´ <code>std::literals::string_literals</code>) ä¸­çš„ <code>operator&quot;&quot;s</code> ä»å­—ç¬¦ä¸²å­—é¢é‡æ„é€  <code>std::string</code> å¯¹è±¡ï¼›  </li><li>é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰å­—é¢é‡çš„æ–¹å¼ä½¿ç”¨æ ‡å‡†åº“(å‘½åç©ºé—´ <code>std::literals::string_view_literals</code>)ä¸­çš„ <code>operator&quot;&quot;sv</code> ä»å­—ç¬¦ä¸²å­—é¢é‡æ„é€  <code>std::string_view</code> å¯¹è±¡ï¼›  </li><li>é€šè¿‡(23)ã€(24)è·å¾—çš„ <code>std::string</code>ã€<code>std::string_view</code> å¯¹è±¡ï¼Œå­—ç¬¦ä¸²é•¿åº¦åº”æ˜¯ <code>N-1</code> (Nä¸ºå­—ç¬¦æ•°ç»„çš„å°ºå¯¸)ï¼Œä¸ç®¡å­—ç¬¦ä¸²å­—é¢é‡ä¸­æ˜¯å¦æœ‰ NULï¼Œè€Œ(20)ä¸­çš„æ„é€ æ–¹æ³•åˆ™ä¼šå— NUL å…ƒç´ çš„å½±å“ï¼Œ<a href="#25">ç¤ºä¾‹</a>ã€‚</li></ol><h3 id="äº‹é¡¹å’Œå»ºè®®"><a href="#äº‹é¡¹å’Œå»ºè®®" class="headerlink" title="äº‹é¡¹å’Œå»ºè®®"></a>äº‹é¡¹å’Œå»ºè®®</h3><ul><li><div class="rev">ä½¿ç”¨ç°ä»£C++ï¼Œ</div>  </li><li><div class="rev">å°½é‡ä½¿ç”¨ string å’Œ string_viewï¼Œ</div>  </li><li><div class="rev">å°½é‡é¿å…ä½¿ç”¨å­—ç¬¦æ•°ç»„è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œ</div>  </li><li><div class="rev">å°½é‡ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å­—é¢é‡é€šè¿‡å­—ç¬¦ä¸²å­—é¢é‡è·å¾—stringæˆ–string_viewå¯¹è±¡ï¼Œ</div>  </li><li><div class="rev">å½“å‡½æ•°æ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥å‚æ•°(ä¸ä¿®æ”¹)æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨ string_view åšå½¢å‚çš„ç±»å‹ï¼šT foo(string_view in);ï¼Œ</div>  </li><li><div class="rev">ä¼˜å…ˆä»¥è¿”å›å€¼ä½œä¸ºå‡½æ•°è¾“å‡ºçš„æ–¹å¼ï¼Œ</div>  </li><li><div class="rev">å½“å‡½æ•°æ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥è¾“å‡ºå‚æ•°ä¸”å¯èƒ½éœ€è¦ä¿®æ”¹å®ƒçš„å…ƒç´ æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨ span&lt;char_t> åšå½¢å‚çš„ç±»å‹(C++20)ï¼Œ</div>  </li><li><div class="rev">å½“å‡½æ•°æ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥è¾“å‡ºå‚æ•°ä¸”å¯èƒ½éœ€è¦ä¿®æ”¹å®ƒæ—¶(å¯èƒ½å¢é•¿æˆ–ç¼©çŸ­)ï¼Œè€ƒè™‘ä½¿ç”¨ string& åšå½¢å‚çš„ç±»å‹ï¼Œ</div>  </li><li><div class="rev">å‡½æ•°å‘è°ƒç”¨æ–¹è¾“å‡ºå­—ç¬¦ä¸²åº”å½“ä¼˜å…ˆé‡‡ç”¨è¿”å›å€¼çš„æ–¹å¼è¿”å› string ç±»å‹å­—ç¬¦ä¸²ï¼Œ</div>  </li><li><div class="rev">ä¸è¦è®© string_view çš„ç”Ÿå‘½å‘¨æœŸé•¿äºå®ƒå¼•ç”¨çš„å­—ç¬¦ä¸²çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚ä¸è¦è¿”å›ä»å±€éƒ¨(è‡ªåŠ¨å­˜å‚¨æœŸ) string å¯¹è±¡å¾—æ¥çš„ string_viewï¼Œå¯¹äº span åŒç†ï¼Œå®ƒä»¬éƒ½ä¸æ‹¥æœ‰èµ„æºçš„æ‰€æœ‰æƒï¼Œè€Œåƒæ˜¯ä¸€ç§â€œå¼•ç”¨â€ï¼Œ</div>  </li><li><div class="rev">ä¸è¦é”™è¯¯ä½¿ç”¨ `string_view` å’Œ `span`ï¼Œå¦‚ `string_view result = foo(1); // å‡½æ•°fooç±»å‹ä¸º string(int)`ï¼Œ</div>  </li><li><div class="rev">å­—ç¬¦ä¸²å­—é¢é‡å…·æœ‰é™æ€å­˜å‚¨æœŸã€‚</div></li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="14"><a href="#14" class="headerlink" title="14"></a>14</h4><pre><code class="C++">cout &lt;&lt; string&#123; &quot;str\0ing&quot;, 7 &#125; &lt;&lt; &quot;\n&quot;;cout &lt;&lt; string&#123; &quot;str\0ing&quot;, 7 &#125;.c_str() &lt;&lt; &quot;\n&quot;;</code></pre><p>å¯èƒ½çš„è¾“å‡ºï¼š  </p><pre><code>stringstr</code></pre><h4 id="25"><a href="#25" class="headerlink" title="25"></a>25</h4><pre><code class="C++">using namespace std::string_literals;using namespace std::string_view_literals;cout &lt;&lt; string&#123; &quot;str\0ing&quot; &#125; &lt;&lt; &quot;\n&quot;;cout &lt;&lt; string_view&#123; &quot;str\0ing&quot; &#125; &lt;&lt; &quot;\n&quot;;cout &lt;&lt; &quot;str\0ing&quot;s &lt;&lt; &quot;\n&quot;;cout &lt;&lt; &quot;str\0ing&quot;sv &lt;&lt; &quot;\n&quot;;</code></pre><p>å¯èƒ½çš„è¾“å‡ºï¼š  </p><pre><code>strstrstringstring</code></pre>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++20 ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨</title>
      <link href="/2023/09/22/CPP20-How-to-Use-Three-Way-Comparison/"/>
      <url>/2023/09/22/CPP20-How-to-Use-Three-Way-Comparison/</url>
      
        <content type="html"><![CDATA[<style>    .other_topic {        color: #528252;    }</style><h1 id="C-20ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦-â€œâ€"><a href="#C-20ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦-â€œâ€" class="headerlink" title="C++20ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ â€œ&lt;&#x3D;&gt;â€"></a>C++20ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ â€œ&lt;&#x3D;&gt;â€</h1><p>ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦æ˜¯ C++20 æ ‡å‡†æ–°åŠ å…¥çš„è¿ç®—ç¬¦ï¼Œæœ¬æ–‡å°†ä»‹ç»ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„åŸºæœ¬ä½¿ç”¨å’Œä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›å®ƒçš„æ–¹æ³•ã€‚<br>ä¸ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ç›¸å…³å†…å®¹åœ¨æ ‡å¤´ <code>&lt;compare&gt;</code> ä¸­ã€‚</p><h2 id="ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨"><a href="#ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨" class="headerlink" title="ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨"></a>ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨</h2><h3 id="ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¿”å›å€¼ç±»å‹"><a href="#ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¿”å›å€¼ç±»å‹" class="headerlink" title="ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¿”å›å€¼ç±»å‹"></a>ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¿”å›å€¼ç±»å‹</h3><p>C++20æ–°å¢ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç”¨äºç¡®å®šä¸¤ä¸ªå€¼çš„å¤§å°é¡ºåºã€‚å†…ç½®ç±»å‹çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›å€¼ä¸ä¸ºboolç±»å‹çš„çº¯å³å€¼ï¼Œè€Œæ˜¯å¦‚ä¸‹ç±»ç±»å‹ä¹‹ä¸€çš„ä¸€ä¸ªçº¯å³å€¼ã€‚  </p><div id="ordering_types">C++ä¸ºæˆ‘ä»¬æä¾›çš„ä¸‰ç§ç›¸åº”çš„ç±»å‹ï¼š</div>  <ul><li><code>std::strong_ordering</code>  </li><li><code>std::partial_ordering</code>  </li><li><code>std::weak_ordering</code></li></ul><p>å®ƒä»¬å¯ä»¥è¢«ç§°ä¸ºâ€œç±»æšä¸¾ç±»å‹â€(ä½¿ç”¨æ–¹æ³•å’Œâ€C++æšä¸¾ç±»-<a href="https://zh.cppreference.com/w/cpp/language/enum" title="cppref">æœ‰ä½œç”¨åŸŸæšä¸¾</a>â€œæœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¸ºç±»ç±»å‹ï¼Œæ•…ä¸¤è€…æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿)ã€‚  </p><h3 id="ä¸‰ç§orderingçš„éšå¼è½¬æ¢"><a href="#ä¸‰ç§orderingçš„éšå¼è½¬æ¢" class="headerlink" title="ä¸‰ç§orderingçš„éšå¼è½¬æ¢"></a>ä¸‰ç§orderingçš„éšå¼è½¬æ¢</h3><p><span id="ordering_cast"> ä¸‰ç§orderingçš„éšå¼è½¬æ¢ </span></p><p>å…¶ä¸­<code>std::strong_ordering</code>å¯ä»¥éšå¼è½¬æ¢ä¸º<code>std::weak_ordering</code>ï¼›<br><code>std::weak_ordering</code>å¯ä»¥éšå¼è½¬æ¢ä¸º<code>std::partial_ordering</code>ã€‚</p><h3 id="strong-ordering-å¼ºåº"><a href="#strong-ordering-å¼ºåº" class="headerlink" title="strong_ordering å¼ºåº"></a>strong_ordering å¼ºåº</h3><p>å¯¹äºæ•´æ•°ç±»å‹(åŒ…æ‹¬æŒ‡é’ˆç±»å‹)å’Œboolç±»å‹ï¼Œä¸‰è·¯æ¯”è¾ƒè¿ç®—çš„ç»“æœæ˜¯<code>std::strong_ordering</code>ç±»å‹çš„ï¼Œ<br>å…¶å€¼ä¸ºä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š  </p><ul><li><code>std::strong_ordering::less</code> ï¼šæŒ‡ç¤ºå…ˆåºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å°äºå³æ“ä½œæ•°  </li><li><code>std::strong_ordering::greater</code> ï¼šæŒ‡ç¤ºååºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å¤§äºå³æ“ä½œæ•°  </li><li><code>std::strong_ordering::equivalent</code> ï¼š<text id="intr_equivalent">æŒ‡ç¤ºç­‰ä»·å…³ç³»ï¼Œå³å·¦æ“ä½œæ•°ç­‰äºå³æ“ä½œæ•°</text>  </li><li><code>std::strong_ordering::equal</code> (ä¸<a href="#intr_equivalent">equivalent</a>ç›¸åŒ)</li></ul><p>æ³¨ï¼šå¦‚æœä¸‰è·¯æ¯”è¾ƒè¿ç®—çš„ä¸¤æ“ä½œæ•°ä¸€æ–¹ä¸ºboolç±»å‹è€Œå¦ä¸€æ–¹ä¸æ˜¯ï¼Œé‚£ä¹ˆç¨‹åºéè‰¯æ„ã€‚</p><h3 id="partial-ordering-ååº"><a href="#partial-ordering-ååº" class="headerlink" title="partial_ordering ååº"></a>partial_ordering ååº</h3><p>å¯¹äºæµ®ç‚¹ç±»å‹ï¼Œç»“æœåˆ™æ˜¯<code>std::partial_ordering</code>ç±»å‹çš„ï¼Œ<br>å…¶å€¼ä¸ºä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š  </p><ul><li><code>std::partial_ordering::less</code> ï¼šæŒ‡ç¤ºå…ˆåºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å°äºå³æ“ä½œæ•°  </li><li><code>std::partial_ordering::greater</code> ï¼šæŒ‡ç¤ºååºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å¤§äºå³æ“ä½œæ•°  </li><li><code>std::partial_ordering::equivalent</code> ï¼šæŒ‡ç¤ºç­‰ä»·å…³ç³»ï¼Œå³å·¦æ“ä½œæ•°ç­‰äºå³æ“ä½œæ•°  </li><li><code>std::partial_ordering::unordered</code> ï¼šæŒ‡ç¤ºä¸å¯æ¯”è¾ƒå€¼çš„å…³ç³»ï¼Œå½“æ“ä½œæ•°ä¸­å­˜åœ¨<code>NaN</code>æ—¶ç»“æœä¸º<code>unordered</code></li></ul><p>æ³¨ï¼šæ­£è´Ÿé›¶çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç»“æœä¸º<code>equivalent</code>  </p><h3 id="weak-ordering-å¼±åº"><a href="#weak-ordering-å¼±åº" class="headerlink" title="weak_ordering å¼±åº"></a>weak_ordering å¼±åº</h3><p>å¯¹äºä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå¦‚æœä¸è€ƒè™‘ä½¿ç”¨ä¸Šè¿°ä¸¤ç§ç±»å‹ä½œä¸ºè¿”å›å€¼ç±»å‹ï¼Œåˆ™å¯ä»¥è€ƒè™‘<code>std::weak_ordering</code>ï¼Œ<br>å…¶å€¼ä¸ºä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š  </p><ul><li><code>std::weak_ordering::less</code> ï¼šæŒ‡ç¤ºå…ˆåºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å°äºå³æ“ä½œæ•°  </li><li><code>std::weak_ordering::greater</code> ï¼šæŒ‡ç¤ºååºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å¤§äºå³æ“ä½œæ•°  </li><li><code>std::weak_ordering::equivalent</code> ï¼šæŒ‡ç¤ºç­‰ä»·å…³ç³»ï¼Œå³å·¦æ“ä½œæ•°ç­‰äºå³æ“ä½œæ•°</li></ul><h3 id="æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ordering"><a href="#æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ordering" class="headerlink" title="æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ordering"></a>æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ordering</h3><p>å¯¹äºä¸Šè¿°æåˆ°çš„ç±»å‹ï¼ŒC++æ ‡å‡†æä¾›äº†å…­ç§å’Œå­—é¢é‡<code>0</code>è¿›è¡Œæ¯”è¾ƒçš„è¿ç®—ç¬¦é‡è½½ï¼Œç”¨ä»¥ç¡®å®šä¸¤ä¸ªå€¼çš„å¤§å°é¡ºåºã€‚è®¾<code>ordering_v</code>ä¸ºä¸Šè¿°ä¸‰ç§orderingç±»å‹ä¸­ä»»æ„ç±»å‹çš„å€¼ï¼Œåˆ™ï¼š</p><ol><li><code>ordering_v &lt; 0</code>ã€<code>0 &gt; ordering_v</code> ä¸ºçœŸæ—¶ ï¼šå¯¹åº”<code>less</code>  </li><li><code>ordering_v &lt;= 0</code>ã€<code>0 &gt;= ordering_v</code>ä¸ºçœŸæ—¶ ï¼šå¯¹åº”<code>less</code>âˆ¨<code>equivalent</code>  </li><li><code>ordering_v &gt; 0</code>ã€<code>0 &lt; ordering_v</code> ä¸ºçœŸæ—¶ ï¼šå¯¹åº”<code>greater</code>  </li><li><code>ordering_v &gt;= 0</code>ã€<code>0 &lt;= ordering_v</code> ä¸ºçœŸæ—¶ ï¼šå¯¹åº”<code>greater</code>âˆ¨<code>equivalent</code>  </li><li><code>ordering_v == 0</code>ã€<code>0 == ordering_v</code> ä¸ºçœŸæ—¶ ï¼šå¯¹åº”<code>equivalent</code>  </li><li><code>ordering_v != 0</code>ã€<code>0 != ordering_v</code> ä¸ºçœŸæ—¶ ï¼šå¯¹åº”â”<code>equivalent</code>(é<code>equivalent</code>)</li></ol><h4 id="å…·åæ¯”è¾ƒå‡½æ•°"><a href="#å…·åæ¯”è¾ƒå‡½æ•°" class="headerlink" title="å…·åæ¯”è¾ƒå‡½æ•°"></a>å…·åæ¯”è¾ƒå‡½æ•°</h4><p>è¿™äº›å‡½æ•°å–ä¸‰è·¯æ¯”è¾ƒçš„ç»“æœï¼Œå¹¶è½¬æ¢ä¸ºå…­ä¸ªå…³ç³»è¿ç®—ç¬¦çš„ç»“æœä¹‹ä¸€ã€‚</p><ol><li><code>std::is_eq</code>  </li><li><code>std::is_neq</code>  </li><li><code>std::is_lt</code>  </li><li><code>std::is_lteq</code>  </li><li><code>std::is_gt</code>  </li><li><code>std::is_gteq</code></li></ol><p>è®¾å½¢å‚åä¸º<code>ordering_v</code>ï¼Œè¿™äº›å‡½æ•°å°†åˆ†åˆ«è¿”å›ï¼š</p><ol><li><code>ordering_v == 0</code>  </li><li><code>ordering_v != 0</code>  </li><li><code>ordering_v &lt; 0</code>  </li><li><code>ordering_v &lt;= 0</code>  </li><li><code>ordering_v &gt; 0</code>  </li><li><code>ordering_v &gt;= 0</code></li></ol><p>å’Œ 0 è¿›è¡Œæ¯”è¾ƒçš„æ“ä½œæˆ–è®¸æœ‰ç‚¹ä»¤äººè´¹è§£(å…¶å®è¿˜å¥½)ï¼Œæ‰€ä»¥æˆ‘å»ºè®®å°½é‡ä½¿ç”¨å…·åæ¯”è¾ƒå‡½æ•°ã€‚  </p><h3 id="ç»¼åˆç¤ºä¾‹"><a href="#ç»¼åˆç¤ºä¾‹" class="headerlink" title="ç»¼åˆç¤ºä¾‹"></a>ç»¼åˆç¤ºä¾‹</h3><pre><code class="C++">#include &lt;iostream&gt;// #include &lt;compare&gt; // ç›¸å…³å†…å®¹åœ¨æ ‡å¤´compareä¸­int main()&#123;    using namespace std;    cout &lt;&lt; boolalpha;    auto case_generator = [](auto foo, auto bar)    &#123;        auto print = [](const auto&amp; result)        &#123;            cout                &lt;&lt; &quot; == &quot; &lt;&lt; (result == 0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; != &quot; &lt;&lt; (result != 0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; &lt;  &quot; &lt;&lt; (result &lt;  0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; &lt;= &quot; &lt;&lt; (result &lt;= 0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; &gt;  &quot; &lt;&lt; (result &gt;  0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; &gt;= &quot; &lt;&lt; (result &gt;= 0) &lt;&lt; &#39;\n&#39;;            // å¯ä»¥ä½¿ç”¨å…·åæ¯”è¾ƒå‡½æ•°æ›¿æ¢        &#125;;        cout &lt;&lt; &quot;case equivalent\n&quot;;        foo = 100;        bar = 100;        print(foo &lt;=&gt; bar);        cout &lt;&lt; &quot;case less\n&quot;;        foo = 100;        bar = 999;        print(foo &lt;=&gt; bar);        cout &lt;&lt; &quot;case greater\n&quot;;        foo = 999;        bar = 100;        print(foo &lt;=&gt; bar);    &#125;;    cout &lt;&lt; &quot;Integer: \n&quot;;    case_generator(0, 0);    cout &lt;&lt; &quot;Floating point: \n&quot;;    case_generator(0.0, 0.0);    return 0;&#125;</code></pre><p>ç»“æœä¸º</p><pre><code>Integer:case equivalent == true != false &lt;  false &lt;= true &gt;  false &gt;= truecase less == false != true &lt;  true &lt;= true &gt;  false &gt;= falsecase greater == false != true &lt;  false &lt;= false &gt;  true &gt;= trueFloating point:case equivalent == true != false &lt;  false &lt;= true &gt;  false &gt;= truecase less == false != true &lt;  true &lt;= true &gt;  false &gt;= falsecase greater == false != true &lt;  false &lt;= false &gt;  true &gt;= true</code></pre><p>å¯¹äºä¸åŒç±»å‹é—´ä½¿ç”¨ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¯¦ç»†è§„åˆ™ï¼Œè¯·å‚é˜…<a href="https://zh.cppreference.com/w/cpp/language/operator_comparison">cpp-reference</a></p><hr><h2 id="ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦"></a>ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦</h2><p>ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦å¯ä»¥å°†å…¶å®šä¹‰ä¸ºæˆå‘˜å‡½æ•°å’Œéæˆå‘˜å‡½æ•°ä¸¤ç§å½¢å¼ã€‚</p><p>ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›å€¼ç±»å‹åº”å½“ä¸º<a href="#ordering_types">ä¸‰ç§ordering</a>ä¸­ä»»æ„ä¸€ä¸ªï¼Œä½†æ˜¯å¦‚æœè¦æ”¹å˜ä¸ºå…¶ä»–ç±»å‹æ¯”å¦‚<code>int</code>é€šå¸¸ä¹Ÿèƒ½é€šè¿‡ç¼–è¯‘ï¼Œç¨‹åºå‘˜åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™åº”è¯¥æ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆã€‚</p><pre><code class="C++">// é‡è½½ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ç¤ºä¾‹// æˆå‘˜å‡½æ•°å½¢å¼ï¼šclass CX1&#123;    int val&#123;&#125;;    int insignificant_things&#123;&#125;;public:    auto operator &lt;=&gt; (const CX1&amp; rhs) const    &#123;        return this-&gt;val &lt;=&gt; rhs.val;    &#125;&#125;;// å‹å…ƒå‡½æ•°å½¢å¼(æ¨è)ï¼šclass CX2&#123;    int val&#123;&#125;;    int insignificant_things&#123;&#125;;public:    friend auto operator &lt;=&gt; (const CX2&amp; lhs, const CX2&amp; rhs)    &#123;        return lhs.val &lt;=&gt; rhs.val;    &#125;&#125;;</code></pre><p>å¦‚æœæä¾›çš„æ˜¯éæˆå‘˜å‡½æ•°è€Œä¸å†™æˆå‹å…ƒå‡½æ•°çš„å½¢å¼ï¼Œåˆ™æ— æ³•ä½¿ç”¨ <code>=default</code> å®šä¹‰ã€‚  </p><pre><code class="C++">struct A &#123; int a&#123;&#125;; &#125;;std::strong_ordering operator &lt;=&gt; (const A&amp;, const A&amp;) = default; // é”™è¯¯</code></pre><div class="other_topic"><p>é¢˜å¤–è¯ï¼š  </p><p>æˆ‘æ›´æ¨èå°†ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹çš„ <code>+</code>, <code>==</code>, <code>&lt;=&gt;</code> ç­‰ rhs ä¸ lhs åœ°ä½å¹³ç­‰çš„è¿ç®—ç¬¦ä»¥éæˆå‘˜å‡½æ•°çš„å½¢å¼åœ¨ä¸ç›®æ ‡ç±»å‹<code>T</code>æ‰€å¤„çš„å‘½åç©ºé—´ä¸­(ç”±äº<a href="https://zh.cppreference.com/w/cpp/language/adl" title="c++ reference">å®å‚ä¾èµ–æŸ¥æ‰¾(ADL)</a>æ— éœ€æ‹…å¿ƒåç§°æŸ¥æ‰¾çš„é—®é¢˜)æä¾›ã€‚<br>å¦‚æœå¯ä»¥ï¼Œä»¥å‹å…ƒå‡½æ•°å½¢å¼å¹¶ä¸”åœ¨ç±»ä¸­æä¾›å®šä¹‰æœ€å¥½ã€‚  </p><pre><code class="C++">namespace mytest&#123;    struct my_t    &#123;        int data&#123;&#125;;        [[nodiscard]] friend constexpr auto operator== (const my_t&amp; lhs, const my_t&amp; rhs) noexcept        &#123;            return lhs.data == rhs.data;        &#125;    &#125;;&#125;auto foo()&#123;    mytest::my_t a&#123; 1 &#125;, b&#123; 2 &#125;;    return a == b; // å¯ä»¥æ‰¾åˆ°operator==&#125;</code></pre><p>é¢˜å¤–è¯çš„é¢˜å¤–è¯ï¼š<br>å¯¹äºå½¢å‚ï¼Œ<code>my_t</code> çš„æ‹·è´å¼€é”€å¾ˆå°ï¼Œä½¿ç”¨å¼•ç”¨å¯èƒ½è¿˜ä¸å¦‚ä½¿ç”¨æ‹·è´æ–¹ä¾¿é«˜æ•ˆï¼Œä½†æ˜¯ä¸ºäº†å½¢å¼ä¸Šçš„ç»Ÿä¸€ï¼Œæˆ‘æ­¤å¤„ä»ç„¶ä½¿ç”¨<code>const T&amp;</code>å½¢å¼ã€‚æˆ‘ç›¸ä¿¡åœ¨ä¸Šè¿°æƒ…å†µä¸‹(å³ç»™å‡ºçš„ä»£ç )ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ç¼–è¯‘å™¨æœ€ç»ˆçš„ä¼˜åŒ–ä¸ä¼šè®©è¿™ç§â€œå½¢å¼â€(å³ä½¿è¯­ä¹‰ä¸åŒ)å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚<br>å¦‚æœæ‹…å¿ƒæ€§èƒ½é—®é¢˜ï¼Œè¯·åšæ€§èƒ½æµ‹è¯•(éœ€è¦è€ƒè™‘æ˜¯å¦å¯ä»¥å¯ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ç­‰æ¡ä»¶)ã€‚  </p></div><hr><p>ä¸ºæˆ‘ä»¬çš„ç±»å‹æä¾›äº†ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦åï¼Œ<br>è‹¥æ­¤å‡½æ•°è¢«å®šä¹‰ä¸º<code>=default</code>ï¼Œåˆ™C++ä¼šè‡ªåŠ¨æä¾› <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code> æ“ä½œã€‚<br>è‹¥æ­¤å‡½æ•°å®šä¹‰ä¸ä¸º<code>=default</code>ï¼Œåˆ™C++ä¼šè‡ªåŠ¨æä¾› <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code> æ“ä½œã€‚<br>è¿™æ˜¯ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½éå¸¸æœ‰ç”¨çš„ä¸€ç‚¹ï¼Œå¦‚æœä¸éœ€è¦è‡ªåŠ¨ç”Ÿæˆçš„æ¯”è¾ƒæ“ä½œå¯ä»¥æ˜¾å¼å¼ƒç½®ï¼Œå¦‚æœè‡ªåŠ¨ç”Ÿæˆçš„æ¯”è¾ƒè¿ç®—ç¬¦ä¸åˆè‡ªå·±çš„æœŸæœ›ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®ƒã€‚  </p><p>æ³¨ï¼šæä¾›<code>&lt;=&gt;</code>è¿ç®—ç¬¦çš„éé»˜è®¤å®ç°(ä¸å®šä¹‰ä¸º<code>=default</code>)åï¼Œc++ ä¸ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ <code>==</code>ã€<code>!=</code> æ“ä½œï¼Œè‡³äºä¸ºä»€ä¹ˆæˆ‘ä¸çŸ¥é“ï¼Œæœ‰èƒ½åŠ›å¯ä»¥å»ç¿»é˜…ç›¸å…³ææ¡ˆã€‚<br>ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾› <code>operator==</code>(è¿”å›å€¼ç±»å‹é¡»ä¸ºbool) åï¼Œ<code>!=</code> æ“ä½œå¯ç”¨(C++20 èµ·)ã€‚<br><a href="https://zh.cppreference.com/w/cpp/language/default_comparisons" title="é¢„ç½®æ¯”è¾ƒ">C++ å‚è€ƒ é¢„ç½®æ¯”è¾ƒ</a><br>C++20 æ·»åŠ äº†æ¯”è¾ƒè¿ç®—ç¬¦çš„ç‰¹æ®Šé‡è½½è§£æè§„åˆ™ï¼Œå¯ä»¥è®¿é—®<a href="https://sunflavourpetals.github.io/2024/02/22/CPP20%E7%9A%84%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6/">æˆ‘çš„åšå®¢</a>å¤§è‡´äº†è§£ä¸€ä¸‹ã€‚  </p><p>C++20 èµ·ï¼Œæ ‡å‡†åº“ä¸­æä¾›çš„åŸºæœ¬ä¸Šéƒ½æ˜¯ <code>operator==</code> å’Œ <code>operator&lt;=&gt;</code>ï¼Œè€Œéå…­ä¸ªåŸå…ˆçš„å…­ä¸ªæ¯”è¾ƒè¿ç®—ç¬¦ã€‚  </p><pre><code class="C++">// ç¤ºä¾‹class CX&#123;    int foo&#123;&#125;;    int bar&#123;&#125;;public:    friend auto operator &lt;=&gt; (const CX&amp;, const CX&amp;) = default;    // å¦‚æœæˆ‘ä»¬å•ä¸å¸Œæœ›æ­¤ç±»æœ‰ &quot;&gt;=&quot; æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œåˆ™æ˜¾ç¤ºå¼ƒç½®å®ƒï¼š    bool operator &gt;= (const CX&amp;) const = delete; // å¼ƒç½® &gt;= è¿ç®—ç¬¦    // å¦‚æœæˆ‘ä»¬å•å¸Œæœ› &quot;&gt;&quot; è¿ç®—ç¬¦çš„æ¯”è¾ƒæ–¹å¼æ˜¯æˆå‘˜å±æ€§ä¹‹å’Œç›¸æ¯”è¾ƒï¼Œè€Œä¸æ˜¯æ ¹æ®é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„æ¯”è¾ƒæ–¹å¼ï¼Œåˆ™è‡ªå®šä¹‰å®ƒï¼š    bool operator &gt; (const CX&amp; rhs) const noexcept    &#123;        return (this-&gt;foo + this-&gt;bar) &gt; (rhs.foo + rhs.bar);    &#125;&#125;;</code></pre><h3 id="é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦"></a>é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦</h3><p>å½“æˆ‘ä»¬è¦ä¸ºä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦æ—¶ï¼Œæœ‰æ—¶å¯ä»¥è€ƒè™‘é‡‡ç”¨é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ã€‚<br>é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›å€¼æ ¹æ®<a href="#ordering_cast">ä¸‰ç§orderingçš„éšå¼è½¬æ¢è§„åˆ™</a>é‡‡å–ç›¸åº”çš„ç±»å‹ã€‚<br>å³ï¼šæœ‰<code>std::partial_ordering</code>æ—¶ä¸º<code>std::partial_ordering</code>ï¼Œå¦åˆ™æœ‰<code>std::weak_ordering</code>æ—¶ä¸º<code>std::weak_ordering</code>ï¼Œå¦åˆ™ä¸º<code>std::strong_ordering</code>ã€‚<br>å¦‚æœæƒ³è¦ä½¿ç”¨é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç±»çš„æˆå‘˜å¿…é¡»å…¨éƒ¨æ»¡è¶³ï¼š<strong>ç±»å‹ä¸ºåŸºæœ¬ç±»å‹</strong>æˆ–<strong>å…·æœ‰é‡è½½çš„è¿”å›å€¼ä¸º<a href="#ordering_types">ä¸Šè¿°ä¸‰ç§ordering</a>çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦</strong>çš„ç±»å‹ï¼ŒåŸºç±»(å¦‚æœæœ‰)é¡»<strong>å…·æœ‰é‡è½½çš„è¿”å›å€¼ä¸º<a href="#ordering_types">ä¸Šè¿°ä¸‰ç§ordering</a>çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦</strong>ï¼Œå¦åˆ™è¯¥ <code>operator&lt;=&gt;</code> å°†è¢«å®šä¹‰ä¸ºå¼ƒç½®ã€‚  </p><p>ç¤ºä¾‹ï¼š</p><pre><code class="C++">// æˆå‘˜å‡½æ•°å½¢å¼ï¼šclass CX1&#123;    int foo&#123;&#125;;    int bar&#123;&#125;; // memberspublic:    auto operator &lt;=&gt; (const CX1&amp;) const = default; // è¿”å›ç±»å‹ä¸º strong_ordering&#125;;// å‹å…ƒå‡½æ•°å½¢å¼ï¼šclass CX2&#123;    int foo&#123;&#125;;    double bar&#123;&#125;; // memberspublic:    friend auto operator &lt;=&gt; (const CX2&amp;, const CX2&amp;) = default; // è¿”å›ç±»å‹ä¸º partial_ordering&#125;;class CX3&#123;    CX1 cx1&#123;&#125;;    CX2 cx2&#123;&#125;;public:    auto operator &lt;=&gt; (const CX3&amp;) const = default; // è¿”å›ç±»å‹ä¸º partial_ordering&#125;;class CX4 &#123;&#125;;class CX5 : public CX4&#123;public:    friend auto operator &lt;=&gt; (const CX5&amp;, const CX5&amp;) = default; // å¼ƒç½®&#125;class CX6&#123;    CX4 cx4&#123;&#125;;public:    friend auto operator &lt;=&gt; (const CX6&amp;, const CX6&amp;) = default; // å¼ƒç½®&#125;</code></pre><p>é»˜è®¤ç”Ÿæˆçš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›å€¼å–å†³äºæ­¤ï¼š<br>é€šè¿‡ä¾æ¬¡ä»¥è®¡ç®— &lt;&#x3D;&gt; æ¯”è¾ƒåŸºç±»(ä»å·¦åˆ°å³ï¼Œæ·±åº¦ä¼˜å…ˆ)ï¼Œç„¶åæ¯”è¾ƒéé™æ€æˆå‘˜(æŒ‰å£°æ˜é¡ºåº)å­å¯¹è±¡ï¼Œé€’å½’åœ°å±•å¼€æ•°ç»„æˆå‘˜(æŒ‰ä¸‹æ ‡é€’å¢)ï¼Œå¹¶åœ¨å‘ç°ä¸ç›¸ç­‰çš„ç»“æœæ—¶æå‰åœæ­¢çš„æ–¹å¼æ‰§è¡Œå­—å…¸åºæ¯”è¾ƒï¼Œå³ç›´åˆ°ç»“æœå‡ºç°ç¬¬ä¸€ä¸ª <code>less</code>ã€<code>greater</code>ã€<code>unordered</code> æˆ–å…¨éƒ¨æ¯”è¾ƒå®Œæˆï¼Œå°†å¾—åˆ°çš„æœ€åä¸€ä¸ªç»“æœä½œä¸ºæ•´ä¸ªä¸‰è·¯æ¯”è¾ƒè¿ç®—çš„ç»“æœï¼Œå¦‚æœæœªå‡ºç°é <code>equivalent</code> çš„ç»“æœåˆ™è¿”å› <code>equivalent</code>ã€‚  </p><p>ç¤ºä¾‹ï¼š</p><pre><code class="C++">#include &lt;iostream&gt;struct TestBase&#123;    int base1&#123;&#125;;    int base2[3]&#123;&#125;;    friend auto operator&lt;=&gt;(const TestBase&amp; lhs, const TestBase&amp; rhs) = default;&#125;;struct Test : TestBase&#123;    int m1&#123;&#125;; double m2&#123;&#125;; bool m3&#123;&#125;;    friend auto operator&lt;=&gt;(const Test&amp; lhs, const Test&amp; rhs) = default;&#125;;int main()&#123;    Test t1&#123; 0, &#123; 1, 2, 3 &#125;, 1, 2.0, true &#125;;    Test t2&#123; 0, &#123; 1, 2, 3 &#125;, 1, 3.0, false &#125;;    // åŸºç±»ç¬¬ä¸€ä¸ªæˆå‘˜ base1 æ¯”è¾ƒç»“æœä¸º equivalent, ç»§ç»­    // åŸºç±»ç¬¬äºŒä¸ªæˆå‘˜ base2 ç´¢å¼•ä¸º 0 çš„å…ƒç´ æ¯”è¾ƒç»“æœä¸º equivalent, ç»§ç»­    // åŸºç±»ç¬¬äºŒä¸ªæˆå‘˜ base2 ç´¢å¼•ä¸º 1 çš„å…ƒç´ æ¯”è¾ƒç»“æœä¸º equivalent, ç»§ç»­    // åŸºç±»ç¬¬äºŒä¸ªæˆå‘˜ base2 ç´¢å¼•ä¸º 2 çš„å…ƒç´ æ¯”è¾ƒç»“æœä¸º equivalent, ç»§ç»­    // ç¬¬ä¸€ä¸ªæˆå‘˜å±æ€§ m1 æ¯”è¾ƒç»“æœä¸º equivalent, ç»§ç»­    // ç¬¬äºŒä¸ªæˆå‘˜å±æ€§ m2 æ¯”è¾ƒç»“æœä¸º less, å¾—åˆ°ç»“æœï¼Œä¸å†æ¯”è¾ƒç¬¬ä¸‰ä¸ªæˆå‘˜å±æ€§ m3 äº†    if ((t1 &lt;=&gt; t2) &lt; 0) &#123; std::cout &lt;&lt; &quot;t1 &lt; t2&quot;; &#125;    return 0;&#125;</code></pre><p>ç»“æœä¸º</p><pre><code class="output">t1 &lt; t2</code></pre><hr><p><a href="https://zh.cppreference.com/w/cpp/language/operator_comparison" title="zh cppreference operator_comparison">C++å‚è€ƒ | æ¯”è¾ƒè¿ç®—ç¬¦</a><br><a href="https://zh.cppreference.com/w/cpp/header/compare" title="zh cppreference compare">C++å‚è€ƒ | æ ‡å¤´ compare</a>  </p>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
          <category> CPP20 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> CPP20 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ ä½¿ç”¨externå…³é”®å­—å£°æ˜å…¨å±€å¸¸é‡çš„ä½œç”¨</title>
      <link href="/2023/09/18/The-Effect-of-Using-extern-in-const-variable-Declaration/"/>
      <url>/2023/09/18/The-Effect-of-Using-extern-in-const-variable-Declaration/</url>
      
        <content type="html"><![CDATA[<p><a href="#toolongtowatch">å¤ªé•¿ä¸çœ‹ç¯èŠ‚</a></p><h2 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h2><p>é€šå¸¸åœ¨ç¼–å†™å¤§å‹C&#x2F;C++ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°åˆ†æ–‡ä»¶ç¼–å†™ç¨‹åºçš„æ–¹å¼ç»„ç»‡ä»£ç ï¼ŒæŒ‰ç…§ä¸åŒçš„åŠŸèƒ½æ¨¡å—(æ­¤æ¨¡å—éc++20æ¨¡å—)ï¼Œå°†ä¸€ä»½ç¨‹åºåˆ†æˆä¸åŒçš„éƒ¨åˆ†ã€‚</p><p>ä¸ºäº†è®©æ¨¡å—ä¹‹é—´èƒ½å¤Ÿç›¸äº’è®¿é—®ï¼Œéœ€è¦å°†å£°æ˜æ”¾åœ¨å¤´æ–‡ä»¶(.h)ä¸­ï¼Œå°†å®šä¹‰æ”¾åœ¨æºæ–‡ä»¶(.c&#x2F;.cpp)ä¸­ã€‚</p><pre><code class="cpp">// header &quot;foo.h&quot;int foo();</code></pre><pre><code class="cpp">// source &quot;foo.cpp&quot;#include &quot;foo.h&quot;int foo()&#123;    return &#123;&#125;;&#125;</code></pre><p>è¿™æ ·ï¼Œå…¶ä»–æ¨¡å—åªè¦ä½¿ç”¨äº†é¢„å¤„ç†æŒ‡ä»¤<code>#include &quot;foo.h&quot;</code>ï¼Œå°±èƒ½ä½¿ç”¨å‡½æ•°<code>foo</code>äº†(<del>æ¯ä¸ªç”¨åˆ°<code>foo</code>çš„æºæ–‡ä»¶ä¸­ï¼Œç›´æ¥åœ¨ä½¿ç”¨ä¹‹å‰å£°æ˜ä¸€æ¬¡ä¹Ÿè¡Œ</del>)ã€‚</p><pre><code class="cpp">// main.cpp#include &quot;foo.h&quot;int main()&#123;    return foo();&#125;</code></pre><hr><p>é¢„å¤„ç†æŒ‡ä»¤<code>#include &quot;foo.h&quot;</code>çš„ä½œç”¨ä»…ä»…åªæ˜¯åœ¨é¢„å¤„ç†é˜¶æ®µä½¿ç”¨â€foo.hâ€æ–‡ä»¶çš„å†…å®¹æ›¿æ¢æ‰è¿™æ¡æŒ‡ä»¤è€Œå·²ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘â€main.cppâ€é˜¶æ®µï¼Œä»£ç ä¸­åªæœ‰å­¤é›¶é›¶ä¸€æ¡å£°æ˜ï¼š<code>int foo();</code>ï¼Œè€Œæ²¡æœ‰å‡½æ•°<code>foo</code>çš„å®šä¹‰ï¼Œå¤§å®¶éƒ½ä¸çŸ¥é“è¿™ä¸ªå‡½æ•°<code>foo</code>åœ¨å“ªé‡Œï¼Œä¹Ÿä¸çŸ¥é“è¿™ä¸ªå‡½æ•°<code>foo</code>å¹²äº†ä»€ä¹ˆï¼ŒåªçŸ¥é“æœ‰ä¸ªå«<code>foo</code>çš„å‡½æ•°å¹¶ä¸”è¿™é‡Œè°ƒç”¨äº†å‡½æ•°<code>foo</code>ã€‚</p><p>è™½ç„¶æœ‰äº›ç–‘é—®ï¼Œä½†æ˜¯â€main.cppâ€è¿˜æ˜¯è¢«æˆåŠŸç¼–è¯‘äº†ï¼Œç”Ÿæˆäº†ä¸€ä¸ªâ€main.objâ€(Windowså¹³å°)ï¼Œ<code>.obj</code>æ–‡ä»¶å³â€å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶â€ï¼Œé‡Œé¢è£…æ»¡äº†ç¼–è¯‘å™¨ç”Ÿæˆçš„ç›®æ ‡ä»£ç ã€‚è¿™æ—¶ï¼Œâ€foo.cppâ€ä¹Ÿè¢«ç¼–è¯‘äº†ï¼Œç”Ÿæˆäº†ä¸€ä¸ªâ€foo.objâ€æ–‡ä»¶â€¦â€¦</p><p>ç°åœ¨æ¥åˆ°äº†é“¾æ¥é˜¶æ®µï¼Œâ€main.cppâ€ä¸­çš„<code>main</code>å‡½æ•°è°ƒç”¨äº†<code>foo</code>å‡½æ•°ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“<code>foo</code>å‡½æ•°åœ¨â€foo.objâ€ä¸­ï¼Œé“¾æ¥ç¨‹åºå°†å®ƒå’Œ<code>main</code>å‡½æ•°ä¸€å¹¶æ”¾å…¥äº†â€main.exeâ€(å‡è®¾æ˜¯è¿™ä¸ªåå­—)ï¼Œå¹¶ä¸”åœ¨<code>main</code>å‡½æ•°ä¸­è°ƒç”¨<code>foo</code>å‡½æ•°çš„åœ°æ–¹å¡«ä¸Šäº†<code>foo</code>å‡½æ•°çš„ä½ç½®ã€‚</p><p>è¿™æ ·ï¼Œ<code>main</code>å‡½æ•°å°±çŸ¥é“<code>foo</code>å‡½æ•°åœ¨å“ªäº†ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œ<code>main</code>å‡½æ•°å°†æŠŠæ§åˆ¶æƒäº¤ç»™<code>foo</code>ï¼Œç­‰ç€å®ƒå°†è¿”å›å€¼äº¤ç»™<code>main</code>â€¦â€¦</p><p>è¿™å°±æ˜¯å°å­¦ç”Ÿéƒ½çŸ¥é“çš„C&#x2F;C++è¯­è¨€ä»æºç åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„æµç¨‹ã€‚<del>å½“ç„¶ï¼Œå¦‚æœä½ ç…§ç€ä¸Šé¢å†™äº†ç„¶åè¿˜ç¼–è¯‘é“¾æ¥äº†ï¼Œç”šè‡³è¿˜åç¼–è¯‘äº†ï¼Œç”šè‡³è¿˜ä¸€æ¡æ¡å»çœ‹æ±‡ç¼–æŒ‡ä»¤äº†ï¼Œæœ€åå‘ç°<code>main</code>å‡½æ•°ç›´æ¥è¿”å›äº†0ï¼Œè¯´ç¨‹åºç¼–è¯‘é“¾æ¥éƒ½æ˜¯éª—äººçš„â€¦â€¦åˆ«æ€¥ï¼Œè¿™å¯èƒ½æ˜¯ç¼–è¯‘å™¨å°†<code>foo</code>å‡½æ•°ç›´æ¥å†…è”äº†ï¼Œç”¨ä»£ç æ›¿æ¢äº†å‡½æ•°è°ƒç”¨ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬è¦è®¨è®ºçš„å†…å®¹ã€‚</del></p><p>ä¸€ä¸ªå†…è”çš„ä¾‹å­ï¼Œç”¨<code>mov eax, 5</code>æ›¿æ¢äº†å¯¹å‡½æ•°fooçš„è°ƒç”¨(Releaseæ¨¡å¼ä¸‹)ã€‚</p><img title="ä¾‹å­" src="inline_o.png" data-align="center"><h2 id="Extern-åœ¨å£°æ˜å…¨å±€å˜é‡æ—¶çš„ä½œç”¨"><a href="#Extern-åœ¨å£°æ˜å…¨å±€å˜é‡æ—¶çš„ä½œç”¨" class="headerlink" title="Extern åœ¨å£°æ˜å…¨å±€å˜é‡æ—¶çš„ä½œç”¨"></a>Extern åœ¨å£°æ˜å…¨å±€å˜é‡æ—¶çš„ä½œç”¨</h2><p>é—¹äº†åŠå¤©ä¸»è§’â€externâ€éƒ½æ²¡å‡ºç°ï¼Œç°åœ¨å¼€å§‹è¿›å…¥æ­£é¢˜ã€‚</p><p>å¯¹å‡½æ•°è¿›è¡Œåˆ†æ–‡ä»¶ç¼–å†™æ˜¯å‘¼å¸ä¸€æ ·å¹³å¸¸çš„äº‹æƒ…ï¼Œè€Œç»å¸¸ç¼–å†™C&#x2F;C++ç¨‹åºçš„è¯ï¼Œå…¨å±€å˜é‡&#x2F;å‘½åç©ºé—´å±€éƒ¨å˜é‡å°†æ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„ä¸œè¥¿ã€‚å®ƒä¹Ÿèƒ½åƒå‡½æ•°ä¸€æ ·ï¼Œå°†å£°æ˜ä¸å®šä¹‰åˆ†ç¦»ã€‚ä¸‹é¢å°†è¿›è¡Œå±•ç¤º~  </p><p>(ä½¿ç”¨MSVC)</p><pre><code class="cpp">// header &quot;bar.h&quot;extern int bar;</code></pre><pre><code class="cpp">// source &quot;bar.cpp&quot;int bar&#123; 123 &#125;;</code></pre><pre><code class="cpp">// main.cpp#include &quot;bar.h&quot;int main()&#123;    return bar;&#125;</code></pre><p>æ²¡é”™ï¼Œ <code>extern</code>å…³é”®å­—å‡ºç°äº†ï¼Œå®ƒå‘Šè¯‰é“¾æ¥å™¨è¿™ä¸ªå«<code>bar</code>çš„ï¼Œç­‰ä¼šå»åˆ«çš„ç¿»è¯‘å•å…ƒä¸­æŸ¥æ‰¾å®šä¹‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œéå¸¸é‡å…¨å±€å˜é‡å…·æœ‰å¤–éƒ¨é“¾æ¥ï¼Œå¦‚ä½ æ‰€è§ï¼Œè¿™ä¸ª<code>bar</code>å°±æ˜¯ä¸€ä¸ªéå¸¸é‡å…¨å±€å˜é‡ï¼Œå®ƒå…·æœ‰å¤–éƒ¨é“¾æ¥ï¼Œé“¾æ¥å™¨è®©è¿œåœ¨ä»–<code>.obj</code>çš„<code>main</code>å‡½æ•°ä¹Ÿèƒ½æ‰¾åˆ°å®ƒã€‚</p><hr><div id="toolongtowatch">æˆ‘æ‰€ç†ŸçŸ¥çš„æƒ…å†µåˆ°è¿™å°±ç»“æŸäº†ï¼Œä½†æ˜¯å‰å‡ å¤©ï¼Œæˆ‘åœ¨æ•´ç†æ—§çš„ä»£ç çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªå¥‡æ€ªåˆç†Ÿæ‚‰çš„ä¸œè¥¿ï¼š</div><pre><code class="cpp">namespace Petal::UserEntrance&#123;    extern const fptr&lt;int&gt; pt_user_main&#123; &amp;::MainFunc &#125;;    extern const ptrc&lt;TChar&gt; pt_user_main_name&#123; Petal_TStr(#MainFunc) &#125;;&#125;</code></pre><p>åœ¨å®šä¹‰çš„æ—¶å€™å‡ºç°äº†å…³é”®å­—<code>extern</code>ï¼Œæ˜¾ç„¶æ­¤æ—¶æˆ‘å·²ç»å¿˜è®°äº†<code>extern</code>åœ¨æ­¤å¤„çš„ä½œç”¨ï¼Œæˆ‘æŠ±ç€å¥½å¥‡çš„å¿ƒæ€å°†å®ƒåˆ äº†(æŒ‡<code>extern</code>)ï¼Œç»“æœå‡ºç°äº†é“¾æ¥é”™è¯¯ï¼š</p><table><thead><tr><th>ä»£ç </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><a href="https://learn.microsoft.com/zh-cn/cpp/error-messages/tool-errors/linker-tools-error-lnk2001">LNK2001</a></td><td>æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· â€œint (__cdecl* Petal::UserEntrance::pt_user_main)(void)â€ (?pt_user_main@UserEntrance@Petal@@3Q6AHXZEA)</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/cpp/error-messages/tool-errors/linker-tools-error-lnk2001">LNK2001</a></td><td>æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· â€œwchar_t const * const Petal::UserEntrance::pt_user_main_nameâ€ (?pt_user_main_name@UserEntrance@Petal@@3QEB_WEB)</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/cpp/error-messages/tool-errors/linker-tools-error-lnk1120">LNK1120</a></td><td>2 ä¸ªæ— æ³•è§£æçš„å¤–éƒ¨å‘½ä»¤</td></tr></tbody></table><p>ç»å…¸é“¾æ¥é”™è¯¯  </p><p><em>Classic</em>  </p><p>æˆ‘å¿˜è®°äº†å½“æ—¶ä¸ºä»€ä¹ˆä¼šè¿™æ ·å†™ï¼ŒæŸ¥ä¸‹MSDNã€‚</p><p><a href="https://learn.microsoft.com/zh-cn/cpp/cpp/extern-cpp?view=msvc-170">extern (C++) | Microsoft Learn | zh-cn</a></p><p><a href="https://learn.microsoft.com/en-us/cpp/cpp/extern-cpp?view=msvc-170">extern (C++) | Microsoft Learn | en-us</a></p><p>æˆ‘æœç„¶æ˜¯å¥å¿˜çš„ï¼Œæ•…å†™ä¸‹åšå®¢ä»¥ä¾¿æœªæ¥å“ªå¤©çŠ¯å‚»äº†èƒ½å¿«é€Ÿæ‰¾åˆ°ä¹‹å‰çš„ç»éªŒ</p><img title="cat" src="my_cat.jpg" width="298" data-align="center"><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¨å±€å¸¸é‡å˜é‡å…·æœ‰å†…éƒ¨é“¾æ¥ï¼Œå³ä½¿åœ¨å¤–å£°æ˜ä¹Ÿæ— æ³•ä½¿ç”¨ï¼Œé™¤éåœ¨å®šä¹‰æ—¶åœ¨å‰é¢åŠ ä¸Šå…³é”®å­—<code>extern</code>ã€‚ç”¨<code>bar</code>æ¥ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="cpp">// header &quot;bar.h&quot;extern const int bar;</code></pre><pre><code class="cpp">// source &quot;bar.cpp&quot;extern const int bar&#123; 123 &#125;;</code></pre><pre><code class="cpp">// main.cpp#include &quot;bar.h&quot;int main()&#123;    return bar;&#125;</code></pre><hr><h2 id="C-å…¨å±€å˜é‡çš„é“¾æ¥"><a href="#C-å…¨å±€å˜é‡çš„é“¾æ¥" class="headerlink" title="C++å…¨å±€å˜é‡çš„é“¾æ¥"></a>C++å…¨å±€å˜é‡çš„é“¾æ¥</h2><p>æ—¢ç„¶éƒ½è¯´åˆ°è¿™ä»½ä¸Šï¼Œè¿˜æ˜¯å¤ä¹ ä¸€ä¸‹VC++ä¸­å…¨å±€å˜é‡(åŠå‘½åç©ºé—´å±€éƒ¨å˜é‡)æ‰€å…·æœ‰çš„é“¾æ¥(ä¸åŒ…å«C++20åŠæ›´é«˜æ ‡å‡†çš„å†…å®¹)ã€‚</p><p>ä»…å†…éƒ¨é“¾æ¥ï¼š</p><ul><li><p>ä½¿ç”¨ <code>static</code> å£°æ˜çš„å…¨å±€å˜é‡æˆ–å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li><li><p>ç±»å‹å…·æœ‰ <code>const</code> é™å®šä¸”æ—  <code>inline</code> è¯´æ˜ç¬¦ å¹¶ä¸” å…ˆå‰æ²¡æœ‰å¤–éƒ¨é“¾æ¥çš„å£°æ˜ çš„å…¨å±€å˜é‡æˆ–å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li><li><p>æ— åå‘½åç©ºé—´åŠå…¶ä¸­çš„å‘½åç©ºé—´ä¸­çš„å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li></ul><p>ä¾‹</p><pre><code class="cpp">// test.cppstatic int foo&#123; 1 &#125;;const int bar&#123; 2 &#125;;namespace &#123; int unnamed&#123; 3 &#125;; &#125;</code></pre><pre><code class="cpp">// main.cppextern int foo;extern const int bar;extern int baz;int main()&#123;    int&#123; foo &#125;; // LNK2001    int&#123; bar &#125;; // LNK2001    int&#123; baz &#125;; // LNK2001    return 0;&#125;</code></pre><p>å¤–éƒ¨é“¾æ¥(ä¸åœ¨æ— åå‘½åç©ºé—´åŠå…¶ä¸­çš„å‘½åç©ºé—´å†…å®šä¹‰çš„æƒ…å†µ)ï¼š</p><ul><li><p>ä½¿ç”¨externå£°æ˜çš„å…¨å±€å˜é‡æˆ–å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li><li><p>æ²¡æœ‰consté™å®šçš„å…¨å±€å˜é‡æˆ–å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li></ul><p>ä¾‹</p><pre><code class="cpp">// test.cppextern const int foo&#123; 1 &#125;;int bar&#123; 2 &#125;;extern const int baz;const int baz&#123; 3 &#125;;</code></pre><pre><code class="cpp">// main.cppextern const int foo;extern int bar;extern const int baz;int main()&#123;    int&#123; foo &#125;;    int&#123; bar &#125;;    int&#123; baz &#125;;    return 0;&#125;</code></pre><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒC++å¼•ç”¨å¿½ç•¥é™å®šç¬¦ï¼Œæ‰€ä»¥å¦‚ä¸‹ä¹Ÿèƒ½é€šè¿‡ç¼–è¯‘é“¾æ¥(MSVC)ï¼š</p><pre><code class="cpp">// test.cppint val&#123; 100 &#125;;int const/*æ­¤consté™å®šint*/ &amp;const/*æ­¤constæ— æ•ˆ*/ test&#123; val &#125;;</code></pre><pre><code class="cpp">extern const int&amp; const test;int main()&#123;    int&#123; test &#125;;    return 0;&#125;</code></pre><p>ä½†è¯·ä¸è¦è¿™ä¹ˆç¼–å†™ä»£ç ã€‚</p><p>æ›´å¤æ‚çš„ä¾‹å­(å…¶å®åˆ†æ¸…é¡¶å±‚constå’Œåº•å±‚constçš„åŒºåˆ«å°±ä¸ä¼šè¢«consté™å®šè¿·æƒ‘ä½äº†)</p><pre><code class="cpp">// test.cppint* ptr1&#123; nullptr &#125;; // å¤–éƒ¨é“¾æ¥const int* ptrc1&#123; nullptr &#125;; // å¤–éƒ¨é“¾æ¥int *const cptr1&#123; nullptr &#125;; // å†…éƒ¨é“¾æ¥int const* const cptrc1&#123; nullptr &#125;; // å†…éƒ¨é“¾æ¥int const* const&amp; cptrcr1&#123; cptrc1 &#125;; // å¤–éƒ¨é“¾æ¥extern int const* const cptrc2&#123; nullptr &#125;; // å¤–éƒ¨é“¾æ¥</code></pre><p>C++å‚è€ƒ</p><p><a href="https://zh.cppreference.com/w/cpp/language/storage_duration">å­˜å‚¨ç±»è¯´æ˜ç¬¦ - cppreference.com</a></p><p><a href="https://en.cppreference.com/w/cpp/language/storage_duration">Storage class specifiers - cppreference.com</a></p><hr><p>å®Œç»“ï¼</p>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> çŒä¸åŠé˜²ç³»åˆ— </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
