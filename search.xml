<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>C++20 æ¯”å®æ›´å¥½ç”¨çš„source_location</title>
      <link href="/2024/02/09/%E6%AF%94%E5%AE%8F%E6%9B%B4%E5%A5%BD%E7%94%A8%E7%9A%84source-location/"/>
      <url>/2024/02/09/%E6%AF%94%E5%AE%8F%E6%9B%B4%E5%A5%BD%E7%94%A8%E7%9A%84source-location/</url>
      
        <content type="html"><![CDATA[<h3 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h3><pre><code class="C++">// ä½ ä¸ä¼šå–œæ¬¢è¿™ä¸ª#if defined(_UNICODE) || defined(UNICODE)#define MY_FILET __FILEW__#else#define MY_FILET __FILE__#endif#define MY_THROW_IF_FAILED(code) \    ::my::ThrowIfFailed(code, TEXT(#code), MY_FILET, __LINE__);</code></pre><a href="#æ³¨"><div><i>åœ¨è¿‡å»çš„æ—¥å­é‡Œï¼Œé‚ªæ¶å½“é“ï¼</i><br /><p align="right"><i>â€”â€”Kristen Nygaard</i></p></div><div><i>è€Œä¸”ï¼Œæˆ‘è¿˜æŒæœ‰è¿™æ ·çš„è§‚ç‚¹ï¼šCppå¿…é¡»è¢«æ‘§æ¯ã€‚</i><br />  <p align="right"><i>â€”â€”è€åŠ å›¾ï¼ˆMarcus Porcius Catoï¼‰</i></p><br />  </div>  </a><h3 id="æ›¾ç»å½“ä¸‹å¯ç”¨çš„C"><a href="#æ›¾ç»å½“ä¸‹å¯ç”¨çš„C" class="headerlink" title="æ›¾ç»å½“ä¸‹å¯ç”¨çš„C++"></a>æ›¾ç»å½“ä¸‹å¯ç”¨çš„C++</h3><p>åœ¨<text id="dragon">ã€ŠDX12 3D æ¸¸æˆå¼€å‘å®æˆ˜ã€‹</text>å‡ºç‰ˆä¹‹é™…(æŒ‡è‹±æ–‡åŸç‰ˆï¼Œå‡ºç‰ˆæ—¥æœŸ2016&#x2F;03&#x2F;24ï¼Œå¼•ç”¨è‡ª<a href="https://www.amazon.com/Introduction-3D-Game-Programming-DirectX/dp/1942270062">äºšé©¬é€Š</a>)ï¼ŒC++è¿˜å¤„äºå‡†å¤‡è¿ˆå…¥C++17çš„æ—¶ä»£ã€‚â€œ<a href="#%E5%BC%95">å¼•</a>â€ä¸­çš„ä»£ç æ˜¯å…¶ä¸­ç¤ºä¾‹çš„ä¸€ä¸ªå˜å½¢ï¼šAPIå¾€å¾€è¿”å›ä¸€ä¸ª<code>HRESULT</code>ç±»å‹çš„å€¼(å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§é”™è¯¯ç )ï¼Œç„¶åæˆ‘ä»¬å¯é€šè¿‡<code>FAILED</code>å®æ¥æ£€æµ‹è¿”å›å€¼æ˜¯å¦ä»£è¡¨å¤±è´¥ã€‚å¦‚æœå¤±è´¥ï¼Œè¿˜è¦è°ƒç”¨<code>_com_error::ErrorMessgae</code>æ¥è·å–å¤±è´¥ä¿¡æ¯ï¼Œå¹¶å°†æ–‡ä»¶åã€è¡Œå·ã€ä»£ç å’Œé”™è¯¯ä¿¡æ¯ä¸€å¹¶å¡åˆ°ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±»çš„å¯¹è±¡é‡Œï¼Œå¹¶æŠ›å‡ºå®ƒã€‚åœ¨ç¨‹åºå‡ºé”™æ—¶ï¼Œè¿™äº›ä¿¡æ¯å¯¹æ­£åœ¨å­¦ä¹ D3Dçš„äººå°†å¾ˆæœ‰å¸®åŠ©ã€‚  </p><p>â€œå¼•â€ä¸­çš„ä»£ç æ˜¯æˆ‘æ ¹æ®è®°å¿†æ”¹å†™çš„ï¼Œå¯ä»¥å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬æ— Cpp(Cè¯­è¨€é¢„å¤„ç†å™¨)å¯ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¸å¾—ä¸åœ¨æ¯æ¬¡è°ƒç”¨<code>my::ThrowIfFailed</code>è¿™ä¸ªå‡½æ•°æ—¶æ‰‹åŠ¨å¡«å†™<code>__FILE__</code>&#x2F;<code>__FILEW__</code>å’Œ<code>__LINE__</code>ï¼Œä½œä¸ºç¬¬ä¸‰å’Œç¬¬å››ä¸ªå‚æ•°ï¼Œå¯¹äºå¤§é‡çš„æ£€æµ‹éœ€æ±‚ï¼Œæ‰‹å·¥ä»£ç ä»£ä»·é«˜æ˜‚ï¼Œè€—å°½äº†æˆ‘ä»¬çš„ç²¾åŠ›â€¦â€¦</p><h4 id="ä¸ºä»€ä¹ˆæ˜¯å®"><a href="#ä¸ºä»€ä¹ˆæ˜¯å®" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯å®"></a>ä¸ºä»€ä¹ˆæ˜¯å®</h4><p>å®æˆ–è€…ä¸æ˜¯ä¸€ä¸ªå®ï¼Œè¿™æ˜¯ä¸ªé—®é¢˜ã€‚æœ‰ä»€ä¹ˆè¯¡è®¡èƒ½è®©æˆ‘ä»¬åŒæ—¶é¿å…å®å’Œæ‰‹åŠ¨å¡«å†™å‚æ•°å—ï¼Ÿæœ‰äººå¯èƒ½ä¼šæƒ³åˆ°ç»™å‡½æ•°å¡«å†™é»˜è®¤å‚æ•°ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œå‡½æ•°é»˜è®¤å‚æ•°æ˜¯è¡Œä¸é€šçš„ï¼Œè¿™ç§æ–¹æ³•ä¸èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚æœ€åæˆ‘ä»¬å¦¥åäº†ï¼Œé€‰æ‹©äº†å®â€”â€”å¦‚æœæœ‰å…¶ä»–æ›´å¥½çš„åŠæ³•ï¼Œå¼—å…°å…‹å”å”ä¸ºä»€ä¹ˆä¸å‘Šè¯‰æˆ‘ä»¬å‘¢ï¼Ÿæˆ‘è®°å¾—<a href="https://www.amazon.com/Introduction-3D-Game-Programming-DirectX/dp/1942270062">é¾™ä¹¦</a>ä½œè€…æ›¾åœ¨ä¹¦é‡Œé˜è¿°è¿‡åŸå› ï¼Œå¦‚æœä½ äº†è§£å®åªæ˜¯ç®€å•çš„æ–‡æœ¬æ›¿æ¢ï¼Œä½ ä¹Ÿèƒ½é©¬ä¸Šæ˜ç™½åŸå› æ‰€åœ¨ã€‚é¢„å¤„ç†èƒ½è®©å® <code>__FILE__</code>ã€<code>__LINE__</code> å‡ºç°åœ¨æºæ–‡ä»¶ä¸­æ­£ç¡®çš„ä½ç½®ï¼Œæ­¤å¤„å°±ä¸èµ˜è¿°äº†ã€‚  </p><p>æ­¤å¤–ï¼Œ<code>TEXT(#code)</code> è¿™æ ·çš„ä¸œè¥¿åªé€‚ç”¨äºMSVCï¼Œåœ¨ gcc ç­‰å¹³å°æ— æ³•é€šè¿‡ç¼–è¯‘(å¦‚æœ‰å…´è¶£å¯ä»¥è¯¦ç»†æŸ¥çœ‹é¢„å¤„ç†å™¨çš„é‚£äº›è§„åˆ™)ï¼Œå…¶ä¸­<code>TEXT</code>æ˜¯å®ï¼Œå¯èƒ½çš„å®ç°ï¼š  </p><pre><code class="C++">#if defined(_UNICODE) || defined(UNICODE)#define TEXT(quote) L##quote#else#define TEXT(quote) quote#endif</code></pre><p>æµ‹è¯•ä»¥é»˜è®¤å‚æ•°çš„å½¢å¼å®ç°ä¸ThrowIfFailedç›¸ä¼¼çš„ä»£ç ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;string&gt;void bad_log(std::string_view msg, const char* caller, const char* file = __FILE__, int line = __LINE__)&#123;    std::cout        &lt;&lt; &quot;FILE: &quot; &lt;&lt; file &lt;&lt; &quot; LINE: &quot; &lt;&lt; line &lt;&lt; &quot; CALLER: &quot; &lt;&lt; caller        &lt;&lt; &quot; MSG: &quot; &lt;&lt; msg &lt;&lt; &quot;\n&quot;;&#125;int main()&#123;    bad_log(&quot;Hell&quot;, __FUNCTION__);    bad_log(&quot;Hell&quot;, __func__);&#125;</code></pre><p>å¯èƒ½çš„è¾“å‡ºï¼š</p><pre><code>FILE: xxx/main.cpp LINE: 5 CALLER: main MSG: HellFILE: xxx/main.cpp LINE: 5 CALLER: main MSG: Hell</code></pre><p>å¾ˆæ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬è¦çš„æ•ˆæœï¼Œåœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œä¸ç®¡åœ¨å“ªé‡Œä½¿ç”¨é»˜è®¤å‚æ•°è°ƒç”¨<code>bad_log</code>ï¼Œå®ƒçš„å®å‚<code>line</code>æ€»æ˜¯<code>5</code>ï¼Œç”±äº<code>bad_log</code>è°ƒç”¨å’Œ<code>bad_log</code>çš„å£°æ˜åŒå¤„ä¸€ä¸ªæºæ–‡ä»¶ï¼Œå®ƒèƒ½ä»¥æˆ‘ä»¬æœŸæœ›çš„æ–¹å¼å·¥ä½œï¼Œä½†è¿™ä¸å¤Ÿï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¤´æ–‡ä»¶é‡Œå¯¹<code>bad_log</code>è¿›è¡Œå£°æ˜(åŒ…æ‹¬é»˜è®¤å‚æ•°çš„å®šä¹‰)ï¼Œå®ƒå°†ä¸èƒ½æŒ‰æˆ‘ä»¬çš„æ„æ„¿å·¥ä½œ(å€¼æ€»æ˜¯ä»£è¡¨å£°æ˜å®ƒçš„å¤´æ–‡ä»¶çš„åç§°ï¼Œä½¿ç”¨MSVCæµ‹è¯•)ã€‚<br>ç®€è€Œè¨€ä¹‹ï¼šOnly MACRO can do.  </p><h3 id="å½“ä¸‹å¯ç”¨çš„C"><a href="#å½“ä¸‹å¯ç”¨çš„C" class="headerlink" title="å½“ä¸‹å¯ç”¨çš„C++"></a>å½“ä¸‹å¯ç”¨çš„C++</h3><p>æˆ‘åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæ­£å€¼é™¤å¤•(å®é™…å†™åˆ°è¿™é‡Œæ—¶å·²ç»åˆ°æ­£æœˆåˆä¸€äº†)ï¼Œå¯ä»¥è¯´å„ç§æ„ä¹‰ä¸Šéƒ½è¿›å…¥2024å¹´äº†ã€‚C++23å°šä¸”ä¸èƒ½è¢«æ”¯æŒå®Œå–„ï¼Œä½†æ˜¯C++20å¯ç”¨ã€‚ç„¶è€Œå°±åœ¨C++20ä¸­ï¼Œæ ‡å‡†åº“ä¸­å¢åŠ äº†<code>std::source_location</code>ï¼Œä»¥è§£å†³æˆ‘ä»¬çš„ç‡ƒçœ‰ä¹‹æ€¥ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;source_location&gt;void log(std::string_view msg = &quot;&quot;, const std::source_location&amp; location = std::source_location::current())&#123;    std::cout        &lt;&lt; &quot;FILE: &quot;    &lt;&lt; location.file_name()        &lt;&lt; &quot;(&quot;         &lt;&lt; location.line() &lt;&lt; &quot;,&quot; &lt;&lt; location.column() &lt;&lt; &quot;)&quot;        &lt;&lt; &quot; CALLER: &quot; &lt;&lt; location.function_name()        &lt;&lt; &quot; MSG: &quot;    &lt;&lt; msg &lt;&lt; &quot;\n&quot;;&#125;int main()&#123;    log(&quot;Hello&quot;);&#125;</code></pre><p>å¯èƒ½çš„è¾“å‡º(MSVC)ï¼š</p><pre><code>FILE: xxx/main.cpp(16,2) CALLER: int __cdecl main(void) MSG: Hello</code></pre><p>æ³¨ï¼šå…¨éƒ¨ä½¿ç”¨<code>TAB</code>è¡¨ç¤ºç¼©è¿›è€Œéç©ºæ ¼ï¼ˆè¿™ä¼šå½±å“<code>column</code>çš„è¿”å›å€¼ï¼Œå¦‚æœä½¿ç”¨å››ä¸ªç©ºæ ¼è¡¨ç¤ºç¼©è¿›ï¼Œæˆ‘æƒ³<code>column</code>çš„è¿”å›å€¼ä¼šæ˜¯<code>5</code>ï¼‰ã€‚  </p><p>è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><h4 id="std-source-location-current"><a href="#std-source-location-current" class="headerlink" title="std::source_location::current"></a>std::source_location::current</h4><p><code>std::source_location::current</code>å‡½æ•°å°†æ„é€ ä¸€ä¸ªè¡¨ç¤ºè°ƒç”¨ä½ç½®çš„ source_location å¯¹è±¡ã€‚  </p><p>è‹¥ç›´æ¥è°ƒç”¨ <code>current()</code> ï¼ˆé€šè¿‡æŒ‡å <code>current()</code> çš„å‡½æ•°è°ƒç”¨ï¼‰ï¼Œåˆ™å®ƒè¿”å›å¯¹åº”è°ƒç”¨ä½ç½®çš„æ‹¥æœ‰å®ç°å®šä¹‰å€¼çš„ <code>source_location</code> å¯¹è±¡ã€‚è¯¥å€¼åº”å½“ä»¥åŒé¢„å®šä¹‰å® <code>__LINE__</code> ä¸ <code>__FILE__</code> çš„æ–¹å¼å— <code>#line</code> é¢„å¤„ç†æŒ‡ä»¤å½±å“ã€‚<br>è‹¥åœ¨é»˜è®¤æˆå‘˜åˆå§‹åŒ–å™¨ä¸­ä½¿ç”¨ <code>current()</code>ï¼Œåˆ™è¿”å›å€¼å¯¹åº”åˆå§‹åŒ–è¯¥æ•°æ®æˆå‘˜çš„æ„é€ å‡½æ•°å®šä¹‰æˆ–èšåˆåˆå§‹åŒ–çš„ä½ç½®ã€‚<br>è‹¥ <code>current()</code> ç”¨äºé»˜è®¤å‚æ•°ï¼Œåˆ™è¿”å›å€¼å¯¹åº”å¯¹ <code>current()</code> çš„è°ƒç”¨çš„è°ƒç”¨ç‚¹ä½ç½®ã€‚<br>è‹¥ä»¥ä»»ä½•å…¶ä»–æ–¹å¼è°ƒç”¨ <code>current()</code> ï¼Œåˆ™è¿”å›å€¼æœªæŒ‡å®šã€‚  </p><p>æ³¨ï¼š<code>std::source_location::current</code> é€šå¸¸è¦æ±‚ç¼–è¯‘å™¨çš„å†…å»ºå®ç°ã€‚  </p><p>ä»¥ä¸Šæ˜¯ <a href="https://zh.cppreference.com/w/cpp/utility/source_location">c++ reference</a> ä¸­çš„æè¿°(ç¨æœ‰æ”¹åŠ¨)ã€‚<br>ä»¥ä¸‹æ˜¯æˆ‘å†™çš„ç¤ºä¾‹ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;source_location&gt;// curr line: 4void log(std::string_view msg = &quot;&quot;, const std::source_location&amp; location = std::source_location::current())&#123;    std::cout        &lt;&lt; &quot;FILE: &quot; &lt;&lt; location.file_name()        &lt;&lt; &quot;(&quot; &lt;&lt; location.line() &lt;&lt; &quot;,&quot; &lt;&lt; location.column() &lt;&lt; &quot;)&quot;        &lt;&lt; &quot; CALLER: &quot; &lt;&lt; location.function_name()        &lt;&lt; &quot; MSG: &quot; &lt;&lt; msg &lt;&lt; &quot;\n&quot;;&#125;// curr line: 13struct T1 // ä½¿ç”¨é»˜è®¤æˆå‘˜åˆå§‹åŒ–å™¨&#123;    std::source_location loc = std::source_location::current();&#125;;// curr line: 18struct T2 // ä½¿ç”¨æ„é€ å‡½æ•°çš„æˆå‘˜åˆå§‹åŒ–å™¨åˆ—è¡¨&#123;    T2() : loc&#123; std::source_location::current() &#125; &#123;&#125;    std::source_location loc;&#125;;// curr line: 24struct T3 // å°†åœ¨mainå‡½æ•°ä¸­ä½¿ç”¨èšåˆåˆå§‹åŒ–&#123;    std::source_location loc;&#125;;// curr line: 29int main()&#123;    T1 t1&#123;&#125;; // curr line: 32    log(&quot;T1&quot;, t1.loc);    T2 t2&#123;&#125;; // curr line: 34    log(&quot;T2&quot;, t2.loc);    T3 t3&#123; std::source_location::current() &#125;; // curr line: 36    log(&quot;T3&quot;, t3.loc);    return 0;&#125;</code></pre><p>å¯èƒ½çš„è¾“å‡º(MSVC)ï¼š  </p><pre><code>FILE: xxx\main.cpp(32,8) CALLER: int __cdecl main(void) MSG: T1FILE: xxx\main.cpp(21,36) CALLER: __cdecl T2::T2(void) MSG: T2FILE: xxx\main.cpp(36,31) CALLER: int __cdecl main(void) MSG: T3</code></pre><p>é¢„å¤„ç†æŒ‡ä»¤ <code>#line</code> å½±å“ <code>std::source_location::current</code> çš„ä¾‹å­ï¼š  </p><pre><code class="C++">#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;source_location&gt;void log(std::string_view msg = &quot;&quot;, const std::source_location&amp; location = std::source_location::current())&#123;    std::cout        &lt;&lt; &quot;FILE: &quot; &lt;&lt; location.file_name()        &lt;&lt; &quot;(&quot; &lt;&lt; location.line() &lt;&lt; &quot;,&quot; &lt;&lt; location.column() &lt;&lt; &quot;)&quot;        &lt;&lt; &quot; CALLER: &quot; &lt;&lt; location.function_name()        &lt;&lt; &quot; MSG: &quot; &lt;&lt; msg &lt;&lt; &quot;\n&quot;;&#125;int main()&#123;#line 123456 &quot;foo.cpp&quot;    u8&quot;ğŸ˜&quot;; // __LINE__: 123456    log(&quot;after #line&quot;, std::source_location::current());  // __LINE__: 123457    return 0;&#125;</code></pre><p>å¯èƒ½çš„è¾“å‡º(MSVC)ï¼š  </p><pre><code>FILE: xxx\foo.cpp(123457,43) CALLER: int __cdecl main(void) MSG: after #line</code></pre><p>é¢„å¤„ç†æŒ‡ä»¤ <code>#line</code> çš„ <a href="https://zh.cppreference.com/w/cpp/preprocessor/line" title="é¢„å¤„ç†æŒ‡ä»¤ #line">c++ reference</a>ã€‚  </p><h3 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h3><p>åœ¨ä½¿ç”¨C++æ—¶ï¼Œæ€»ä¼šå¬åˆ°åˆ«äººå»ºè®®â€œå°½é‡é¿å…ä½¿ç”¨å®â€ç­‰ã€‚æ­£å¦‚é¢˜æ³¨æ‰€éšå«çš„ä¿¡æ¯ï¼Œæœ¬è´¾å°¼å°±ä¸å–œæ¬¢Cè¯­è¨€é¢„å¤„ç†å™¨ï¼ŒC++ä¹Ÿåœ¨ç«­åŠ›æä¾›ä¸ä¾é é¢„å¤„ç†å™¨çš„é€‰æ‹©ï¼Œæ¯”å¦‚æ¨¡æ¿ä½¿å¾—ç¨‹åºå‘˜ä¸å¿…å†ä½¿ç”¨å®æ¥æ³›å‹ç¼–ç¨‹ã€æ¨¡å—ä½¿å¾—ç¨‹åºå‘˜æ‘†è„±<code>#include</code>æŒ‡ä»¤æ˜¯å”¯ä¸€é€‰æ‹©çš„å¢ƒåœ°ã€åŒ…æ‹¬æœ¬æ–‡æ‰€æåˆ°çš„<code>std::source_location</code>ä¹Ÿæ·¡åŒ–äº†ä½¿ç”¨<code>__FILE__</code>å’Œ<code>__LINE__</code>çš„å¿…è¦æ€§ï¼Œæ¯•ç«Ÿï¼Œæˆ‘ä»¬ç°åœ¨æœ‰æ–°çš„ã€æ›´ä¼˜çš„æ–¹å¼è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚  </p><p>åœ¨æ²¡æœ‰æ¨¡æ¿çš„æ—¶æœŸç¼–å†™ä¸€ä¸ªæ”¯æŒæ³›å‹çš„å·¥å…· be likeï¼š  </p><pre><code class="CC">// stack.hclass ELEM_stack&#123;    ELEM *min, *top, *max;    ...&#125;</code></pre><pre><code class="CC">// main.cpp#define ELEM int#define ELEM_stack int_stack#include &quot;stack.h&quot;#undef ELEM#undef ELEM_stack#define ELEM float#define ELEM_stack float_stack#include &quot;stack.h&quot;#undef ELEM#undef ELEM_stackint_stack is;float_stack fs;</code></pre><blockquote><p>æºè‡ªã€ŠC++è¯­è¨€çš„è®¾è®¡å’Œæ¼”åŒ–ã€‹(2.9.2 æ²¡æœ‰æ¨¡æ¿æ—¶çš„å®¹å™¨ç±»)ã€‚</p></blockquote><h3 id="æ³¨"><a href="#æ³¨" class="headerlink" title="æ³¨"></a>æ³¨</h3><h4 id="å¼•-1"><a href="#å¼•-1" class="headerlink" title="_å¼•"></a>_å¼•</h4><p><em>è¿™<a href="#%E5%BC%95">ä¸¤å¥è¯</a>åˆ†åˆ«ä¸ºã€ŠC++è¯­è¨€è®¾è®¡ä¸æ¼”åŒ–ã€‹çš„ç¬¬ä¸€ç« ã€ŠC++çš„å²å‰æ—¶ä»£ã€‹ä¸æœ€åä¸€ç« ã€ŠCè¯­è¨€é¢„å¤„ç†å™¨ã€‹çš„é¢˜è®°ï¼ˆå¼•ç”¨çš„æ˜¯ä¸­æ–‡è¯‘æœ¬ï¼Œè£˜å®—ç‡•è¯‘ã€‚é¢˜è®°ä¸­çš„â€œCppâ€æŒ‡â€œCè¯­è¨€é¢„å¤„ç†å™¨â€”â€”C Preprocessorâ€ï¼‰ã€‚è€åŠ å›¾æ˜¯å¤ç½—é©¬æ”¿æ²»å®¶ï¼Œè€åŠ å›¾è‡ªç„¶ä¸å¯èƒ½å¯¹Cè¯­è¨€é¢„å¤„ç†å™¨æœ‰ä»€ä¹ˆæ„è§ï¼Œè¿™å¥è¯æ˜¯æ¨¡ä»¿çš„è€åŠ å›¾çš„åè¨€ï¼šè¿¦å¤ªåŸºå¿…é¡»è¢«æ‘§æ¯ã€‚</em>  </p>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
          <category> CPP20 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> CPP20 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†äº«VS2022Previewæ–°UI</title>
      <link href="/2024/02/03/%E5%88%86%E4%BA%ABVS2022Preview%E6%96%B0UI/"/>
      <url>/2024/02/03/%E5%88%86%E4%BA%ABVS2022Preview%E6%96%B0UI/</url>
      
        <content type="html"><![CDATA[<h3 id="æ ‡é¢˜äº”ä¸ªå­—"><a href="#æ ‡é¢˜äº”ä¸ªå­—" class="headerlink" title="æ ‡é¢˜äº”ä¸ªå­—"></a>æ ‡é¢˜äº”ä¸ªå­—</h3><img src="img_01.png" alt="æ•ˆæœå›¾1" data-align="center"><img src="img_02.png" alt="æ•ˆæœå›¾2" data-align="center"><img src="img_03.png" alt="æ•ˆæœå›¾3" data-align="center"><ul><li>Microsoft Visual Studio Community 2022 (64 ä½) - Preview</li><li>ç‰ˆæœ¬ 17.9.0 Preview 5.0</li></ul><p>æ¼‚äº®å¾—å¾ˆå‘ï¼Œ<del>ç”¨ä¸Šæ–° ui ç«‹é©¬å°±è§‰å¾—è€ ui ä¸‘åˆ°çœ‹ä¸ä¸‹å»äº†</del>ã€‚</p><img src="meme_alice_kawaii.jpg" alt="meme_alice_å¯çˆ±ï¼" width="330" height="261" data-align="center">]]></content>
      
      
      <categories>
          
          <category> æ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¥å¸¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cé£æ ¼å­—ç¬¦ä¸²ä¸CPPçš„çŸ›ç›¾</title>
      <link href="/2024/01/16/C%E9%A3%8E%E6%A0%BC%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8ECPP%E7%9A%84%E7%9F%9B%E7%9B%BE/"/>
      <url>/2024/01/16/C%E9%A3%8E%E6%A0%BC%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8ECPP%E7%9A%84%E7%9F%9B%E7%9B%BE/</url>
      
        <content type="html"><![CDATA[<style>.rev {    color: #101595;}</style><h3 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h3><img src="blue_pen.jpg" alt="è“çš„ç›†" width="353" height="264" data-align="center"><p>å£°æ˜ï¼šä¹±å†™çš„ã€‚  </p><h3 id="è§‚ç‚¹"><a href="#è§‚ç‚¹" class="headerlink" title="è§‚ç‚¹"></a>è§‚ç‚¹</h3><ol><li>å­—ç¬¦ä¸²å­—é¢é‡æŒæœ‰ç±»å‹ <code>const char_t[N]</code>ï¼Œå­—ç¬¦ä¸²é•¿åº¦ç­‰äº <code>N-1</code>ï¼›  </li><li>å­—ç¬¦ä¸²å­—é¢é‡ä¿è¯ <code>&quot;...&quot;[N-1]</code> ä¸º NULï¼Œå…¶ä¸­Næ˜¯(1)ä¸­çš„Nï¼›  </li><li>Cé£æ ¼å­—ç¬¦ä¸²ä»¥NULå­—ç¬¦è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸï¼›  </li><li>å­—ç¬¦ä¸²å­—é¢é‡é€šå¸¸è¢«ç”¨ä»¥è¡¨ç¤ºCé£æ ¼å­—ç¬¦ä¸²ï¼›  </li><li>å­—ç¬¦æ•°ç»„å¯¹è±¡é€€åŒ–ä¸ºæŒ‡é’ˆï¼Œä¸¢å¤±æ•°ç»„å¤§å°ä¿¡æ¯ï¼Œå®¹æ˜“äº§ç”Ÿè¶Šç•Œè®¿é—®ç”šè‡³å¼•èµ·é”™è¯¯ï¼›  </li><li>å­—ç¬¦ä¸²å­—é¢é‡æ‰€è¡¨ç¤ºçš„Cé£æ ¼å­—ç¬¦ä¸²é€šå¸¸ä»¥ <code>const char*</code> çš„å½¢å¼è¢«å¼•ç”¨ï¼›  </li><li>ä»ç±»å‹ä¸Šæ— æ³•åŒºåˆ†å­—ç¬¦ä¸²å­—é¢é‡å’Œå­—ç¬¦æ•°ç»„(<code>const char[N]</code>)ï¼›  </li><li>å‡½æ•°æ— æ³•åŒºåˆ†å®å‚æ˜¯å­—ç¬¦ä¸²å­—é¢é‡è¿˜æ˜¯å­—ç¬¦æ•°ç»„ï¼›  </li><li>Cé£æ ¼APIçš„å‚æ•°åˆ—è¡¨ <code>(const char* str, size_t len)</code> å¯¹å®‰å…¨çš„ä¿è¯æ— æµäºäº‹ï¼›  </li><li><code>std::string</code> ä¸åŒäºCé£æ ¼å­—ç¬¦ä¸²ï¼Œå®ƒå…è®¸å­—ç¬¦ä¸²å†…å­˜åœ¨NULå­—ç¬¦ï¼›  </li><li><code>std::string</code> ä¿è¯ <code>str[str.length()]</code> ä¸º NULï¼Œä¿è¯è¢«å½“ä½œCé£æ ¼å­—ç¬¦ä¸²æ—¶ç¬¦åˆâ€œä»¥NULç»“å°¾â€çš„è§„åˆ™ï¼›  </li><li><code>std::string</code> æä¾›äº† <code>c_str</code> æˆå‘˜å‡½æ•°ï¼›  </li><li>å½“ <code>std::string</code> å­—ç¬¦ä¸²å†…å­˜åœ¨NULå­—ç¬¦æ—¶ï¼ŒæŒ‰Cé£æ ¼å­—ç¬¦ä¸²çš„è§„åˆ™ï¼Œ<code>c_str</code> è¡¨ç¤ºçš„Cé£æ ¼å­—ç¬¦ä¸²è¢«å­—ç¬¦ä¸²å†…ç¬¬ä¸€ä¸ªNULå­—ç¬¦â€œæˆªæ–­â€ï¼›  </li><li>è‹¥ <code>std::string</code> å­—ç¬¦ä¸²å†…å­˜åœ¨NULå­—ç¬¦ï¼Œä½œä¸ºCé£æ ¼å­—ç¬¦ä¸²(<code>c_str</code>)æ—¶çš„è¡Œä¸ºå’Œå…¶æœ¬èº«<a href="#14">ä¸ä¸€è‡´</a>ï¼› </li><li><code>std::string_view</code> æ˜¯å­—ç¬¦ä¸²è§†å›¾ï¼›  </li><li><code>std::string_view</code> ä¸åŒäºCé£æ ¼å­—ç¬¦ä¸²ï¼Œå®ƒå…è®¸å­—ç¬¦ä¸²å†…å­˜åœ¨NULå­—ç¬¦ï¼›  </li><li><code>std::string_view</code> ä¸ä¿è¯ <code>str[str.length()]</code> ä¸º NULï¼›  </li><li><code>std::string_view</code> ä¸æä¾› <code>c_str</code> æˆå‘˜å‡½æ•°ï¼›  </li><li><code>std::string_view</code> å¯èƒ½æ˜¯æŸä¸ªå­—ç¬¦ä¸²çš„å­ä¸²ï¼›  </li><li><code>std::string_view</code> ä¸æŒæœ‰æ‰€è¡¨ç¤ºçš„å­—ç¬¦ä¸²çš„æ‰€æœ‰æƒï¼Œè€Œåƒæ˜¯ä¸€ç§å¼•ç”¨ï¼›  </li><li>ä»…å°†å­—ç¬¦ä¸²å­—é¢é‡ä½œä¸ºå®å‚ç”¨äºæ„é€  <code>std::string</code> å’Œ&#x2F;æˆ– <code>std::string_view</code>ï¼Œå°†åŒ¹é…åˆ°æ¥å—Cé£æ ¼å­—ç¬¦ä¸²çš„æ„é€ å‡½æ•°ï¼›  </li><li>å­—ç¬¦ä¸²å­—é¢é‡ä¸­å¯ä»¥å‡ºç°å€¼ä¸º NUL çš„å…ƒç´ ï¼›  </li><li>é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰å­—é¢é‡çš„æ–¹å¼ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„ <code>operator&quot;&quot;s</code> ä»å­—ç¬¦ä¸²å­—é¢é‡æ„é€  <code>std::string</code> å¯¹è±¡ï¼›  </li><li>é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰å­—é¢é‡çš„æ–¹å¼ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„ <code>operator&quot;&quot;sv</code> ä»å­—ç¬¦ä¸²å­—é¢é‡æ„é€  <code>std::string_view</code> å¯¹è±¡ï¼›  </li><li>é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰å­—é¢é‡è·å¾—çš„ <code>std::string</code>ã€<code>std::string_view</code> å¯¹è±¡ï¼Œå­—ç¬¦ä¸²é•¿åº¦æ€»æ˜¯ <code>N-1</code>ï¼Œä¸ç®¡å­—ç¬¦ä¸²å­—é¢é‡ä¸­æ˜¯å¦æœ‰ NULï¼Œè€Œ(20)ä¸­çš„æ„é€ æ–¹æ³•åˆ™ä¼šå— NUL å…ƒç´ çš„å½±å“ï¼Œ<a href="#25">ç¤ºä¾‹</a>ã€‚</li></ol><h3 id="äº‹é¡¹å’Œå»ºè®®"><a href="#äº‹é¡¹å’Œå»ºè®®" class="headerlink" title="äº‹é¡¹å’Œå»ºè®®"></a>äº‹é¡¹å’Œå»ºè®®</h3><ul><li><div class="rev">ä½¿ç”¨ç°ä»£C++ï¼Œ</div>  </li><li><div class="rev">å°½é‡ä½¿ç”¨ string å’Œ string_viewï¼Œ</div>  </li><li><div class="rev">å°½é‡é¿å…ä½¿ç”¨å­—ç¬¦æ•°ç»„è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œ</div>  </li><li><div class="rev">å°½é‡ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å­—é¢é‡é€šè¿‡å­—ç¬¦ä¸²å­—é¢é‡è·å¾—stringæˆ–string_viewå¯¹è±¡ï¼Œ</div>  </li><li><div class="rev">å½“å‡½æ•°æ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥å‚æ•°(ä¸ä¿®æ”¹)æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨ string_view åšå½¢å‚çš„ç±»å‹ï¼šT foo(string_view in);ï¼Œ</div>  </li><li><div class="rev">å½“å‡½æ•°æ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥è¾“å‡ºå‚æ•°ä¸”éœ€è¦ä¿®æ”¹å®ƒçš„å…ƒç´ æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨ span&lt;char_t> åšå½¢å‚çš„ç±»å‹(C++20)ï¼Œ</div>  </li><li><div class="rev">å½“å‡½æ•°æ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥è¾“å‡ºå‚æ•°ä¸”éœ€è¦ä¿®æ”¹å®ƒæ—¶(å¯èƒ½å¢é•¿æˆ–ç¼©çŸ­)ï¼Œè€ƒè™‘ä½¿ç”¨ string& åšå½¢å‚çš„ç±»å‹ï¼Œ</div>  </li><li><div class="rev">å‡½æ•°å‘è°ƒç”¨æ–¹è¾“å‡ºå­—ç¬¦ä¸²åº”å½“ä¼˜å…ˆé‡‡ç”¨è¿”å›å€¼çš„æ–¹å¼è¿”å› string ç±»å‹å­—ç¬¦ä¸²ï¼Œ</div>  </li><li><div class="rev">ä¸è¦è®© string_view çš„ç”Ÿå‘½å‘¨æœŸé•¿äºå®ƒå¼•ç”¨çš„å­—ç¬¦ä¸²çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚ä¸è¦è¿”å›ä»å±€éƒ¨(è‡ªåŠ¨å­˜å‚¨æœŸ) string å¯¹è±¡å¾—æ¥çš„ string_viewï¼Œå¯¹äº span åŒç†ï¼Œå®ƒä»¬éƒ½ä¸æ‹¥æœ‰èµ„æºçš„æ‰€æœ‰æƒï¼Œè€Œåƒæ˜¯ä¸€ç§â€œå¼•ç”¨â€ï¼Œ</div>  </li><li><div class="rev">å­—ç¬¦ä¸²å­—é¢é‡å…·æœ‰é™æ€å­˜å‚¨æœŸã€‚</div></li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="14"><a href="#14" class="headerlink" title="14"></a>14</h4><pre><code class="C++">cout &lt;&lt; string&#123; &quot;str\0ing&quot;, 7 &#125; &lt;&lt; &quot;\n&quot;;cout &lt;&lt; string&#123; &quot;str\0ing&quot;, 7 &#125;.c_str() &lt;&lt; &quot;\n&quot;;</code></pre><p>ç»“æœï¼š</p><pre><code>stringstr</code></pre><h4 id="25"><a href="#25" class="headerlink" title="25"></a>25</h4><pre><code class="C++">using namespace std::string_literals;using namespace std::string_view_literals;cout &lt;&lt; string&#123; &quot;str\0ing&quot; &#125; &lt;&lt; &quot;\n&quot;;cout &lt;&lt; string_view&#123; &quot;str\0ing&quot; &#125; &lt;&lt; &quot;\n&quot;;cout &lt;&lt; &quot;str\0ing&quot;s &lt;&lt; &quot;\n&quot;;cout &lt;&lt; &quot;str\0ing&quot;sv &lt;&lt; &quot;\n&quot;;</code></pre><p>ç»“æœï¼š</p><pre><code>strstrstringstring</code></pre>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++20 ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨</title>
      <link href="/2023/09/22/CPP20%E4%B8%89%E8%B7%AF%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2023/09/22/CPP20%E4%B8%89%E8%B7%AF%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<style>    .other_topic {        color: #528252;    }</style><h1 id="C-20ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦-â€œâ€"><a href="#C-20ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦-â€œâ€" class="headerlink" title="C++20ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ â€œ&lt;&#x3D;&gt;â€"></a>C++20ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ â€œ&lt;&#x3D;&gt;â€</h1><p>ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦æ˜¯ C++20 æ ‡å‡†æ–°åŠ å…¥çš„è¿ç®—ç¬¦ï¼Œæœ¬æ–‡å°†ä»‹ç»ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„åŸºæœ¬ä½¿ç”¨å’Œä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›å®ƒçš„æ–¹æ³•ã€‚<br>ä¸ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ç›¸å…³å†…å®¹åœ¨æ ‡å¤´ <code>&lt;compare&gt;</code> ä¸­ã€‚</p><h2 id="ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨"><a href="#ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨" class="headerlink" title="ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨"></a>ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„ä½¿ç”¨</h2><h3 id="ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¿”å›å€¼ç±»å‹"><a href="#ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¿”å›å€¼ç±»å‹" class="headerlink" title="ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¿”å›å€¼ç±»å‹"></a>ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¿”å›å€¼ç±»å‹</h3><p>C++20æ–°å¢ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç”¨äºç¡®å®šä¸¤ä¸ªå€¼çš„å¤§å°é¡ºåºã€‚å†…ç½®ç±»å‹çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›å€¼ä¸ä¸ºboolç±»å‹çš„çº¯å³å€¼ï¼Œè€Œæ˜¯å¦‚ä¸‹ç±»ç±»å‹ä¹‹ä¸€çš„ä¸€ä¸ªçº¯å³å€¼ã€‚  </p><div id="ordering_types">C++ä¸ºæˆ‘ä»¬æä¾›çš„ä¸‰ç§ç›¸åº”çš„ç±»å‹ï¼š</div>  <ul><li><code>std::strong_ordering</code>  </li><li><code>std::partial_ordering</code>  </li><li><code>std::weak_ordering</code></li></ul><p>å®ƒä»¬å¯ä»¥è¢«ç§°ä¸ºâ€œç±»æšä¸¾ç±»å‹â€(ä½¿ç”¨æ–¹æ³•å’Œâ€C++æšä¸¾ç±»-<a href="https://zh.cppreference.com/w/cpp/language/enum" title="cppref">æœ‰ä½œç”¨åŸŸæšä¸¾</a>â€œæœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¸ºç±»ç±»å‹ï¼Œæ•…ä¸¤è€…æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿)ã€‚  </p><h3 id="ä¸‰ç§orderingçš„éšå¼è½¬æ¢"><a href="#ä¸‰ç§orderingçš„éšå¼è½¬æ¢" class="headerlink" title="ä¸‰ç§orderingçš„éšå¼è½¬æ¢"></a>ä¸‰ç§orderingçš„éšå¼è½¬æ¢</h3><p><span id="ordering_cast"> ä¸‰ç§orderingçš„éšå¼è½¬æ¢ </span></p><p>å…¶ä¸­<code>std::strong_ordering</code>å¯ä»¥éšå¼è½¬æ¢ä¸º<code>std::weak_ordering</code>ï¼›<br><code>std::weak_ordering</code>å¯ä»¥éšå¼è½¬æ¢ä¸º<code>std::partial_ordering</code>ã€‚</p><h3 id="strong-ordering-å¼ºåº"><a href="#strong-ordering-å¼ºåº" class="headerlink" title="strong_ordering å¼ºåº"></a>strong_ordering å¼ºåº</h3><p>å¯¹äºæ•´æ•°ç±»å‹(åŒ…æ‹¬æŒ‡é’ˆç±»å‹)å’Œboolç±»å‹ï¼Œä¸‰è·¯æ¯”è¾ƒè¿ç®—çš„ç»“æœæ˜¯<code>std::strong_ordering</code>ç±»å‹çš„ï¼Œ<br>å…¶å€¼ä¸ºä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š  </p><ul><li><code>std::strong_ordering::less</code> ï¼šæŒ‡ç¤ºå…ˆåºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å°äºå³æ“ä½œæ•°  </li><li><code>std::strong_ordering::greater</code> ï¼šæŒ‡ç¤ºååºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å¤§äºå³æ“ä½œæ•°  </li><li><code>std::strong_ordering::equivalent</code> ï¼š<text id="intr_equivalent">æŒ‡ç¤ºç­‰ä»·å…³ç³»ï¼Œå³å·¦æ“ä½œæ•°ç­‰äºå³æ“ä½œæ•°</text>  </li><li><code>std::strong_ordering::equal</code> (ä¸<a href="#intr_equivalent">equivalent</a>ç›¸åŒ)</li></ul><p>æ³¨ï¼šå¦‚æœä¸‰è·¯æ¯”è¾ƒè¿ç®—çš„ä¸¤æ“ä½œæ•°ä¸€æ–¹ä¸ºboolç±»å‹è€Œå¦ä¸€æ–¹ä¸æ˜¯ï¼Œé‚£ä¹ˆç¨‹åºéè‰¯æ„ã€‚</p><h3 id="partial-ordering-ååº"><a href="#partial-ordering-ååº" class="headerlink" title="partial_ordering ååº"></a>partial_ordering ååº</h3><p>å¯¹äºæµ®ç‚¹ç±»å‹ï¼Œç»“æœåˆ™æ˜¯<code>std::partial_ordering</code>ç±»å‹çš„ï¼Œ<br>å…¶å€¼ä¸ºä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š  </p><ul><li><code>std::partial_ordering::less</code> ï¼šæŒ‡ç¤ºå…ˆåºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å°äºå³æ“ä½œæ•°  </li><li><code>std::partial_ordering::greater</code> ï¼šæŒ‡ç¤ºååºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å¤§äºå³æ“ä½œæ•°  </li><li><code>std::partial_ordering::equivalent</code> ï¼šæŒ‡ç¤ºç­‰ä»·å…³ç³»ï¼Œå³å·¦æ“ä½œæ•°ç­‰äºå³æ“ä½œæ•°  </li><li><code>std::partial_ordering::unordered</code> ï¼šæŒ‡ç¤ºä¸å¯æ¯”è¾ƒå€¼çš„å…³ç³»ï¼Œå½“æ“ä½œæ•°ä¸­å­˜åœ¨<code>NaN</code>æ—¶ç»“æœä¸º<code>unordered</code></li></ul><p>æ³¨ï¼šæ­£è´Ÿé›¶çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç»“æœä¸º<code>equivalent</code>  </p><h3 id="weak-ordering-å¼±åº"><a href="#weak-ordering-å¼±åº" class="headerlink" title="weak_ordering å¼±åº"></a>weak_ordering å¼±åº</h3><p>å¯¹äºä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå¦‚æœä¸è€ƒè™‘ä½¿ç”¨ä¸Šè¿°ä¸¤ç§ç±»å‹ä½œä¸ºè¿”å›å€¼ç±»å‹ï¼Œåˆ™å¯ä»¥è€ƒè™‘<code>std::weak_ordering</code>ï¼Œ<br>å…¶å€¼ä¸ºä¸‹åˆ—å€¼ä¹‹ä¸€ï¼š  </p><ul><li><code>std::weak_ordering::less</code> ï¼šæŒ‡ç¤ºå…ˆåºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å°äºå³æ“ä½œæ•°  </li><li><code>std::weak_ordering::greater</code> ï¼šæŒ‡ç¤ºååºå…³ç³»ï¼Œå³å·¦æ“ä½œæ•°å¤§äºå³æ“ä½œæ•°  </li><li><code>std::weak_ordering::equivalent</code> ï¼šæŒ‡ç¤ºç­‰ä»·å…³ç³»ï¼Œå³å·¦æ“ä½œæ•°ç­‰äºå³æ“ä½œæ•°</li></ul><h3 id="æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ordering"><a href="#æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ordering" class="headerlink" title="æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ordering"></a>æ›´æ–¹ä¾¿åœ°ä½¿ç”¨ordering</h3><p>å¯¹äºä¸Šè¿°æåˆ°çš„ç±»å‹ï¼ŒC++æ ‡å‡†æä¾›äº†å…­ç§å’Œå­—é¢é‡<code>0</code>è¿›è¡Œæ¯”è¾ƒçš„è¿ç®—ç¬¦é‡è½½ï¼Œç”¨ä»¥ç¡®å®šä¸¤ä¸ªå€¼çš„å¤§å°é¡ºåºã€‚è®¾<code>ordering_v</code>ä¸ºä¸Šè¿°ä¸‰ç§orderingç±»å‹ä¸­ä»»æ„ç±»å‹çš„å€¼ï¼Œåˆ™ï¼š</p><ol><li><code>ordering_v &gt; 0</code> or <code>0 &lt; ordering_v</code>æ—¶ ï¼šå¯¹åº”<code>less</code>  </li><li><code>ordering_v &gt;= 0</code> or <code>0 &lt;= ordering_v</code>æ—¶ ï¼šå¯¹åº”<code>less</code>âˆ¨<code>equivalent</code>  </li><li><code>ordering_v &lt; 0</code>or<code>0 &gt; ordering_v</code>æ—¶ ï¼šå¯¹åº”<code>greater</code>  </li><li><code>ordering_v &lt;= 0</code>or<code>0 &gt;= ordering_v</code>æ—¶ ï¼šå¯¹åº”<code>greater</code>âˆ¨<code>equivalent</code>  </li><li><code>ordering_v == 0</code> or <code>0 == ordering_v</code>æ—¶ ï¼šå¯¹åº”<code>equivalent</code>  </li><li><code>ordering_v != 0</code> or <code>0 != ordering_v</code>æ—¶ ï¼šå¯¹åº”â”<code>equivalent</code>(é<code>equivalent</code>)</li></ol><h4 id="å…·åæ¯”è¾ƒå‡½æ•°"><a href="#å…·åæ¯”è¾ƒå‡½æ•°" class="headerlink" title="å…·åæ¯”è¾ƒå‡½æ•°"></a>å…·åæ¯”è¾ƒå‡½æ•°</h4><p>è¿™äº›å‡½æ•°å–ä¸‰è·¯æ¯”è¾ƒçš„ç»“æœï¼Œå¹¶è½¬æ¢ä¸ºå…­ä¸ªå…³ç³»è¿ç®—ç¬¦çš„ç»“æœä¹‹ä¸€ã€‚</p><ol><li><code>std::is_eq</code>  </li><li><code>std::is_neq</code>  </li><li><code>std::is_lt</code>  </li><li><code>std::is_lteq</code>  </li><li><code>std::is_gt</code>  </li><li><code>std::is_gteq</code></li></ol><p>è®¾å½¢å‚åä¸º<code>ordering_v</code>ï¼Œè¿™äº›å‡½æ•°å°†åˆ†åˆ«è¿”å›ï¼š</p><ol><li><code>ordering_v == 0</code>  </li><li><code>ordering_v != 0</code>  </li><li><code>ordering_v &lt; 0</code>  </li><li><code>ordering_v &lt;= 0</code>  </li><li><code>ordering_v &gt; 0</code>  </li><li><code>ordering_v &gt;= 0</code></li></ol><h3 id="ç»¼åˆç¤ºä¾‹"><a href="#ç»¼åˆç¤ºä¾‹" class="headerlink" title="ç»¼åˆç¤ºä¾‹"></a>ç»¼åˆç¤ºä¾‹</h3><pre><code class="C++">#include &lt;iostream&gt;// #include &lt;compare&gt; // ç›¸å…³å†…å®¹åœ¨æ ‡å¤´compareä¸­int main()&#123;    using namespace std;    cout &lt;&lt; boolalpha;    auto case_generator = [](auto foo, auto bar)    &#123;        auto print = [](const auto&amp; result)        &#123;            cout                &lt;&lt; &quot; == &quot; &lt;&lt; (result == 0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; != &quot; &lt;&lt; (result != 0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; &lt;  &quot; &lt;&lt; (result &lt;  0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; &lt;= &quot; &lt;&lt; (result &lt;= 0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; &gt;  &quot; &lt;&lt; (result &gt;  0) &lt;&lt; &#39;\n&#39;                &lt;&lt; &quot; &gt;= &quot; &lt;&lt; (result &gt;= 0) &lt;&lt; &#39;\n&#39;;        &#125;;        cout &lt;&lt; &quot;case equivalent\n&quot;;        foo = 100;        bar = 100;        print(foo &lt;=&gt; bar);        cout &lt;&lt; &quot;case less\n&quot;;        foo = 100;        bar = 999;        print(foo &lt;=&gt; bar);        cout &lt;&lt; &quot;case greater\n&quot;;        foo = 999;        bar = 100;        print(foo &lt;=&gt; bar);    &#125;;    cout &lt;&lt; &quot;Integer: \n&quot;;    case_generator(0, 0);    cout &lt;&lt; &quot;Floating point: \n&quot;;    case_generator(0.0, 0.0);    return 0;&#125;</code></pre><p>ç»“æœä¸º</p><pre><code>Integer:case equivalent == true != false &lt;  false &lt;= true &gt;  false &gt;= truecase less == false != true &lt;  true &lt;= true &gt;  false &gt;= falsecase greater == false != true &lt;  false &lt;= false &gt;  true &gt;= trueFloating point:case equivalent == true != false &lt;  false &lt;= true &gt;  false &gt;= truecase less == false != true &lt;  true &lt;= true &gt;  false &gt;= falsecase greater == false != true &lt;  false &lt;= false &gt;  true &gt;= true</code></pre><p>å¯¹äºä¸åŒç±»å‹é—´ä½¿ç”¨ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦çš„è¯¦ç»†è§„åˆ™ï¼Œè¯·å‚é˜…<a href="https://zh.cppreference.com/w/cpp/language/operator_comparison">cpp-reference</a></p><hr><h2 id="ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦"><a href="#ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦" class="headerlink" title="ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦"></a>ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦</h2><p>ä¸ºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦å¯ä»¥å°†å…¶å®šä¹‰ä¸ºæˆå‘˜å‡½æ•°å’Œéæˆå‘˜å‡½æ•°(å‹å…ƒ)ä¸¤ç§æ–¹å¼ã€‚</p><p>ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›å€¼ç±»å‹åº”å½“ä¸º<a href="#ordering_types">ä¸‰ç§ordering</a>ä¸­ä»»æ„ä¸€ä¸ªï¼Œä½†æ˜¯å¦‚æœè¦æ”¹å˜ä¸ºå…¶ä»–ç±»å‹æ¯”å¦‚<code>int</code>ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç¨‹åºå‘˜åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™åº”è¯¥æ¸…æ¥šè‡ªå·±åœ¨åšä»€ä¹ˆã€‚</p><pre><code class="C++">// é‡è½½ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ç¤ºä¾‹// æˆå‘˜å‡½æ•°å½¢å¼ï¼šclass CX1&#123;    int val&#123;&#125;;    int insignificant_things&#123;&#125;;public:    auto operator &lt;=&gt; (const CX1&amp; o) const    &#123;        return this-&gt;val &lt;=&gt; o.val;    &#125;&#125;;// å‹å…ƒå‡½æ•°å½¢å¼(æ¨è)ï¼šclass CX2&#123;    int val&#123;&#125;;    int insignificant_things&#123;&#125;;public:    friend auto operator &lt;=&gt; (const CX2&amp; ol, const CX2&amp; or)    &#123;        return ol.val &lt;=&gt; or.val;    &#125;&#125;;</code></pre><div class="other_topic">é¢˜å¤–è¯ï¼š  <p>æˆ‘æ›´æ¨èå°†æŸä¸€ç±»å‹çš„ <code>+</code>, <code>-</code>, <code>&gt;</code>, <code>==</code>, <code>&lt;=&gt;</code> ç­‰ rhs ä¸ lhs åœ°ä½å¹³ç­‰çš„è¿ç®—ç¬¦ä»¥éæˆå‘˜å‡½æ•°çš„å½¢å¼åœ¨ä¸ç›®æ ‡ç±»å‹<code>T</code>æ‰€å¤„çš„å‘½åç©ºé—´ä¸­(æ— éœ€æ‹…å¿ƒåç§°æŸ¥æ‰¾çš„é—®é¢˜)æä¾›ã€‚  </p><pre><code class="C++">namespace mytest&#123;    struct my_t    &#123;        int data&#123;&#125;;                // å½¢å¼ä¸€        [[nodiscard]] friend constexpr auto operator== (const my_t&amp; lhs, const my_t&amp; rhs) noexcept        &#123;            return lhs.data == rhs.data;        &#125;    &#125;;    // å½¢å¼äºŒ(æ˜¯å¦éœ€è¦è®¾ç½®ä¸ºå‹å…ƒå‡½æ•°è¯·æ ¹æ®æƒ…å†µåˆ¤æ–­)    [[nodiscard]] constexpr auto operator&lt;=&gt; (const my_t&amp; lhs, const my_t&amp; rhs) noexcept    &#123;        return lhs.data &lt;=&gt; rhs.data;    &#125;&#125;auto foo()&#123;    mytest::my_t a&#123; 1 &#125;, b&#123; 2 &#125;;    return a &lt;=&gt; b; // å¯ä»¥æ ¹æ®my_tæ‰€å¤„çš„å‘½åç©ºé—´ä½œç”¨åŸŸæ‰¾åˆ°operator&lt;=&gt;&#125;</code></pre><p>é¢˜å¤–è¯çš„é¢˜å¤–è¯ï¼š<br>å¯¹äºå½¢å‚ï¼Œ<code>my_t</code> çš„æ‹·è´å¼€é”€å¾ˆå°ï¼Œä½¿ç”¨å¼•ç”¨å¯èƒ½è¿˜ä¸å¦‚ä½¿ç”¨æ‹·è´æ–¹ä¾¿é«˜æ•ˆï¼Œä½†æ˜¯ä¸ºäº†å½¢å¼ä¸Šçš„ç»Ÿä¸€ï¼Œæˆ‘æ­¤å¤„ä»ç„¶ä½¿ç”¨<code>const T&amp;</code>å½¢å¼ã€‚æˆ‘ç›¸ä¿¡åœ¨ä¸Šè¿°æƒ…å†µä¸‹(å³ç»™å‡ºçš„ä»£ç )ï¼Œç¼–è¯‘å™¨æœ€ç»ˆçš„ä¼˜åŒ–ä¸ä¼šè®©è¿™ç§â€œå½¢å¼â€å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚<br>å¦‚æœæ‹…å¿ƒæ€§èƒ½é—®é¢˜ï¼Œè¯·åšæ€§èƒ½æµ‹è¯•(éœ€è¦è€ƒè™‘æ˜¯å¦å¯ä»¥å¯ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ç­‰æ¡ä»¶)ã€‚  </p></div><hr><p>ä¸ºæˆ‘ä»¬çš„ç±»å‹æä¾›äº†ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦åï¼Œ<br>è‹¥æ­¤å‡½æ•°è¢«å®šä¹‰ä¸º<code>=default</code>ï¼Œåˆ™C++ä¼šè‡ªåŠ¨ç”Ÿæˆ <code>==</code>, <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code> è¿ç®—ç¬¦ã€‚<br>è‹¥æ­¤å‡½æ•°å®šä¹‰ä¸ä¸º<code>=default</code>ï¼Œåˆ™C++ä¼šè‡ªåŠ¨ç”Ÿæˆ <code>!=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code> è¿ç®—ç¬¦ã€‚<br>è¿™æ˜¯ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½éå¸¸æœ‰ç”¨çš„ä¸€ç‚¹ï¼Œå¦‚æœä¸éœ€è¦è‡ªåŠ¨ç”Ÿæˆçš„æ¯”è¾ƒè¿ç®—ç¬¦å¯ä»¥æ˜¾å¼å¼ƒç½®ï¼Œå¦‚æœè‡ªåŠ¨ç”Ÿæˆçš„æ¯”è¾ƒè¿ç®—ç¬¦ä¸å’Œè‡ªå·±çš„æœŸæœ›ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®ƒã€‚  </p><p>æ³¨ï¼šæä¾›<code>&lt;=&gt;</code>è¿ç®—ç¬¦çš„éé»˜è®¤å®ç°(ä¸å®šä¹‰ä¸º<code>=default</code>)åï¼Œc++ ä¸ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ<code>==</code>è¿ç®—ç¬¦ï¼Œè‡³äºä¸ºä»€ä¹ˆæˆ‘ä¸çŸ¥é“ï¼Œæœ‰èƒ½åŠ›å¯ä»¥å»ç¿»é˜…ç›¸å…³ææ¡ˆã€‚  </p><pre><code class="C++">// ç¤ºä¾‹class CX&#123;    int foo&#123;&#125;;    int bar&#123;&#125;;public:    auto operator &lt;=&gt; (const CX&amp;) const = default;    // å¦‚æœæˆ‘ä»¬å•ä¸å¸Œæœ›æ­¤ç±»æœ‰ &quot;&gt;=&quot; æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œåˆ™æ˜¾ç¤ºå¼ƒç½®å®ƒï¼š    bool operator &gt;= (const CX&amp;) const = delete; // å¼ƒç½® &gt;= è¿ç®—ç¬¦    // å¦‚æœæˆ‘ä»¬å•å¸Œæœ› &quot;&gt;&quot; è¿ç®—ç¬¦çš„æ¯”è¾ƒæ–¹å¼æ˜¯æˆå‘˜å±æ€§ä¹‹å’Œç›¸æ¯”è¾ƒï¼Œè€Œä¸æ˜¯æ ¹æ®ä¸‰è·¯æ¯”è¾ƒè¿ç®—è‡ªåŠ¨ç”Ÿæˆçš„æ¯”è¾ƒæ–¹å¼ï¼Œåˆ™è‡ªå®šä¹‰å®ƒï¼š    bool operator &gt; (const CX&amp; o) const noexcept    &#123;        return (this-&gt;foo + this-&gt;bar) &gt; (o.foo + o.bar);    &#125;&#125;;</code></pre><h3 id="é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½"><a href="#é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½" class="headerlink" title="é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½"></a>é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦é‡è½½</h3><p>å½“æˆ‘ä»¬è¦ä¸ºä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹æä¾›ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦æ—¶ï¼Œæœ‰æ—¶å¯ä»¥è€ƒè™‘é‡‡ç”¨é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ã€‚<br>é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›å€¼æ ¹æ®<a href="#ordering_cast">ä¸‰ç§orderingçš„éšå¼è½¬æ¢è§„åˆ™</a>é‡‡å–ç›¸åº”çš„ç±»å‹ã€‚<br>å³ï¼šæœ‰<code>std::partial_ordering</code>æ—¶ä¸º<code>std::partial_ordering</code>ï¼Œå¦åˆ™æœ‰<code>std::weak_ordering</code>æ—¶ä¸º<code>std::weak_ordering</code>ï¼Œå¦åˆ™ä¸º<code>std::strong_ordering</code>ã€‚<br>å¦‚æœæƒ³è¦ä½¿ç”¨é»˜è®¤çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç±»çš„æˆå‘˜å¿…é¡»å…¨éƒ¨æ»¡è¶³ï¼š<strong>ç±»å‹ä¸ºåŸºæœ¬ç±»å‹</strong>æˆ–<strong>å…·æœ‰é‡è½½çš„è¿”å›å€¼ä¸º<a href="#ordering_types">ä¸Šè¿°ä¸‰ç§ordering</a>çš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦</strong>çš„ç±»å‹ã€‚  </p><p>ç¤ºä¾‹ï¼š</p><pre><code class="C++">// æˆå‘˜å‡½æ•°å½¢å¼ï¼šclass CX1&#123;    int foo&#123;&#125;;    int bar&#123;&#125;; // memberspublic:    auto operator &lt;=&gt; (const CX1&amp;) const = default; // è¿”å›ç±»å‹ä¸º strong_ordering&#125;;// å‹å…ƒå‡½æ•°å½¢å¼ï¼šclass CX2&#123;    int foo&#123;&#125;;    double bar&#123;&#125;; // memberspublic:    friend auto operator &lt;=&gt; (const CX2&amp;, const CX2&amp;) = default; // è¿”å›ç±»å‹ä¸º partial_ordering&#125;;class CX3&#123;    CX1 cx1&#123;&#125;;    CX2 cx2&#123;&#125;;public:    auto operator &lt;=&gt; (const CX1&amp;) const = default; // è¿”å›ç±»å‹ä¸º partial_ordering&#125;;</code></pre><p>é»˜è®¤ç”Ÿæˆçš„ä¸‰è·¯æ¯”è¾ƒè¿ç®—ç¬¦è¿”å›å€¼å–å†³äºæ­¤ï¼š<br>æŒ‰ç±»ä¸­æˆå‘˜é¡ºåºè¿›è¡Œä¸‰è·¯æ¯”è¾ƒï¼Œç›´åˆ°ç»“æœå‡ºç°<code>less</code>ã€<code>greater</code>ã€<code>unordered</code>æˆ–å…¨éƒ¨æ¯”è¾ƒå®Œæˆï¼Œå¹¶å°†æœ€åä¸€ä¸ªå¾—åˆ°çš„ç»“æœä½œä¸ºæ•´ä¸ªä¸‰è·¯æ¯”è¾ƒè¿ç®—çš„ç»“æœã€‚</p><p>ç¤ºä¾‹ï¼š</p><pre><code class="C++">#include &lt;iostream&gt;struct Test &#123;  int m1; double m2; bool m3; &#125;;int main()&#123;    using std::cout;    Test t1&#123; 1, 2.0, true &#125;;    Test t2&#123; 1, 3.0, false &#125;;    // ç¬¬ä¸€ä¸ªæˆå‘˜å±æ€§æ¯”è¾ƒç»“æœä¸º equivalent, ç»§ç»­    // ç¬¬äºŒä¸ªæˆå‘˜å±æ€§æ¯”è¾ƒç»“æœä¸º less, å¾—åˆ°ç»“æœ    if ((t1 &lt;=&gt; t2) &lt; 0) &#123; cout &lt;&lt; &quot;t1 &lt; t2 \n&quot;; &#125;    return 0;&#125;</code></pre><p>ç»“æœä¸º</p><pre><code>t1 &lt; t2</code></pre><hr><p><a href="https://zh.cppreference.com/w/cpp/language/operator_comparison" title="zh cppreference operator_comparison">C++å‚è€ƒ | æ¯”è¾ƒè¿ç®—ç¬¦</a><br><a href="https://zh.cppreference.com/w/cpp/header/compare" title="zh cppreference compare">C++å‚è€ƒ | æ ‡å¤´ compare</a>  </p>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
          <category> CPP20 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> CPP20 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ ä½¿ç”¨externå…³é”®å­—å£°æ˜å…¨å±€å¸¸é‡çš„ä½œç”¨</title>
      <link href="/2023/09/18/CPP%E4%BD%BF%E7%94%A8extern%E5%85%B3%E9%94%AE%E5%AD%97%E5%A3%B0%E6%98%8E%E5%85%A8%E5%B1%80%E5%B8%B8%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8/"/>
      <url>/2023/09/18/CPP%E4%BD%BF%E7%94%A8extern%E5%85%B3%E9%94%AE%E5%AD%97%E5%A3%B0%E6%98%8E%E5%85%A8%E5%B1%80%E5%B8%B8%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p><a href="#toolongtowatch">å¤ªé•¿ä¸çœ‹ç¯èŠ‚</a></p><h2 id="å¼•"><a href="#å¼•" class="headerlink" title="å¼•"></a>å¼•</h2><p>é€šå¸¸åœ¨ç¼–å†™å¤§å‹C&#x2F;C++ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°åˆ†æ–‡ä»¶ç¼–å†™ç¨‹åºçš„æ–¹å¼ç»„ç»‡ä»£ç ï¼ŒæŒ‰ç…§ä¸åŒçš„åŠŸèƒ½æ¨¡å—(æ­¤æ¨¡å—éc++20æ¨¡å—)ï¼Œå°†ä¸€ä»½ç¨‹åºåˆ†æˆä¸åŒçš„éƒ¨åˆ†ã€‚</p><p>ä¸ºäº†è®©æ¨¡å—ä¹‹é—´èƒ½å¤Ÿç›¸äº’è®¿é—®ï¼Œéœ€è¦å°†å£°æ˜æ”¾åœ¨å¤´æ–‡ä»¶(.h)ä¸­ï¼Œå°†å®šä¹‰æ”¾åœ¨æºæ–‡ä»¶(.c&#x2F;.cpp)ä¸­ã€‚</p><pre><code class="cpp">// header &quot;foo.h&quot;int foo();</code></pre><pre><code class="cpp">// source &quot;foo.cpp&quot;#include &quot;foo.h&quot;int foo()&#123;    return &#123;&#125;;&#125;</code></pre><p>è¿™æ ·ï¼Œå…¶ä»–æ¨¡å—åªè¦ä½¿ç”¨äº†é¢„å¤„ç†æŒ‡ä»¤<code>#include &quot;foo.h&quot;</code>ï¼Œå°±èƒ½ä½¿ç”¨å‡½æ•°<code>foo</code>äº†(<del>æ¯ä¸ªç”¨åˆ°<code>foo</code>çš„æºæ–‡ä»¶ä¸­ï¼Œç›´æ¥åœ¨ä½¿ç”¨ä¹‹å‰å£°æ˜ä¸€æ¬¡ä¹Ÿè¡Œ</del>)ã€‚</p><pre><code class="cpp">// main.cpp#include &quot;foo.h&quot;int main()&#123;    return foo();&#125;</code></pre><hr><p>é¢„å¤„ç†æŒ‡ä»¤<code>#include &quot;foo.h&quot;</code>çš„ä½œç”¨ä»…ä»…åªæ˜¯åœ¨é¢„å¤„ç†é˜¶æ®µä½¿ç”¨â€foo.hâ€æ–‡ä»¶çš„å†…å®¹æ›¿æ¢æ‰è¿™æ¡æŒ‡ä»¤è€Œå·²ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘â€main.cppâ€é˜¶æ®µï¼Œä»£ç ä¸­åªæœ‰å­¤é›¶é›¶ä¸€æ¡å£°æ˜ï¼š<code>int foo();</code>ï¼Œè€Œæ²¡æœ‰å‡½æ•°<code>foo</code>çš„å®šä¹‰ï¼Œå¤§å®¶éƒ½ä¸çŸ¥é“è¿™ä¸ªå‡½æ•°<code>foo</code>åœ¨å“ªé‡Œï¼Œä¹Ÿä¸çŸ¥é“è¿™ä¸ªå‡½æ•°<code>foo</code>å¹²äº†ä»€ä¹ˆï¼ŒåªçŸ¥é“æœ‰ä¸ªå«<code>foo</code>çš„å‡½æ•°å¹¶ä¸”è¿™é‡Œè°ƒç”¨äº†å‡½æ•°<code>foo</code>ã€‚</p><p>è™½ç„¶æœ‰äº›ç–‘é—®ï¼Œä½†æ˜¯â€main.cppâ€è¿˜æ˜¯è¢«æˆåŠŸç¼–è¯‘äº†ï¼Œç”Ÿæˆäº†ä¸€ä¸ªâ€main.objâ€(Windowså¹³å°)ï¼Œ<code>.obj</code>æ–‡ä»¶å³â€å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶â€ï¼Œé‡Œé¢è£…æ»¡äº†ç¼–è¯‘å™¨ç”Ÿæˆçš„ç›®æ ‡ä»£ç ã€‚è¿™æ—¶ï¼Œâ€foo.cppâ€ä¹Ÿè¢«ç¼–è¯‘äº†ï¼Œç”Ÿæˆäº†ä¸€ä¸ªâ€foo.objâ€æ–‡ä»¶â€¦â€¦</p><p>ç°åœ¨æ¥åˆ°äº†é“¾æ¥é˜¶æ®µï¼Œâ€main.cppâ€ä¸­çš„<code>main</code>å‡½æ•°è°ƒç”¨äº†<code>foo</code>å‡½æ•°ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“<code>foo</code>å‡½æ•°åœ¨â€foo.objâ€ä¸­ï¼Œé“¾æ¥ç¨‹åºå°†å®ƒå’Œ<code>main</code>å‡½æ•°ä¸€å¹¶æ”¾å…¥äº†â€main.exeâ€(å‡è®¾æ˜¯è¿™ä¸ªåå­—)ï¼Œå¹¶ä¸”åœ¨<code>main</code>å‡½æ•°ä¸­è°ƒç”¨<code>foo</code>å‡½æ•°çš„åœ°æ–¹å¡«ä¸Šäº†<code>foo</code>å‡½æ•°çš„ä½ç½®ã€‚</p><p>è¿™æ ·ï¼Œ<code>main</code>å‡½æ•°å°±çŸ¥é“<code>foo</code>å‡½æ•°åœ¨å“ªäº†ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œ<code>main</code>å‡½æ•°å°†æŠŠæ§åˆ¶æƒäº¤ç»™<code>foo</code>ï¼Œç­‰ç€å®ƒå°†è¿”å›å€¼äº¤ç»™<code>main</code>â€¦â€¦</p><p>è¿™å°±æ˜¯å°å­¦ç”Ÿéƒ½çŸ¥é“çš„C&#x2F;C++è¯­è¨€ä»æºç åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„æµç¨‹ã€‚<del>å½“ç„¶ï¼Œå¦‚æœä½ ç…§ç€ä¸Šé¢å†™äº†ç„¶åè¿˜ç¼–è¯‘é“¾æ¥äº†ï¼Œç”šè‡³è¿˜åç¼–è¯‘äº†ï¼Œç”šè‡³è¿˜ä¸€æ¡æ¡å»çœ‹æ±‡ç¼–æŒ‡ä»¤äº†ï¼Œæœ€åå‘ç°<code>main</code>å‡½æ•°ç›´æ¥è¿”å›äº†0ï¼Œè¯´ç¨‹åºç¼–è¯‘é“¾æ¥éƒ½æ˜¯éª—äººçš„â€¦â€¦åˆ«æ€¥ï¼Œè¿™å¯èƒ½æ˜¯ç¼–è¯‘å™¨å°†<code>foo</code>å‡½æ•°ç›´æ¥å†…è”äº†ï¼Œç”¨ä»£ç æ›¿æ¢äº†å‡½æ•°è°ƒç”¨ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬è¦è®¨è®ºçš„å†…å®¹ã€‚</del></p><p>ä¸€ä¸ªå†…è”çš„ä¾‹å­ï¼Œç”¨<code>mov eax, 5</code>æ›¿æ¢äº†å¯¹å‡½æ•°fooçš„è°ƒç”¨(Releaseæ¨¡å¼ä¸‹)ã€‚</p><img title="ä¾‹å­" src="inline_o.png" data-align="center"><h2 id="Extern-åœ¨å£°æ˜å…¨å±€å˜é‡æ—¶çš„ä½œç”¨"><a href="#Extern-åœ¨å£°æ˜å…¨å±€å˜é‡æ—¶çš„ä½œç”¨" class="headerlink" title="Extern åœ¨å£°æ˜å…¨å±€å˜é‡æ—¶çš„ä½œç”¨"></a>Extern åœ¨å£°æ˜å…¨å±€å˜é‡æ—¶çš„ä½œç”¨</h2><p>é—¹äº†åŠå¤©ä¸»è§’â€externâ€éƒ½æ²¡å‡ºç°ï¼Œç°åœ¨å¼€å§‹è¿›å…¥æ­£é¢˜ã€‚</p><p>å¯¹å‡½æ•°è¿›è¡Œåˆ†æ–‡ä»¶ç¼–å†™æ˜¯å‘¼å¸ä¸€æ ·å¹³å¸¸çš„äº‹æƒ…ï¼Œè€Œç»å¸¸ç¼–å†™C&#x2F;C++ç¨‹åºçš„è¯ï¼Œå…¨å±€å˜é‡&#x2F;å‘½åç©ºé—´å±€éƒ¨å˜é‡å°†æ˜¯ä¸€ä¸ªç»•ä¸å¼€çš„ä¸œè¥¿ã€‚å®ƒä¹Ÿèƒ½åƒå‡½æ•°ä¸€æ ·ï¼Œå°†å£°æ˜ä¸å®šä¹‰åˆ†ç¦»ã€‚ä¸‹é¢å°†è¿›è¡Œå±•ç¤º~  </p><p>(ä½¿ç”¨MSVC)</p><pre><code class="cpp">// header &quot;bar.h&quot;extern int bar;</code></pre><pre><code class="cpp">// source &quot;bar.cpp&quot;int bar&#123; 123 &#125;;</code></pre><pre><code class="cpp">// main.cpp#include &quot;bar.h&quot;int main()&#123;    return bar;&#125;</code></pre><p>æ²¡é”™ï¼Œ <code>extern</code>å…³é”®å­—å‡ºç°äº†ï¼Œå®ƒå‘Šè¯‰é“¾æ¥å™¨è¿™ä¸ªå«<code>bar</code>çš„ï¼Œç­‰ä¼šå»åˆ«çš„ç¿»è¯‘å•å…ƒä¸­æŸ¥æ‰¾å®šä¹‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œéå¸¸é‡å…¨å±€å˜é‡å…·æœ‰å¤–éƒ¨é“¾æ¥ï¼Œå¦‚ä½ æ‰€è§ï¼Œè¿™ä¸ª<code>bar</code>å°±æ˜¯ä¸€ä¸ªéå¸¸é‡å…¨å±€å˜é‡ï¼Œå®ƒå…·æœ‰å¤–éƒ¨é“¾æ¥ï¼Œé“¾æ¥å™¨è®©è¿œåœ¨ä»–<code>.obj</code>çš„<code>main</code>å‡½æ•°ä¹Ÿèƒ½æ‰¾åˆ°å®ƒã€‚</p><hr><div id="toolongtowatch">æˆ‘æ‰€ç†ŸçŸ¥çš„æƒ…å†µåˆ°è¿™å°±ç»“æŸäº†ï¼Œä½†æ˜¯å‰å‡ å¤©ï¼Œæˆ‘åœ¨æ•´ç†æ—§çš„ä»£ç çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªå¥‡æ€ªåˆç†Ÿæ‚‰çš„ä¸œè¥¿ï¼š</div><pre><code class="cpp">namespace Petal::UserEntrance&#123;    extern const fptr&lt;int&gt; pt_user_main&#123; &amp;::MainFunc &#125;;    extern const ptrc&lt;TChar&gt; pt_user_main_name&#123; Petal_TStr(#MainFunc) &#125;;&#125;</code></pre><p>åœ¨å®šä¹‰çš„æ—¶å€™å‡ºç°äº†å…³é”®å­—<code>extern</code>ï¼Œæ˜¾ç„¶æ­¤æ—¶æˆ‘å·²ç»å¿˜è®°äº†<code>extern</code>åœ¨æ­¤å¤„çš„ä½œç”¨ï¼Œæˆ‘æŠ±ç€å¥½å¥‡çš„å¿ƒæ€å°†å®ƒåˆ äº†(æŒ‡<code>extern</code>)ï¼Œç»“æœå‡ºç°äº†é“¾æ¥é”™è¯¯ï¼š</p><table><thead><tr><th>ä»£ç </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><a href="https://learn.microsoft.com/zh-cn/cpp/error-messages/tool-errors/linker-tools-error-lnk2001">LNK2001</a></td><td>æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· â€œint (__cdecl* Petal::UserEntrance::pt_user_main)(void)â€ (?pt_user_main@UserEntrance@Petal@@3Q6AHXZEA)</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/cpp/error-messages/tool-errors/linker-tools-error-lnk2001">LNK2001</a></td><td>æ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å· â€œwchar_t const * const Petal::UserEntrance::pt_user_main_nameâ€ (?pt_user_main_name@UserEntrance@Petal@@3QEB_WEB)</td></tr><tr><td><a href="https://learn.microsoft.com/zh-cn/cpp/error-messages/tool-errors/linker-tools-error-lnk1120">LNK1120</a></td><td>2 ä¸ªæ— æ³•è§£æçš„å¤–éƒ¨å‘½ä»¤</td></tr></tbody></table><p>ç»å…¸é“¾æ¥é”™è¯¯  </p><p><em>Classic</em>  </p><p>æˆ‘å¿˜è®°äº†å½“æ—¶ä¸ºä»€ä¹ˆä¼šè¿™æ ·å†™ï¼ŒæŸ¥ä¸‹MSDNã€‚</p><p><a href="https://learn.microsoft.com/zh-cn/cpp/cpp/extern-cpp?view=msvc-170">extern (C++) | Microsoft Learn | zh-cn</a></p><p><a href="https://learn.microsoft.com/en-us/cpp/cpp/extern-cpp?view=msvc-170">extern (C++) | Microsoft Learn | en-us</a></p><p>æˆ‘æœç„¶æ˜¯å¥å¿˜çš„ï¼Œæ•…å†™ä¸‹åšå®¢ä»¥ä¾¿æœªæ¥å“ªå¤©çŠ¯å‚»äº†èƒ½å¿«é€Ÿæ‰¾åˆ°ä¹‹å‰çš„ç»éªŒ</p><img title="cat" src="my_cat.jpg" width="298" data-align="center"><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¨å±€å¸¸é‡å˜é‡å…·æœ‰å†…éƒ¨é“¾æ¥ï¼Œå³ä½¿åœ¨å¤–å£°æ˜ä¹Ÿæ— æ³•ä½¿ç”¨ï¼Œé™¤éåœ¨å®šä¹‰æ—¶åœ¨å‰é¢åŠ ä¸Šå…³é”®å­—<code>extern</code>ã€‚ç”¨<code>bar</code>æ¥ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><pre><code class="cpp">// header &quot;bar.h&quot;extern const int bar;</code></pre><pre><code class="cpp">// source &quot;bar.cpp&quot;extern const int bar&#123; 123 &#125;;</code></pre><pre><code class="cpp">// main.cpp#include &quot;bar.h&quot;int main()&#123;    return bar;&#125;</code></pre><hr><h2 id="VC-å…¨å±€å˜é‡çš„é“¾æ¥"><a href="#VC-å…¨å±€å˜é‡çš„é“¾æ¥" class="headerlink" title="VC++å…¨å±€å˜é‡çš„é“¾æ¥"></a>VC++å…¨å±€å˜é‡çš„é“¾æ¥</h2><p>æ—¢ç„¶éƒ½è¯´åˆ°è¿™ä»½ä¸Šï¼Œè¿˜æ˜¯å¤ä¹ ä¸€ä¸‹VC++ä¸­å…¨å±€å˜é‡(åŠå‘½åç©ºé—´å±€éƒ¨å˜é‡)æ‰€å…·æœ‰çš„é“¾æ¥(ä¸åŒ…å«C++20åŠæ›´é«˜æ ‡å‡†çš„å†…å®¹)ã€‚</p><p>ä»…å†…éƒ¨é“¾æ¥ï¼š</p><ul><li><p>ä½¿ç”¨staticå£°æ˜çš„å…¨å±€å˜é‡æˆ–å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li><li><p>ç±»å‹å…·æœ‰consté™å®š å¹¶ä¸” å…ˆå‰æ²¡æœ‰å¤–éƒ¨é“¾æ¥çš„å£°æ˜ çš„å…¨å±€å˜é‡æˆ–å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li><li><p>æ— åå‘½åç©ºé—´åŠå…¶ä¸­çš„å‘½åç©ºé—´ä¸­çš„å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li></ul><p>ä¾‹</p><pre><code class="cpp">// test.cppstatic int foo&#123; 1 &#125;;const int bar&#123; 2 &#125;;namespace &#123; int unnamed&#123; 3 &#125;; &#125;</code></pre><pre><code class="cpp">// main.cppextern int foo;extern const int bar;extern int baz;int main()&#123;    int&#123; foo &#125;; // LNK2001    int&#123; bar &#125;; // LNK2001    int&#123; baz &#125;; // LNK2001    return 0;&#125;</code></pre><p>å¤–éƒ¨é“¾æ¥(ä¸åœ¨æ— åå‘½åç©ºé—´åŠå…¶ä¸­çš„å‘½åç©ºé—´å†…å®šä¹‰çš„æƒ…å†µ)ï¼š</p><ul><li><p>ä½¿ç”¨externå£°æ˜çš„å…¨å±€å˜é‡æˆ–å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li><li><p>æ²¡æœ‰consté™å®šçš„å…¨å±€å˜é‡æˆ–å‘½åç©ºé—´å±€éƒ¨å˜é‡</p></li></ul><p>ä¾‹</p><pre><code class="cpp">// test.cppextern const int foo&#123; 1 &#125;;int bar&#123; 2 &#125;;extern const int baz;const int baz&#123; 3 &#125;;</code></pre><pre><code class="cpp">// main.cppextern const int foo;extern int bar;extern const int baz;int main()&#123;    int&#123; foo &#125;;    int&#123; bar &#125;;    int&#123; baz &#125;;    return 0;&#125;</code></pre><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒC++å¼•ç”¨å¿½ç•¥é™å®šç¬¦ï¼Œæ‰€ä»¥å¦‚ä¸‹ä¹Ÿèƒ½é€šè¿‡ç¼–è¯‘é“¾æ¥(MSVC)ï¼š</p><pre><code class="cpp">// test.cppint val&#123; 100 &#125;;int const/*æ­¤consté™å®šint*/ &amp;const/*æ­¤constæ— æ•ˆ*/ test&#123; val &#125;;</code></pre><pre><code class="cpp">extern const int&amp; const test;int main()&#123;    int&#123; test &#125;;    return 0;&#125;</code></pre><p>ä½†è¯·ä¸è¦è¿™ä¹ˆç¼–å†™ä»£ç ã€‚</p><p>æ›´å¤æ‚çš„ä¾‹å­(å…¶å®åˆ†æ¸…é¡¶å±‚constå’Œåº•å±‚constçš„åŒºåˆ«å°±ä¸ä¼šè¢«consté™å®šè¿·æƒ‘ä½äº†)</p><pre><code class="cpp">// test.cppint* ptr1&#123; nullptr &#125;; // å¤–éƒ¨é“¾æ¥const int* ptrc1&#123; nullptr &#125;; // å¤–éƒ¨é“¾æ¥int *const cptr1&#123; nullptr &#125;; // å†…éƒ¨é“¾æ¥int const* const cptrc1&#123; nullptr &#125;; // å†…éƒ¨é“¾æ¥int const* const&amp; cptrcr1&#123; cptrc1 &#125;; // å¤–éƒ¨é“¾æ¥extern int const* const cptrc2&#123; nullptr &#125;; // å¤–éƒ¨é“¾æ¥</code></pre><p>C++å‚è€ƒ</p><p><a href="https://zh.cppreference.com/w/cpp/language/storage_duration">å­˜å‚¨ç±»è¯´æ˜ç¬¦ - cppreference.com</a></p><p><a href="https://en.cppreference.com/w/cpp/language/storage_duration">Storage class specifiers - cppreference.com</a></p><hr><p>å®Œç»“ï¼</p>]]></content>
      
      
      <categories>
          
          <category> CPP </category>
          
          <category> çŒä¸åŠé˜²ç³»åˆ— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> ä»¤æˆ‘çŒä¸åŠé˜²çš„CPP_MSVCçŸ¥è¯† </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
